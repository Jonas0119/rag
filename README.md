# RAG æ™ºèƒ½é—®ç­”ç³»ç»Ÿ

> åŸºäº LangChain + Chroma + MiniMax çš„å¤šç”¨æˆ·æ™ºèƒ½æ–‡æ¡£é—®ç­”ç³»ç»Ÿ

---

## ğŸ”„ æœ€è¿‘æ›´æ–°

### 2025-01-XX

#### ğŸ“š æ–‡æ¡£æ›´æ–°
- **æ•´åˆäº‘æœåŠ¡å¯¹æ¥æ–‡æ¡£**ï¼šå°†æ‰€æœ‰äº‘æœåŠ¡å¯¹æ¥æ–¹æ¡ˆã€ç¯å¢ƒå˜é‡æ£€æŸ¥æ¸…å•æ•´åˆåˆ° README.md
- **æ·»åŠ åˆ†æ­¥éª¤åˆ‡æ¢æ–¹æ¡ˆ**ï¼šæ”¯æŒé€šè¿‡ `STORAGE_MODE`ã€`VECTOR_DB_MODE`ã€`DATABASE_MODE` ä¸‰ä¸ªå¼€å…³ç‹¬ç«‹åˆ‡æ¢
- **å®Œå–„ç¯å¢ƒå˜é‡æ£€æŸ¥**ï¼šæä¾›è¯¦ç»†çš„å˜é‡æ¸…å•å’Œæ£€æŸ¥è„šæœ¬

#### â˜ï¸ äº‘æœåŠ¡æ”¯æŒï¼ˆè§„åˆ’ä¸­ï¼‰
- **Supabase Storage**ï¼šæ–‡ä»¶å­˜å‚¨äº‘æœåŠ¡å¯¹æ¥æ–¹æ¡ˆ
- **Supabase PostgreSQL**ï¼šæ•°æ®åº“äº‘æœåŠ¡å¯¹æ¥æ–¹æ¡ˆ
- **Pinecone**ï¼šå‘é‡åº“äº‘æœåŠ¡å¯¹æ¥æ–¹æ¡ˆï¼ˆå• Index + metadata è¿‡æ»¤ï¼‰

### 2025-11-15

#### ğŸ› Bug ä¿®å¤
- **ä¿®å¤ç½®é¡¶åŠŸèƒ½æ—¶é—´æˆ³é—®é¢˜**ï¼šç½®é¡¶/å–æ¶ˆç½®é¡¶ä¼šè¯æ—¶ä¸å†æ›´æ–° `updated_at` æ—¶é—´æˆ³ï¼Œé¿å…æ˜¨å¤©çš„ä¼šè¯å› ç½®é¡¶æ“ä½œè€Œæ˜¾ç¤ºåœ¨"ä»Šå¤©"åˆ†ç»„ä¸­
- **ä¿®å¤é¢„è§ˆå’Œåˆ é™¤å¯¹è¯æ¡†é—®é¢˜**ï¼šç§»é™¤äº†å¯¼è‡´å¯¹è¯æ¡†æ— æ³•æ˜¾ç¤ºçš„ç«‹å³ `st.rerun()` è°ƒç”¨
- **ä¼˜åŒ–ä¼šè¯ç®¡ç†**ï¼šæ”¹è¿›äº† `update_session` æ–¹æ³•ï¼Œæ·»åŠ  `update_time` å‚æ•°æ§åˆ¶æ˜¯å¦æ›´æ–°æ—¶é—´æˆ³

#### ğŸ’¡ é€»è¾‘æ”¹è¿›
- åªæœ‰åœ¨æ–°æ¶ˆæ¯æ·»åŠ æ—¶æ‰æ›´æ–°ä¼šè¯çš„ `updated_at` æ—¶é—´
- ç½®é¡¶ã€æ ‡é¢˜ä¿®æ”¹ã€å½’æ¡£ç­‰æ“ä½œä¸å½±å“ä¼šè¯çš„æ—¶é—´æ’åº
- ç¡®ä¿ä¼šè¯æŒ‰å®é™…æ´»è·ƒæ—¶é—´æ­£ç¡®åˆ†ç»„

---

## ğŸ“– ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#-é¡¹ç›®æ¦‚è¿°)
- [æ ¸å¿ƒåŠŸèƒ½](#-æ ¸å¿ƒåŠŸèƒ½)
- [æŠ€æœ¯æ ˆ](#ï¸-æŠ€æœ¯æ ˆ)
- [ç³»ç»Ÿæ¶æ„](#ï¸-ç³»ç»Ÿæ¶æ„)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [ç•Œé¢è®¾è®¡](#-ç•Œé¢è®¾è®¡)
- [æ•°æ®åº“è®¾è®¡](#-æ•°æ®åº“è®¾è®¡)
- [ç”¨æˆ·è®¤è¯æ–¹æ¡ˆ](#-ç”¨æˆ·è®¤è¯æ–¹æ¡ˆ)
- [æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ](#-æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ)
- [åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡](#-åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡)
- [é…ç½®è¯´æ˜](#ï¸-é…ç½®è¯´æ˜)
- [äº‘æœåŠ¡å¯¹æ¥æ–¹æ¡ˆ](#-äº‘æœåŠ¡å¯¹æ¥æ–¹æ¡ˆ)
  - [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
  - [Supabase Storage å¯¹æ¥](#supabase-storage-å¯¹æ¥)
  - [Supabase PostgreSQL å¯¹æ¥](#supabase-postgresql-å¯¹æ¥)
  - [Pinecone å¯¹æ¥](#pinecone-å¯¹æ¥)
  - [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®-äº‘æœåŠ¡)
  - [å‡†å¤‡å·¥ä½œæ¸…å•](#å‡†å¤‡å·¥ä½œæ¸…å•)
  - [åˆ†æ­¥éª¤åˆ‡æ¢æ–¹æ¡ˆ](#åˆ†æ­¥éª¤åˆ‡æ¢æ–¹æ¡ˆ)
- [ç¯å¢ƒå˜é‡æ£€æŸ¥](#-ç¯å¢ƒå˜é‡æ£€æŸ¥)
- [ä¾èµ–åŒ…æ¸…å•](#-ä¾èµ–åŒ…æ¸…å•)
- [å¼€å‘è®¡åˆ’](#-å¼€å‘è®¡åˆ’)
- [ä½¿ç”¨è¯´æ˜](#-ä½¿ç”¨è¯´æ˜)
- [å®‰å…¨æ€§è®¾è®¡](#-å®‰å…¨æ€§è®¾è®¡)
- [æŠ€æœ¯äº®ç‚¹](#-æŠ€æœ¯äº®ç‚¹)

---

## ğŸ“– é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ™ºèƒ½é—®ç­”ç³»ç»Ÿ**ï¼Œæ”¯æŒå¤šç”¨æˆ·ä½¿ç”¨ï¼Œæä¾›å®Œæ•´çš„çŸ¥è¯†åº“ç®¡ç†ã€æ™ºèƒ½é—®ç­”ã€ä¼šè¯å†å²ç­‰åŠŸèƒ½ã€‚

### é€‚ç”¨åœºæ™¯

- ğŸ¢ ä¼ä¸šå†…éƒ¨çŸ¥è¯†åº“é—®ç­”
- ğŸ“š æŠ€æœ¯æ–‡æ¡£æ™ºèƒ½æ£€ç´¢
- ğŸ’¼ ä¼šè®®çºªè¦åˆ†æå’ŒæŸ¥è¯¢
- ğŸ“ å­¦ä¹ èµ„æ–™æ™ºèƒ½åŠ©æ‰‹
- ğŸ‘¥ å›¢é˜Ÿåä½œçŸ¥è¯†ç®¡ç†

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. ç”¨æˆ·ç³»ç»Ÿ
- ğŸ” **ç”¨æˆ·æ³¨å†Œ/ç™»å½•**ï¼šåŸºäºè‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿçš„å®‰å…¨è®¤è¯
- ğŸ‘¤ **å¤šç”¨æˆ·æ”¯æŒ**ï¼šæ•°æ®å®Œå…¨éš”ç¦»ï¼Œä¿è¯å®‰å…¨æ€§
- ğŸª **è‡ªåŠ¨ç™»å½•**ï¼šSession State ç®¡ç†ï¼Œè®°ä½ç™»å½•çŠ¶æ€

### 2. çŸ¥è¯†åº“ç®¡ç†
- ğŸ“¤ **æ–‡æ¡£ä¸Šä¼ **ï¼šæ”¯æŒ PDFã€TXTã€Markdownã€Word ç­‰æ ¼å¼
- ğŸ“‹ **æ–‡æ¡£åˆ—è¡¨**ï¼šæ˜¾ç¤ºå·²ä¸Šä¼ çš„æ–‡æ¡£ï¼ˆæ–‡ä»¶åã€å¤§å°ã€ä¸Šä¼ æ—¶é—´ã€åˆ†å—æ•°ï¼‰
- ğŸ—‘ï¸ **æ–‡æ¡£åˆ é™¤**ï¼šä»å‘é‡åº“ä¸­åˆ é™¤æ–‡æ¡£åŠå…¶å‘é‡
- ğŸ‘ï¸ **æ–‡æ¡£é¢„è§ˆ**ï¼šæŸ¥çœ‹æ–‡æ¡£å‰ 500 å­—å†…å®¹
- ğŸ“Š **çŸ¥è¯†åº“ç»Ÿè®¡**ï¼šæ–‡æ¡£æ•°é‡ã€å‘é‡æ•°é‡ã€å­˜å‚¨ç©ºé—´

### 3. æ™ºèƒ½é—®ç­”
- ğŸ’¬ **å¯¹è¯ç•Œé¢**ï¼šç±»ä¼¼ ChatGPT çš„ç°ä»£åŒ–å¯¹è¯ç•Œé¢
- ğŸ” **æ£€ç´¢å±•ç¤º**ï¼šæ˜¾ç¤ºæ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£ç‰‡æ®µå’Œç›¸ä¼¼åº¦è¯„åˆ†
- ğŸ¤” **æ€è€ƒè¿‡ç¨‹**ï¼šå®æ—¶å±•ç¤º AI çš„æ¨ç†æ­¥éª¤
- ğŸ“ **ç­”æ¡ˆç”Ÿæˆ**ï¼šMarkdown æ ¼å¼åŒ–çš„è¯¦ç»†ç­”æ¡ˆ
- ğŸ“œ **å®æ—¶æµå¼è¾“å‡º**ï¼šé€å­—æ˜¾ç¤ºç­”æ¡ˆï¼ˆå¯é€‰ï¼‰

### 4. ä¼šè¯ç®¡ç†
- ğŸ’¾ **ä¼šè¯æŒä¹…åŒ–**ï¼šæ‰€æœ‰å¯¹è¯å†å²ä¿å­˜åˆ°æ•°æ®åº“
- ğŸ“š **ä¼šè¯åˆ—è¡¨**ï¼šæŒ‰æ—¶é—´åˆ†ç»„æ˜¾ç¤ºï¼ˆä»Šå¤©ã€æ˜¨å¤©ã€æœ¬å‘¨ç­‰ï¼‰
- ğŸ”„ **ä¼šè¯åˆ‡æ¢**ï¼šå¿«é€Ÿåˆ‡æ¢å†å²ä¼šè¯
- ğŸ“Œ **ä¼šè¯ç½®é¡¶**ï¼šé‡è¦ä¼šè¯ç½®é¡¶æ˜¾ç¤º
- ğŸ” **ä¼šè¯æœç´¢**ï¼šæŒ‰æ ‡é¢˜æœç´¢å†å²ä¼šè¯
- ğŸ“¥ **ä¼šè¯å¯¼å‡º**ï¼šå¯¼å‡ºä¸º Markdown æˆ– JSON æ ¼å¼

### 5. ç³»ç»Ÿè®¾ç½®
- ğŸ¨ **ä¸»é¢˜åˆ‡æ¢**ï¼šæ·±è‰²æ¨¡å¼ â‡„ æµ…è‰²æ¨¡å¼
- âš™ï¸ **å‚æ•°è°ƒæ•´**ï¼šåˆ†å—å¤§å°ã€æ£€ç´¢æ•°é‡ã€LLM æ¸©åº¦ç­‰
- ğŸ“ˆ **ä½¿ç”¨ç»Ÿè®¡**ï¼šToken æ¶ˆè€—ã€å¯¹è¯æ¬¡æ•°ç­‰

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æ ¸å¿ƒ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **LangChain** | ^1.0.0 | RAG æ¡†æ¶å’Œ Agent ç¼–æ’ |
| **Chroma** | ^1.3.4 | å‘é‡æ•°æ®åº“ |
| **BGE-large-zh-v1.5** | - | ä¸­æ–‡ Embedding æ¨¡å‹ï¼ˆ1024ç»´ï¼‰|
| **MiniMax M2** | - | å¤§è¯­è¨€æ¨¡å‹ï¼ˆé€šè¿‡ Anthropic APIï¼‰|
| **SQLite** | å†…ç½® | å…³ç³»æ•°æ®åº“ï¼ˆç”¨æˆ·ã€ä¼šè¯ã€æ¶ˆæ¯ï¼‰|
| **PyPDF** | ^6.2.0 | PDF æ–‡æ¡£è§£æ |

### å‰ç«¯ç•Œé¢
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Streamlit** | ^1.51.0 | Web æ¡†æ¶ |
| **Plotly** | ^5.24.1 | æ•°æ®å¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰|

### å®‰å…¨ä¸å·¥å…·
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **bcrypt** | ^5.0.0 | å¯†ç åŠ å¯† |
| **pyjwt** | ^2.10.1 | JWT Token ç®¡ç† |
| **python-dotenv** | ^1.2.1 | ç¯å¢ƒå˜é‡ç®¡ç† |
| **python-docx** | ^1.2.0 | Word æ–‡æ¡£æ”¯æŒ |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å±•ç¤ºå±‚ï¼ˆStreamlit UIï¼‰                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ç™»å½•æ³¨å†Œ   â”‚  â”‚  çŸ¥è¯†åº“ç®¡ç† â”‚  â”‚  æ™ºèƒ½é—®ç­”   â”‚         â”‚
â”‚  â”‚  é¡µé¢       â”‚  â”‚  é¡µé¢       â”‚  â”‚  é¡µé¢       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ä¾§è¾¹æ ï¼šç”¨æˆ·ä¿¡æ¯ã€ä¼šè¯åˆ—è¡¨ã€ç³»ç»Ÿè®¾ç½®             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†• Session State
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServicesï¼‰                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è®¤è¯æœåŠ¡     â”‚  â”‚ æ–‡æ¡£æœåŠ¡     â”‚  â”‚ RAG æœåŠ¡     â”‚      â”‚
â”‚  â”‚ - ç™»å½•éªŒè¯   â”‚  â”‚ - ä¸Šä¼ å¤„ç†   â”‚  â”‚ - å‘é‡æ£€ç´¢   â”‚      â”‚
â”‚  â”‚ - æ³¨å†Œ       â”‚  â”‚ - åˆ†å—ç­–ç•¥   â”‚  â”‚ - LLM è°ƒç”¨   â”‚      â”‚
â”‚  â”‚ - ä¼šè¯ç®¡ç†   â”‚  â”‚ - æ ¼å¼è½¬æ¢   â”‚  â”‚ - ç­”æ¡ˆç”Ÿæˆ   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ å‘é‡åº“æœåŠ¡   â”‚  â”‚ ä¼šè¯æœåŠ¡     â”‚                         â”‚
â”‚  â”‚ - Collection â”‚  â”‚ - ä¼šè¯ CRUD  â”‚                         â”‚
â”‚  â”‚ - å‘é‡éš”ç¦»   â”‚  â”‚ - æ¶ˆæ¯ä¿å­˜   â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†• DAO Layer
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ UserDAO      â”‚  â”‚ SessionDAO   â”‚  â”‚ MessageDAO   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ DocumentDAO  â”‚  â”‚ db_manager   â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®å­˜å‚¨å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  SQLite DB   â”‚  â”‚  æ–‡ä»¶ç³»ç»Ÿ    â”‚  â”‚  Chroma DB   â”‚      â”‚
â”‚  â”‚  (å…ƒæ•°æ®)    â”‚  â”‚  (æ–‡æ¡£)      â”‚  â”‚  (å‘é‡)      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
ç”¨æˆ·æé—® 
  â†’ Streamlit UI æ¥æ”¶è¾“å…¥
  â†’ RAG æœåŠ¡å¤„ç†
  â†’ å‘é‡æ£€ç´¢ï¼ˆChromaï¼‰
  â†’ LLM ç”Ÿæˆç­”æ¡ˆï¼ˆMiniMaxï¼‰
  â†’ ä¿å­˜æ¶ˆæ¯ï¼ˆSQLiteï¼‰
  â†’ è¿”å›ç»“æœæ˜¾ç¤º
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
rag/
â”œâ”€â”€ README.md                    # é¡¹ç›®æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ pyproject.toml              # Poetry ä¾èµ–é…ç½®
â”œâ”€â”€ poetry.lock                 # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡ï¼ˆéœ€åˆ›å»ºï¼‰
â”œâ”€â”€ .gitignore                  # Git å¿½ç•¥æ–‡ä»¶
â”‚
â”œâ”€â”€ app.py                      # ğŸš€ Streamlit ä¸»åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ auth/                       # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ authenticator.py       # ç”¨æˆ·è®¤è¯å’Œä¼šè¯ç®¡ç†
â”‚
â”œâ”€â”€ database/                   # æ•°æ®åº“æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ db_manager.py          # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ models.py              # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ user_dao.py            # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ session_dao.py         # ä¼šè¯æ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ message_dao.py         # æ¶ˆæ¯æ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ document_dao.py        # æ–‡æ¡£æ•°æ®è®¿é—®
â”‚   â””â”€â”€ init_db.sql            # æ•°æ®åº“åˆå§‹åŒ– SQL
â”‚
â”œâ”€â”€ services/                   # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ document_service.py    # æ–‡æ¡£ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ rag_service.py         # RAG é—®ç­”æœåŠ¡
â”‚   â”œâ”€â”€ vector_store_service.py # å‘é‡åº“æ“ä½œæœåŠ¡
â”‚   â””â”€â”€ session_service.py     # ä¼šè¯ç®¡ç†æœåŠ¡
â”‚
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ text_splitter.py       # æ–‡æœ¬åˆ†å—å·¥å…·
â”‚   â”œâ”€â”€ file_handler.py        # æ–‡ä»¶å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ security.py            # å®‰å…¨å·¥å…·ï¼ˆå¯†ç åŠ å¯†ç­‰ï¼‰
â”‚
â”œâ”€â”€ components/                 # Streamlit ç»„ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth_component.py      # ç™»å½•æ³¨å†Œç»„ä»¶
â”‚   â”œâ”€â”€ sidebar.py             # ä¾§è¾¹æ ç»„ä»¶
â”‚   â”œâ”€â”€ chat_interface.py      # å¯¹è¯ç•Œé¢ç»„ä»¶
â”‚   â”œâ”€â”€ session_list.py        # ä¼šè¯åˆ—è¡¨ç»„ä»¶
â”‚   â””â”€â”€ document_manager.py    # æ–‡æ¡£ç®¡ç†ç»„ä»¶
â”‚
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•ï¼ˆè¿è¡Œæ—¶åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ database/              # SQLite æ•°æ®åº“
â”‚   â”‚   â””â”€â”€ rag_system.db
â”‚   â”œâ”€â”€ users/                 # ç”¨æˆ·æ•°æ®ç›®å½•
â”‚   â”‚   â”œâ”€â”€ user_1/
â”‚   â”‚   â”‚   â”œâ”€â”€ uploads/       # ç”¨æˆ·ä¸Šä¼ çš„æ–‡æ¡£
â”‚   â”‚   â”‚   â””â”€â”€ exports/       # å¯¼å‡ºçš„ä¼šè¯
â”‚   â”‚   â””â”€â”€ user_2/
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ chroma/                # Chroma å‘é‡åº“
â”‚       â”œâ”€â”€ user_1_collection/
â”‚       â””â”€â”€ user_2_collection/
â”‚
â”œâ”€â”€ logs/                       # æ—¥å¿—ç›®å½•ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ app.log
â”‚
â””â”€â”€ .streamlit/                 # Streamlit é…ç½®
    â””â”€â”€ config.toml            # UI ä¸»é¢˜é…ç½®
```

---

## ğŸ¨ ç•Œé¢è®¾è®¡

### ç™»å½•é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸ“š RAG æ™ºèƒ½é—®ç­”ç³»ç»Ÿ                    â”‚
â”‚                                                         â”‚
â”‚               æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æ–‡æ¡£é—®ç­”ç³»ç»Ÿ                  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ç™»å½•                                         â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚  ç”¨æˆ·å: [___________________]               â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚  å¯†ç :   [___________________]               â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚  [ ] è®°ä½æˆ‘ï¼ˆ30å¤©ï¼‰                          â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚          [    ç™»  å½•    ]                    â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚  è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ[æ³¨å†Œæ–°è´¦å·]                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â”‚              Powered by LangChain + MiniMax            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“š RAG æ™ºèƒ½é—®ç­”ç³»ç»Ÿ                    ğŸ‘¤ Jonas  [è®¾ç½®] [ç™»å‡º]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚                                                      â”‚
â”‚  ğŸ’¬ æˆ‘çš„ä¼šè¯     â”‚  ğŸ’¬ æ™ºèƒ½é—®ç­”                          [æ–°å»ºä¼šè¯]    â”‚
â”‚                  â”‚                                                      â”‚
â”‚  ğŸ” [æœç´¢...]    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                  â”‚  â”‚ ğŸ‘¤ ç”¨æˆ·                            3åˆ†é’Ÿå‰   â”‚  â”‚
â”‚  ğŸ“Œ ç½®é¡¶         â”‚  â”‚ çš‡ç”«æ€»éƒ½è¯´äº†ä»€ä¹ˆï¼Ÿ                          â”‚  â”‚
â”‚  â€¢ é‡è¦ä¼šè®®è®¨è®º  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    8æ¡ | 2hå‰    â”‚                                                      â”‚
â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  ğŸ“… ä»Šå¤©         â”‚  â”‚ ğŸ¤– AI åŠ©æ‰‹                        åˆšåˆš       â”‚  â”‚
â”‚  â€¢ æŠ€æœ¯å›¢é˜Ÿåˆ†æ  â”‚  â”‚                                              â”‚  â”‚
â”‚    12æ¡ | 3hå‰   â”‚  â”‚ ğŸ” æ­£åœ¨æ£€ç´¢ç›¸å…³æ–‡æ¡£...                      â”‚  â”‚
â”‚  â€¢ ä¼šè®®çºªè¦æŸ¥è¯¢  â”‚  â”‚    âœ“ æ‰¾åˆ° 3 ä¸ªç›¸å…³æ®µè½                     â”‚  â”‚
â”‚    5æ¡ | 5hå‰    â”‚  â”‚                                              â”‚  â”‚
â”‚                  â”‚  â”‚ ğŸ“„ æ£€ç´¢ç»“æœï¼š                                â”‚  â”‚
â”‚  ğŸ“… æ˜¨å¤©         â”‚  â”‚    [æ®µè½ 1] ğŸ“Š ç›¸ä¼¼åº¦: 89%                  â”‚  â”‚
â”‚  â€¢ é¡¹ç›®æµç¨‹è®¨è®º  â”‚  â”‚    çš‡ç”«æ€»ï¼šä»Šå¤©çš„åº§è°ˆä¼šæœ€é‡è¦ç›®çš„æ˜¯...     â”‚  â”‚
â”‚    15æ¡ | æ˜¨å¤©   â”‚  â”‚    [å±•å¼€å…¨æ–‡]                                â”‚  â”‚
â”‚                  â”‚  â”‚                                              â”‚  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚    [æ®µè½ 2] ğŸ“Š ç›¸ä¼¼åº¦: 85%                  â”‚  â”‚
â”‚                  â”‚  â”‚    ç°åœ¨å…¬å¸çš„æœºä¼šéå¸¸å¤š...                  â”‚  â”‚
â”‚  ğŸ“ çŸ¥è¯†åº“       â”‚  â”‚    [å±•å¼€å…¨æ–‡]                                â”‚  â”‚
â”‚  ğŸ“Š ç»Ÿè®¡         â”‚  â”‚                                              â”‚  â”‚
â”‚  â€¢ æ–‡æ¡£: 3ä¸ª     â”‚  â”‚ ğŸ’­ æ€è€ƒè¿‡ç¨‹ï¼š                                â”‚  â”‚
â”‚  â€¢ å‘é‡: 45ä¸ª    â”‚  â”‚    1. åˆ†æé—®é¢˜ï¼šæå–äººç‰©å‘è¨€               â”‚  â”‚
â”‚  â€¢ ç©ºé—´: 5.2MB   â”‚  â”‚    2. æ£€ç´¢æ–‡æ¡£ï¼šè¯­ä¹‰åŒ¹é…ç›¸å…³æ®µè½           â”‚  â”‚
â”‚                  â”‚  â”‚    3. æ•´åˆä¿¡æ¯ï¼šå½’ç±»ä¸»è¦è§‚ç‚¹               â”‚  â”‚
â”‚  [ğŸ“¤ ä¸Šä¼ æ–‡æ¡£]   â”‚  â”‚                                              â”‚  â”‚
â”‚                  â”‚  â”‚ ğŸ’¡ ç­”æ¡ˆï¼š                                    â”‚  â”‚
â”‚  ğŸ“‹ æ–‡æ¡£åˆ—è¡¨     â”‚  â”‚    åŸºäºä¼šè®®çºªè¦ï¼Œçš‡ç”«æ€»ä¸»è¦è¯´äº†ä»¥ä¸‹å‡ ç‚¹ï¼š  â”‚  â”‚
â”‚  â€¢ ä¼šè®®çºªè¦.pdf  â”‚  â”‚                                              â”‚  â”‚
â”‚    2.3MB | 15é¡µ  â”‚  â”‚    ## å…³äºä¼šè®®ç›®çš„                          â”‚  â”‚
â”‚    [é¢„è§ˆ][åˆ é™¤]  â”‚  â”‚    ä»Šå¤©çš„åº§è°ˆä¼šæœ€é‡è¦ç›®çš„æ˜¯æ²Ÿé€š...         â”‚  â”‚
â”‚                  â”‚  â”‚                                              â”‚  â”‚
â”‚  â€¢ æŠ€æœ¯è§„èŒƒ.txt  â”‚  â”‚    ## å…³äºä¸ªäººæˆé•¿                          â”‚  â”‚
â”‚    0.8MB | 1200è¡Œâ”‚  â”‚    å¼ºè°ƒä¸ªäººæˆé•¿çš„é‡è¦æ€§...                  â”‚  â”‚
â”‚    [é¢„è§ˆ][åˆ é™¤]  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  [è¾“å…¥æ‚¨çš„é—®é¢˜...]                      [å‘é€ â¤]  â”‚
â”‚                  â”‚                                                      â”‚
â”‚  âš™ï¸ ç³»ç»Ÿè®¾ç½®     â”‚                                                      â”‚
â”‚  ğŸ¨ ä¸»é¢˜: æ·±è‰²   â”‚                                                      â”‚
â”‚  ğŸ“ åˆ†å—: 800å­—  â”‚                                                      â”‚
â”‚  ğŸ” æ£€ç´¢: 3æ¡    â”‚                                                      â”‚
â”‚  ğŸŒ¡ï¸ æ¸©åº¦: 0.0   â”‚                                                      â”‚
â”‚                  â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ æ•°æ®åº“è®¾è®¡

### ER å›¾æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚1      n â”‚  sessions   â”‚1      n â”‚  messages   â”‚
â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚ user_id(PK) â”‚         â”‚ session_id  â”‚         â”‚ message_id  â”‚
â”‚ username    â”‚         â”‚ user_id(FK) â”‚         â”‚ session_id  â”‚
â”‚ password    â”‚         â”‚ title       â”‚         â”‚ role        â”‚
â”‚ email       â”‚         â”‚ created_at  â”‚         â”‚ content     â”‚
â”‚ ...         â”‚         â”‚ ...         â”‚         â”‚ ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚1
       â”‚
       â”‚n
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  documents  â”‚
â”‚             â”‚
â”‚ doc_id(PK)  â”‚
â”‚ user_id(FK) â”‚
â”‚ filename    â”‚
â”‚ filepath    â”‚
â”‚ ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

#### 1. users - ç”¨æˆ·è¡¨

```sql
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,        -- bcrypt hash
    email VARCHAR(100),
    display_name VARCHAR(100),
    avatar_url VARCHAR(255),                     -- å¤´åƒ URLï¼ˆå¯é€‰ï¼‰
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    preferences TEXT                             -- JSON: ç”¨æˆ·åå¥½è®¾ç½®
);

-- ç´¢å¼•
CREATE INDEX idx_username ON users(username);
CREATE INDEX idx_active ON users(is_active);
```

**å­—æ®µè¯´æ˜ï¼š**
- `user_id`: ç”¨æˆ·å”¯ä¸€æ ‡è¯†
- `username`: ç™»å½•ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- `password_hash`: bcrypt åŠ å¯†çš„å¯†ç 
- `email`: ç”¨æˆ·é‚®ç®±ï¼ˆå¯é€‰ï¼‰
- `display_name`: æ˜¾ç¤ºåç§°
- `avatar_url`: å¤´åƒåœ°å€ï¼ˆå¯é€‰ï¼‰
- `preferences`: JSON æ ¼å¼çš„ç”¨æˆ·åå¥½ï¼ˆä¸»é¢˜ã€è¯­è¨€ç­‰ï¼‰

---

#### 2. sessions - ä¼šè¯è¡¨

```sql
CREATE TABLE sessions (
    session_id VARCHAR(36) PRIMARY KEY,          -- UUID
    user_id INTEGER NOT NULL,
    title VARCHAR(200),                          -- ä¼šè¯æ ‡é¢˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    message_count INTEGER DEFAULT 0,
    is_pinned BOOLEAN DEFAULT FALSE,             -- æ˜¯å¦ç½®é¡¶
    status VARCHAR(20) DEFAULT 'active',         -- 'active', 'archived'
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- ç´¢å¼•
CREATE INDEX idx_user_sessions ON sessions(user_id, updated_at DESC);
CREATE INDEX idx_pinned ON sessions(is_pinned, updated_at DESC);
```

**å­—æ®µè¯´æ˜ï¼š**
- `session_id`: ä¼šè¯å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰
- `user_id`: æ‰€å±ç”¨æˆ·
- `title`: ä¼šè¯æ ‡é¢˜ï¼ˆè‡ªåŠ¨ç”Ÿæˆæˆ–ç”¨æˆ·ç¼–è¾‘ï¼‰
- `message_count`: æ¶ˆæ¯æ•°é‡ï¼ˆå†—ä½™å­—æ®µï¼Œä¾¿äºå±•ç¤ºï¼‰
- `is_pinned`: æ˜¯å¦ç½®é¡¶
- `status`: çŠ¶æ€ï¼ˆactive/archivedï¼‰

---

#### 3. messages - æ¶ˆæ¯è¡¨

```sql
CREATE TABLE messages (
    message_id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id VARCHAR(36) NOT NULL,
    role VARCHAR(20) NOT NULL,                   -- 'user', 'assistant'
    content TEXT NOT NULL,
    retrieved_docs TEXT,                         -- JSON: æ£€ç´¢åˆ°çš„æ–‡æ¡£
    thinking_process TEXT,                       -- JSON: æ€è€ƒè¿‡ç¨‹
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    tokens_used INTEGER DEFAULT 0,               -- Token æ¶ˆè€—
    FOREIGN KEY (session_id) REFERENCES sessions(session_id) ON DELETE CASCADE
);

-- ç´¢å¼•
CREATE INDEX idx_session_messages ON messages(session_id, created_at);
```

**å­—æ®µè¯´æ˜ï¼š**
- `message_id`: æ¶ˆæ¯å”¯ä¸€æ ‡è¯†
- `session_id`: æ‰€å±ä¼šè¯
- `role`: è§’è‰²ï¼ˆuser/assistantï¼‰
- `content`: æ¶ˆæ¯å†…å®¹
- `retrieved_docs`: æ£€ç´¢ç»“æœï¼ˆJSON æ ¼å¼ï¼‰
- `thinking_process`: AI æ€è€ƒè¿‡ç¨‹ï¼ˆJSON æ ¼å¼ï¼‰
- `tokens_used`: Token æ¶ˆè€—ç»Ÿè®¡

**JSON æ ¼å¼ç¤ºä¾‹ï¼š**

```json
// retrieved_docs
[
  {
    "chunk_id": 0,
    "content": "æ®µè½å†…å®¹...",
    "similarity": 0.89,
    "metadata": {"source": "ä¼šè®®çºªè¦.pdf", "page": 2}
  }
]

// thinking_process
[
  {"step": 1, "action": "åˆ†æé—®é¢˜", "description": "è¯†åˆ«é—®é¢˜ç±»å‹"},
  {"step": 2, "action": "æ£€ç´¢æ–‡æ¡£", "description": "æ‰¾åˆ°3ä¸ªç›¸å…³æ®µè½"},
  {"step": 3, "action": "æ•´åˆç­”æ¡ˆ", "description": "å½’çº³ä¸»è¦è§‚ç‚¹"}
]
```

---

#### 4. documents - æ–‡æ¡£è¡¨

```sql
CREATE TABLE documents (
    doc_id VARCHAR(36) PRIMARY KEY,              -- UUID
    user_id INTEGER NOT NULL,
    filename VARCHAR(255) NOT NULL,              -- å­˜å‚¨æ–‡ä»¶å
    original_filename VARCHAR(255) NOT NULL,     -- åŸå§‹æ–‡ä»¶å
    filepath VARCHAR(500) NOT NULL,              -- æœåŠ¡å™¨è·¯å¾„
    file_size INTEGER NOT NULL,                  -- æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    file_type VARCHAR(50) NOT NULL,              -- æ–‡ä»¶ç±»å‹
    page_count INTEGER,                          -- é¡µæ•°ï¼ˆPDFï¼‰
    chunk_count INTEGER DEFAULT 0,               -- åˆ†å—æ•°é‡
    vector_collection VARCHAR(100),              -- Chroma collection
    upload_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR(20) DEFAULT 'active',         -- 'active', 'processing', 'error'
    error_message TEXT,                          -- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
    metadata TEXT,                               -- JSON: é¢å¤–å…ƒæ•°æ®
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- ç´¢å¼•
CREATE INDEX idx_user_docs ON documents(user_id, upload_at DESC);
CREATE INDEX idx_status ON documents(status);
```

**å­—æ®µè¯´æ˜ï¼š**
- `doc_id`: æ–‡æ¡£å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰
- `user_id`: æ‰€å±ç”¨æˆ·
- `filename`: å­˜å‚¨çš„æ–‡ä»¶åï¼ˆUUIDå‘½åï¼‰
- `original_filename`: ç”¨æˆ·ä¸Šä¼ çš„åŸå§‹æ–‡ä»¶å
- `filepath`: æœåŠ¡å™¨å­˜å‚¨è·¯å¾„
- `chunk_count`: åˆ†å—æ•°é‡
- `vector_collection`: å¯¹åº”çš„å‘é‡åº“ collection åç§°
- `status`: å¤„ç†çŠ¶æ€ï¼ˆactive/processing/errorï¼‰

---

#### 5. user_stats - ç”¨æˆ·ç»Ÿè®¡è¡¨ï¼ˆå¯é€‰ï¼‰

```sql
CREATE TABLE user_stats (
    user_id INTEGER PRIMARY KEY,
    total_sessions INTEGER DEFAULT 0,
    total_messages INTEGER DEFAULT 0,
    total_documents INTEGER DEFAULT 0,
    storage_used INTEGER DEFAULT 0,              -- å·²ä½¿ç”¨å­˜å‚¨ï¼ˆå­—èŠ‚ï¼‰
    total_tokens INTEGER DEFAULT 0,              -- ç´¯è®¡ Token æ¶ˆè€—
    last_active TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);
```

---

### æ–‡ä»¶å­˜å‚¨ç»“æ„

```
data/
â”œâ”€â”€ database/
â”‚   â””â”€â”€ rag_system.db                # SQLite æ•°æ®åº“æ–‡ä»¶
â”‚
â”œâ”€â”€ users/                           # ç”¨æˆ·æ•°æ®æ ¹ç›®å½•
â”‚   â”œâ”€â”€ user_1/                     # ç”¨æˆ· ID å¯¹åº”ç›®å½•
â”‚   â”‚   â”œâ”€â”€ uploads/                # ä¸Šä¼ çš„åŸå§‹æ–‡æ¡£
â”‚   â”‚   â”‚   â”œâ”€â”€ <uuid>.pdf
â”‚   â”‚   â”‚   â”œâ”€â”€ <uuid>.txt
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ exports/                # å¯¼å‡ºçš„ä¼šè¯è®°å½•
â”‚   â”‚       â””â”€â”€ session_<date>.md
â”‚   â”œâ”€â”€ user_2/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ chroma/                          # Chroma å‘é‡åº“
    â”œâ”€â”€ user_1_collection/          # æ¯ç”¨æˆ·ç‹¬ç«‹ collection
    â”‚   â”œâ”€â”€ chroma.sqlite3
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ user_2_collection/
    â”‚   â””â”€â”€ ...
    â””â”€â”€ ...
```

---

## ğŸ” ç”¨æˆ·è®¤è¯æ–¹æ¡ˆ

### æŠ€æœ¯é€‰å‹ï¼šè‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿ

åŸºäºè‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿå®ç°ç®€å•å¯é çš„ç”¨æˆ·è®¤è¯ï¼Œä½¿ç”¨ bcrypt åŠ å¯†å¯†ç ï¼ŒSession State ç®¡ç†ä¼šè¯çŠ¶æ€ã€‚

### è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¿é—®åº”ç”¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       æ£€æŸ¥ Cookie æˆ– Session
              â”‚
         å·²ç™»å½•â”‚æœªç™»å½•
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ˜¾ç¤ºç™»å½•é¡µé¢                                â”‚
â”‚  - ç”¨æˆ·å + å¯†ç                              â”‚
â”‚  - è®°ä½æˆ‘ï¼ˆCookie 30å¤©ï¼‰                     â”‚
â”‚  - æ³¨å†Œæ–°è´¦å·é“¾æ¥                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éªŒè¯ç”¨æˆ·èº«ä»½                                â”‚
â”‚  1. ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·                         â”‚
â”‚  2. bcrypt éªŒè¯å¯†ç                           â”‚
â”‚  3. æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆis_activeï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
      éªŒè¯æˆåŠŸâ”‚éªŒè¯å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»º Session                                â”‚
â”‚  - st.session_state['authenticated'] = True â”‚
â”‚  - st.session_state['user_id'] = user_id    â”‚
â”‚  - st.session_state['username'] = username  â”‚
â”‚  - æ›´æ–° last_login æ—¶é—´                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŠ è½½ç”¨æˆ·æ•°æ®                                â”‚
â”‚  - å†å²ä¼šè¯åˆ—è¡¨                              â”‚
â”‚  - æ–‡æ¡£åˆ—è¡¨                                  â”‚
â”‚  - ç”¨æˆ·åå¥½è®¾ç½®                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿›å…¥ä¸»åº”ç”¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ³¨å†Œæµç¨‹

```
ç”¨æˆ·å¡«å†™æ³¨å†Œè¡¨å•
  â†’ éªŒè¯ç”¨æˆ·åå”¯ä¸€æ€§
  â†’ bcrypt åŠ å¯†å¯†ç 
  â†’ æ’å…¥ users è¡¨
  â†’ åˆ›å»ºç”¨æˆ·ç›®å½•ï¼ˆdata/users/user_X/ï¼‰
  â†’ è‡ªåŠ¨ç™»å½•
```

### å¯†ç å®‰å…¨

```python
import bcrypt

# æ³¨å†Œæ—¶åŠ å¯†å¯†ç 
def hash_password(password: str) -> str:
    salt = bcrypt.gensalt()
    hashed = bcrypt.hashpw(password.encode('utf-8'), salt)
    return hashed.decode('utf-8')

# ç™»å½•æ—¶éªŒè¯å¯†ç 
def verify_password(password: str, password_hash: str) -> bool:
    return bcrypt.checkpw(
        password.encode('utf-8'),
        password_hash.encode('utf-8')
    )
```

### Cookie ç®¡ç†

ä½¿ç”¨ Streamlit Authenticator å†…ç½®çš„ Cookie ç®¡ç†ï¼š
- Cookie åç§°ï¼š`rag_auth_token`
- æœ‰æ•ˆæœŸï¼š30 å¤©
- åŠ å¯†å¯†é’¥ï¼šç¯å¢ƒå˜é‡ `AUTH_COOKIE_KEY`

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ

### å¤šç”¨æˆ·æ•°æ®éš”ç¦»ç­–ç•¥

#### 1. æ•°æ®åº“éš”ç¦»

æ‰€æœ‰ç”¨æˆ·æ•°æ®é€šè¿‡ `user_id` å­—æ®µéš”ç¦»ï¼š

```python
# æŸ¥è¯¢ç”¨æˆ·çš„ä¼šè¯ï¼ˆè‡ªåŠ¨è¿‡æ»¤ï¼‰
sessions = db.execute("""
    SELECT * FROM sessions 
    WHERE user_id = ? 
    ORDER BY updated_at DESC
""", (user_id,))

# æŸ¥è¯¢ç”¨æˆ·çš„æ–‡æ¡£ï¼ˆè‡ªåŠ¨è¿‡æ»¤ï¼‰
documents = db.execute("""
    SELECT * FROM documents 
    WHERE user_id = ? 
    ORDER BY upload_at DESC
""", (user_id,))
```

#### 2. æ–‡ä»¶ç³»ç»Ÿéš”ç¦»

æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç›®å½•ï¼š

```
data/users/
  â”œâ”€â”€ user_1/    # ç”¨æˆ·1çš„ä¸“å±ç›®å½•
  â”œâ”€â”€ user_2/    # ç”¨æˆ·2çš„ä¸“å±ç›®å½•
  â””â”€â”€ ...
```

#### 3. å‘é‡åº“éš”ç¦»

**æ–¹æ¡ˆï¼šæ¯ç”¨æˆ·ç‹¬ç«‹ Collection**

```python
# ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºç‹¬ç«‹çš„ Collection
collection_name = f"user_{user_id}_docs"

vectorstore = Chroma(
    collection_name=collection_name,
    embedding_function=embeddings,
    persist_directory=f"./data/chroma/user_{user_id}"
)
```

**ä¼˜ç‚¹ï¼š**
- âœ… æ•°æ®å®Œå…¨éš”ç¦»ï¼Œå®‰å…¨æ€§é«˜
- âœ… åˆ é™¤ç”¨æˆ·æ—¶å¯ç›´æ¥åˆ é™¤æ•´ä¸ª collection
- âœ… æ”¯æŒç”¨æˆ·çº§åˆ«çš„é…ç½®

### ä¼šè¯æŒä¹…åŒ–

#### ä¼šè¯åˆ›å»º

```python
import uuid
from datetime import datetime

def create_session(user_id: int, first_question: str):
    # 1. ç”Ÿæˆå”¯ä¸€ session_id
    session_id = str(uuid.uuid4())
    
    # 2. æ ¹æ®é¦–ä¸ªé—®é¢˜ç”Ÿæˆæ ‡é¢˜ï¼ˆå–å‰20å­—ï¼‰
    title = first_question[:20] + "..." if len(first_question) > 20 else first_question
    
    # 3. æ’å…¥æ•°æ®åº“
    db.execute("""
        INSERT INTO sessions (session_id, user_id, title)
        VALUES (?, ?, ?)
    """, (session_id, user_id, title))
    
    return session_id
```

#### æ¶ˆæ¯ä¿å­˜

```python
def save_message(session_id: str, role: str, content: str, 
                 retrieved_docs=None, thinking_process=None, tokens_used=0):
    # ä¿å­˜æ¶ˆæ¯
    db.execute("""
        INSERT INTO messages (
            session_id, role, content, 
            retrieved_docs, thinking_process, tokens_used
        )
        VALUES (?, ?, ?, ?, ?, ?)
    """, (
        session_id, role, content,
        json.dumps(retrieved_docs) if retrieved_docs else None,
        json.dumps(thinking_process) if thinking_process else None,
        tokens_used
    ))
    
    # æ›´æ–°ä¼šè¯ç»Ÿè®¡
    db.execute("""
        UPDATE sessions 
        SET updated_at = CURRENT_TIMESTAMP,
            message_count = message_count + 1
        WHERE session_id = ?
    """, (session_id,))
```

#### ä¼šè¯åŠ è½½

```python
def load_session(session_id: str):
    # åŠ è½½ä¼šè¯ä¿¡æ¯
    session = db.execute("""
        SELECT * FROM sessions WHERE session_id = ?
    """, (session_id,)).fetchone()
    
    # åŠ è½½æ‰€æœ‰æ¶ˆæ¯
    messages = db.execute("""
        SELECT * FROM messages 
        WHERE session_id = ? 
        ORDER BY created_at ASC
    """, (session_id,)).fetchall()
    
    return session, messages
```

---

## ğŸ¯ åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡

### 1. çŸ¥è¯†åº“ç®¡ç†æ¨¡å—

#### æ–‡æ¡£ä¸Šä¼ æµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
  â†“
éªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¤§å°
  â†“
ç”Ÿæˆå”¯ä¸€ doc_id (UUID)
  â†“
ä¿å­˜åˆ° data/users/{user_id}/uploads/
  â†“
è§£ææ–‡æ¡£å†…å®¹ï¼ˆPyPDFLoaderï¼‰
  â†“
æ®µè½çº§åˆ«åˆ†å—
  â†“
ç”Ÿæˆå‘é‡ï¼ˆBGE Embeddingï¼‰
  â†“
å­˜å…¥ Chromaï¼ˆuser_{user_id}_docs collectionï¼‰
  â†“
ä¿å­˜å…ƒæ•°æ®åˆ° documents è¡¨
  â†“
è¿”å›æˆåŠŸ/å¤±è´¥
```

#### åˆ†å—ç­–ç•¥

```python
def split_by_paragraphs(text):
    """
    æ®µè½çº§åˆ«åˆ†å—ç­–ç•¥
    - ä¿ç•™è¯­ä¹‰å®Œæ•´æ€§
    - é¿å…å¥å­æˆªæ–­
    - é€‚åˆä¸­æ–‡æ–‡æ¡£
    """
    chunks = []
    paragraphs = re.split(r'\n\s*\n', text)
    
    current_chunk = ""
    max_chunk_size = 800
    min_chunk_size = 200
    
    for para in paragraphs:
        # ... è¯¦ç»†é€»è¾‘è§ utils/text_splitter.py
        pass
    
    return chunks
```

#### æ–‡æ¡£åˆ é™¤æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»åˆ é™¤
  â†“
ç¡®è®¤å¯¹è¯æ¡†
  â†“
ä»å‘é‡åº“åˆ é™¤ï¼ˆChroma deleteï¼‰
  â†“
åˆ é™¤ç‰©ç†æ–‡ä»¶
  â†“
æ›´æ–° documents è¡¨çŠ¶æ€ä¸º 'deleted'
  â†“
æ›´æ–°ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
  â†“
åˆ·æ–°æ–‡æ¡£åˆ—è¡¨
```

---

### 2. æ™ºèƒ½é—®ç­”æ¨¡å—

#### RAG æŸ¥è¯¢æµç¨‹

```
ç”¨æˆ·è¾“å…¥é—®é¢˜
  â†“
ä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ°æ•°æ®åº“
  â†“
å‘é‡æ£€ç´¢ï¼ˆChroma similarity searchï¼‰
  â†“
è·å– top-k ç›¸å…³æ–‡æ¡£ç‰‡æ®µ
  â†“
æ„é€  Promptï¼ˆé—®é¢˜ + æ£€ç´¢ç»“æœï¼‰
  â†“
è°ƒç”¨ LLMï¼ˆMiniMax M2ï¼‰
  â†“
æµå¼è¾“å‡ºç­”æ¡ˆï¼ˆå¯é€‰ï¼‰
  â†“
ä¿å­˜ AI å›å¤åˆ°æ•°æ®åº“
  â†“
å±•ç¤ºæœ€ç»ˆç­”æ¡ˆ
```

#### Prompt æ¨¡æ¿

```python
template = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æ¡£åˆ†æåŠ©æ‰‹ã€‚è¯·åŸºäºä»¥ä¸‹æ£€ç´¢åˆ°çš„ç›¸å…³å†…å®¹å›ç­”é—®é¢˜ã€‚

ç›¸å…³æ–‡æ¡£å†…å®¹ï¼š
{context}

ç”¨æˆ·é—®é¢˜ï¼š
{question}

è¯·ä»”ç»†åˆ†ææ–‡æ¡£å†…å®¹ï¼Œç»™å‡ºè¯¦ç»†å’Œå‡†ç¡®çš„å›ç­”ã€‚å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·å¦‚å®è¯´æ˜ã€‚
"""
```

#### æ€è€ƒè¿‡ç¨‹å±•ç¤º

```python
thinking_steps = [
    {
        "step": 1,
        "action": "é—®é¢˜åˆ†æ",
        "description": f"è¯†åˆ«åˆ°é—®é¢˜ç±»å‹: {question_type}",
        "details": f"å…³é”®è¯: {keywords}"
    },
    {
        "step": 2,
        "action": "æ–‡æ¡£æ£€ç´¢",
        "description": f"æ£€ç´¢åˆ° {len(docs)} ä¸ªç›¸å…³æ®µè½",
        "details": f"å¹³å‡ç›¸ä¼¼åº¦: {avg_similarity:.2f}"
    },
    {
        "step": 3,
        "action": "ä¿¡æ¯æå–",
        "description": "ä»æ®µè½ä¸­æå–å…³é”®ä¿¡æ¯",
        "details": "ç­›é€‰ç›¸å…³æ€§ > 0.8 çš„å†…å®¹"
    },
    {
        "step": 4,
        "action": "ç­”æ¡ˆç”Ÿæˆ",
        "description": "æ•´åˆä¿¡æ¯ç”Ÿæˆç»“æ„åŒ–ç­”æ¡ˆ",
        "details": f"è€—æ—¶: {elapsed:.2f}ç§’"
    }
]
```

---

### 3. ä¼šè¯ç®¡ç†æ¨¡å—

#### ä¼šè¯åˆ—è¡¨åˆ†ç»„

```sql
-- æŒ‰æ—¶é—´åˆ†ç»„çš„ SQL æŸ¥è¯¢
SELECT 
    session_id,
    title,
    message_count,
    updated_at,
    is_pinned,
    CASE 
        WHEN DATE(updated_at) = DATE('now') THEN 'today'
        WHEN DATE(updated_at) = DATE('now', '-1 day') THEN 'yesterday'
        WHEN DATE(updated_at) >= DATE('now', '-7 day') THEN 'this_week'
        WHEN DATE(updated_at) >= DATE('now', '-30 day') THEN 'this_month'
        ELSE 'older'
    END as time_group
FROM sessions
WHERE user_id = ? AND status = 'active'
ORDER BY is_pinned DESC, updated_at DESC
LIMIT 50;
```

#### ä¼šè¯æ ‡é¢˜è‡ªåŠ¨ç”Ÿæˆ

```python
def generate_session_title(first_question: str, max_length=20):
    """
    æ ¹æ®é¦–ä¸ªé—®é¢˜ç”Ÿæˆä¼šè¯æ ‡é¢˜
    """
    # ç§»é™¤ç‰¹æ®Šå­—ç¬¦
    title = re.sub(r'[^\w\s\u4e00-\u9fff]', '', first_question)
    
    # æˆªæ–­åˆ°æŒ‡å®šé•¿åº¦
    if len(title) > max_length:
        title = title[:max_length] + "..."
    
    return title or "æ–°å»ºå¯¹è¯"
```

#### ä¼šè¯å¯¼å‡º

```python
def export_session_to_markdown(session_id: str):
    """
    å¯¼å‡ºä¼šè¯ä¸º Markdown æ ¼å¼
    """
    session, messages = load_session(session_id)
    
    md_content = f"# {session['title']}\n\n"
    md_content += f"åˆ›å»ºæ—¶é—´ï¼š{session['created_at']}\n"
    md_content += f"æ¶ˆæ¯æ•°é‡ï¼š{session['message_count']}\n\n"
    md_content += "---\n\n"
    
    for msg in messages:
        role_emoji = "ğŸ‘¤" if msg['role'] == 'user' else "ğŸ¤–"
        md_content += f"## {role_emoji} {msg['role'].title()}\n\n"
        md_content += f"{msg['content']}\n\n"
        
        if msg['retrieved_docs']:
            md_content += "### æ£€ç´¢ç»“æœ\n\n"
            docs = json.loads(msg['retrieved_docs'])
            for i, doc in enumerate(docs, 1):
                md_content += f"{i}. {doc['content'][:100]}...\n"
            md_content += "\n"
        
        md_content += f"*{msg['created_at']}*\n\n"
        md_content += "---\n\n"
    
    return md_content
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

```bash
# ==================== API é…ç½® ====================
# MiniMax APIï¼ˆé€šè¿‡ Anthropic æ¥å£ï¼‰
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_BASE_URL=https://api.minimaxi.com/anthropic

# ==================== æ•°æ®åº“é…ç½® ====================
DATABASE_PATH=data/database/rag_system.db

# ==================== å­˜å‚¨é…ç½® ====================
DATA_ROOT_DIR=data
USER_DATA_DIR=data/users
CHROMA_DB_DIR=data/chroma
MAX_FILE_SIZE=10485760                    # 10MB

# ==================== è®¤è¯é…ç½® ====================
# Streamlit Authenticator
AUTH_COOKIE_NAME=rag_auth_token
AUTH_COOKIE_KEY=your_random_secret_key_here_32chars
AUTH_COOKIE_EXPIRY_DAYS=30

# å¯†ç å¼ºåº¦è¦æ±‚
MIN_PASSWORD_LENGTH=6

# ==================== RAG é…ç½® ====================
# æ–‡æœ¬åˆ†å—
CHUNK_SIZE=800
CHUNK_OVERLAP=100
MIN_CHUNK_SIZE=200
MAX_CHUNK_SIZE=1000

# å‘é‡æ£€ç´¢
RETRIEVAL_K=3
RETRIEVAL_SEARCH_TYPE=similarity

# LLM å‚æ•°
LLM_MODEL=MiniMax-M2
LLM_TEMPERATURE=0
LLM_MAX_TOKENS=2000

# Embedding æ¨¡å‹
EMBEDDING_MODEL=BAAI/bge-large-zh-v1.5
EMBEDDING_DEVICE=cpu
NORMALIZE_EMBEDDINGS=true

# ==================== Streamlit é…ç½® ====================
STREAMLIT_SERVER_PORT=8501
STREAMLIT_SERVER_ADDRESS=0.0.0.0

# ==================== æ—¥å¿—é…ç½® ====================
LOG_LEVEL=INFO
LOG_FILE=logs/app.log
```

### Streamlit ä¸»é¢˜é…ç½®ï¼ˆ.streamlit/config.tomlï¼‰

```toml
[theme]
primaryColor = "#8B5CF6"              # ç´«è‰²ä¸»é¢˜
backgroundColor = "#0E1117"            # æ·±è‰²èƒŒæ™¯
secondaryBackgroundColor = "#1F2937"  # æ¬¡çº§èƒŒæ™¯
textColor = "#FAFAFA"                 # æ–‡æœ¬é¢œè‰²
font = "sans serif"

# å¦‚æœéœ€è¦æµ…è‰²ä¸»é¢˜ï¼Œå–æ¶ˆæ³¨é‡Šä»¥ä¸‹é…ç½®ï¼š
# [theme]
# primaryColor = "#8B5CF6"
# backgroundColor = "#FFFFFF"
# secondaryBackgroundColor = "#F3F4F6"
# textColor = "#1F2937"
# font = "sans serif"

[server]
port = 8501
enableCORS = false
headless = true

[browser]
gatherUsageStats = false
```

### ä¸»é¢˜åˆ‡æ¢å®ç°

```python
# åœ¨ä¾§è¾¹æ æ·»åŠ ä¸»é¢˜åˆ‡æ¢
theme = st.sidebar.selectbox(
    "ğŸ¨ ä¸»é¢˜",
    ["æ·±è‰²æ¨¡å¼", "æµ…è‰²æ¨¡å¼"],
    index=0 if st.session_state.get('theme', 'dark') == 'dark' else 1
)

if theme == "æ·±è‰²æ¨¡å¼":
    st.session_state['theme'] = 'dark'
    # åº”ç”¨æ·±è‰²ä¸»é¢˜é…ç½®
else:
    st.session_state['theme'] = 'light'
    # åº”ç”¨æµ…è‰²ä¸»é¢˜é…ç½®
```

---

## â˜ï¸ äº‘æœåŠ¡å¯¹æ¥æ–¹æ¡ˆ

### æ•´ä½“æ¶æ„

#### å½“å‰æ¶æ„ï¼ˆæœ¬åœ°éƒ¨ç½²ï¼‰
```
æœ¬åœ°éƒ¨ç½²
â”œâ”€â”€ æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (data/users/user_{user_id}/uploads/)
â”œâ”€â”€ SQLite æ•°æ®åº“ (data/database/rag_system.db)
â””â”€â”€ Chroma å‘é‡åº“ (data/chroma/user_{user_id}_collection/)
```

#### æ”¹é€ åæ¶æ„ï¼ˆäº‘æœåŠ¡ï¼‰
```
äº‘æœåŠ¡æ¶æ„
â”œâ”€â”€ Supabase Storage (æ–‡ä»¶å­˜å‚¨)
â”‚   â””â”€â”€ Bucket: documents
â”‚       â””â”€â”€ user_{user_id}/{filename}
â”œâ”€â”€ Supabase PostgreSQL (æ•°æ®åº“)
â”‚   â””â”€â”€ è¡¨ç»“æ„ï¼šusers, sessions, messages, documents, user_stats
â””â”€â”€ Pinecone (å‘é‡åº“)
    â””â”€â”€ Index: rag-system (å• Indexï¼Œé€šè¿‡ metadata è¿‡æ»¤)
```

### Supabase Storage å¯¹æ¥

#### å‚è€ƒæ–‡æ¡£
- [Supabase Storage Quickstart](https://supabase.com/docs/guides/storage/quickstart)
- [Supabase Python Client](https://supabase.com/docs/reference/python/introduction)

#### æ ¸å¿ƒæ¦‚å¿µ

**1. Bucketï¼ˆå­˜å‚¨æ¡¶ï¼‰**
- **åç§°**ï¼š`rag`ï¼ˆåœ¨ `.env` ä¸­é€šè¿‡ `SUPABASE_STORAGE_BUCKET` é…ç½®ï¼‰
- **ç±»å‹**ï¼šPrivateï¼ˆç§æœ‰ï¼Œéœ€è¦è®¤è¯ï¼‰
- **ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„æ–‡æ¡£æ–‡ä»¶

**2. æ–‡ä»¶è·¯å¾„ç»“æ„**
```
rag/
â”œâ”€â”€ user_1/
â”‚   â”œâ”€â”€ 1763135036_dd4d9424.pdf
â”‚   â””â”€â”€ 1763202390_aae4f415.pdf
â”œâ”€â”€ user_2/
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

è·¯å¾„æ ¼å¼ï¼š`user_{user_id}/{filename}`

#### å®ç°æ–¹æ¡ˆ

**1. å®‰è£…ä¾èµ–**
```bash
pip install supabase
# æˆ–ä½¿ç”¨ Poetry
poetry add supabase
```

**2. åˆå§‹åŒ–å®¢æˆ·ç«¯**
```python
from supabase import create_client, Client

# ä½¿ç”¨ Service Keyï¼ˆæœ‰å®Œæ•´æƒé™ï¼Œç”¨äºæœåŠ¡ç«¯ï¼‰
supabase: Client = create_client(
    supabase_url=config.SUPABASE_URL,
    supabase_key=config.SUPABASE_SERVICE_KEY  # ä½¿ç”¨ Service Key
)
```

**3. æ–‡ä»¶æ“ä½œ**

- **ä¸Šä¼ æ–‡ä»¶**ï¼š`storage.from_(bucket).upload(path, file_data)`
- **ä¸‹è½½æ–‡ä»¶**ï¼š`storage.from_(bucket).download(file_path)`
- **åˆ é™¤æ–‡ä»¶**ï¼š`storage.from_(bucket).remove([file_path])`
- **è·å–æ–‡ä»¶ URL**ï¼š`storage.from_(bucket).create_signed_url(path, expires_in)`

**4. å®‰å…¨ç­–ç•¥**

åœ¨ Supabase Dashboard ä¸­é…ç½® Storage Policiesï¼ˆå¯é€‰ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ Service Key å¯ç»•è¿‡é™åˆ¶ï¼‰ï¼š

```sql
-- å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå·±çš„æ–‡ä»¶
CREATE POLICY "Users can upload their own files"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (
    bucket_id = 'rag' AND
    (storage.foldername(name))[1] = 'user_' || auth.uid()::text
);
```

**æ³¨æ„**ï¼šç”±äºæˆ‘ä»¬ä½¿ç”¨ Service Keyï¼ˆæœåŠ¡ç«¯ï¼‰ï¼Œè¿™äº› Policies ä¸»è¦ç”¨äºå‰ç«¯ç›´æ¥è®¿é—®çš„æƒ…å†µã€‚æœåŠ¡ç«¯ä½¿ç”¨ Service Key å¯ä»¥ç»•è¿‡è¿™äº›é™åˆ¶ã€‚

### Supabase PostgreSQL å¯¹æ¥

#### å‚è€ƒæ–‡æ¡£
- [Supabase Database Overview](https://supabase.com/docs/guides/database/overview)
- [Connecting to your database](https://supabase.com/docs/guides/database/connecting-to-your-database)

#### æ ¸å¿ƒæ¦‚å¿µ

**1. è¿æ¥å­—ç¬¦ä¸²æ ¼å¼**
```
postgresql://postgres:[PASSWORD]@db.[PROJECT_REF].supabase.co:5432/postgres
```

**2. æ•°æ®åº“ç‰¹æ€§**
- å®Œå…¨å…¼å®¹ PostgreSQL
- æ”¯æŒæ‰€æœ‰ PostgreSQL åŠŸèƒ½
- å…è´¹ç‰ˆï¼š500MB æ•°æ®åº“å¤§å°
- æ”¯æŒ Row Level Security (RLS)

#### å®ç°æ–¹æ¡ˆ

**1. å®‰è£…ä¾èµ–**
```bash
pip install psycopg2-binary
# æˆ–ä½¿ç”¨ Poetry
poetry add psycopg2-binary
```

**2. è¿æ¥æ•°æ®åº“**
```python
import psycopg2
from psycopg2.extras import RealDictCursor

def get_postgres_connection():
    """è·å– PostgreSQL è¿æ¥"""
    conn = psycopg2.connect(
        config.DATABASE_URL,
        cursor_factory=RealDictCursor  # è¿”å›å­—å…¸æ ¼å¼çš„è¡Œ
    )
    return conn
```

**3. SQL è¯­æ³•å·®å¼‚**

| SQLite | PostgreSQL | è¯´æ˜ |
|--------|-----------|------|
| `INTEGER PRIMARY KEY AUTOINCREMENT` | `SERIAL PRIMARY KEY` | è‡ªå¢ä¸»é”® |
| `BOOLEAN DEFAULT TRUE` | `BOOLEAN DEFAULT TRUE` | ç›¸åŒ |
| `TIMESTAMP DEFAULT CURRENT_TIMESTAMP` | `TIMESTAMP DEFAULT CURRENT_TIMESTAMP` | ç›¸åŒ |
| `VARCHAR(n)` | `VARCHAR(n)` | ç›¸åŒ |
| `TEXT` | `TEXT` | ç›¸åŒ |
| `IF NOT EXISTS` | `IF NOT EXISTS` | ç›¸åŒï¼ˆPostgreSQL 9.5+ï¼‰ |
| `?` (å‚æ•°å ä½ç¬¦) | `%s` (å‚æ•°å ä½ç¬¦) | éœ€è¦è½¬æ¢ |

**4. æ•°æ®åº“ç®¡ç†å™¨æ”¹é€ **

ä»£ç å·²å®ç°æ”¯æŒ SQLite å’Œ PostgreSQL çš„ `DatabaseManager` ç±»ï¼š
- æ ¹æ® `DATABASE_MODE` è‡ªåŠ¨é€‰æ‹©æ•°æ®åº“ç±»å‹
- è‡ªåŠ¨è½¬æ¢å‚æ•°å ä½ç¬¦ï¼ˆ`?` â†’ `%s`ï¼‰
- å»¶è¿Ÿåˆå§‹åŒ–ï¼Œé¿å…å¯åŠ¨æ—¶è¿æ¥å¤±è´¥
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

**5. åˆå§‹åŒ–æ•°æ®åº“**

ä½¿ç”¨ `database/init_db_postgres.sql` åœ¨ Supabase Dashboard çš„ SQL Editor ä¸­æ‰§è¡Œã€‚

### Pinecone å¯¹æ¥

#### å‚è€ƒæ–‡æ¡£
- [Pinecone Python SDK](https://docs.pinecone.io/reference/python-sdk)
- [Pinecone LangChain Integration](https://python.langchain.com/docs/integrations/vectorstores/pinecone)

#### æ ¸å¿ƒæ¦‚å¿µ

**1. Indexï¼ˆç´¢å¼•ï¼‰**
- **åç§°**ï¼š`rag-system`ï¼ˆå…¨å±€å”¯ä¸€ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
- **ç»´åº¦**ï¼š1024ï¼ˆåŒ¹é… BGE-large-zh-v1.5ï¼‰
- **æŒ‡æ ‡**ï¼šcosineï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
- **ç±»å‹**ï¼šServerlessï¼ˆå…è´¹ç‰ˆï¼‰
- **é™åˆ¶**ï¼šå…è´¹ç‰ˆåªæœ‰ 1 ä¸ª Indexï¼Œ100K å‘é‡

**2. Metadata è¿‡æ»¤ï¼ˆå¤šç”¨æˆ·éš”ç¦»ï¼‰**
- æ‰€æœ‰å‘é‡å¿…é¡»åŒ…å« `user_id` åœ¨ metadata ä¸­
- æ‰€æœ‰æŸ¥è¯¢å¿…é¡»ä½¿ç”¨ `filter={"user_id": user_id}`
- æ‰€æœ‰åˆ é™¤å¿…é¡»ä½¿ç”¨ `filter={"user_id": user_id, "doc_id": doc_id}`

#### å®ç°æ–¹æ¡ˆ

**1. å®‰è£…ä¾èµ–**
```bash
pip install pinecone-client langchain-pinecone
# æˆ–ä½¿ç”¨ Poetry
poetry add pinecone-client langchain-pinecone
```

**2. åˆå§‹åŒ– Pinecone**
```python
from pinecone import Pinecone, ServerlessSpec
from langchain_pinecone import PineconeVectorStore

# åˆå§‹åŒ– Pinecone å®¢æˆ·ç«¯
pc = Pinecone(api_key=config.PINECONE_API_KEY)

# è·å–æˆ–åˆ›å»º Index
index_name = config.PINECONE_INDEX_NAME

# æ£€æŸ¥ Index æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
if index_name not in pc.list_indexes().names():
    pc.create_index(
        name=index_name,
        dimension=1024,  # BGE-large-zh-v1.5 çš„ç»´åº¦
        metric="cosine",
        spec=ServerlessSpec(
            cloud="aws",  # æˆ– "gcp"
            region=config.PINECONE_ENVIRONMENT  # å¦‚ "us-east-1"
        )
    )
```

**3. å‘é‡åº“æœåŠ¡æ”¹é€ **

ä»£ç å·²å®ç°æ”¯æŒ Chroma å’Œ Pinecone çš„ `VectorStoreService` ç±»ï¼š
- æ ¹æ® `VECTOR_DB_MODE` è‡ªåŠ¨é€‰æ‹©å‘é‡åº“ç±»å‹
- Pinecone æ¨¡å¼ä¸‹è‡ªåŠ¨æ·»åŠ  `user_id` åˆ° metadata
- æ‰€æœ‰æŸ¥è¯¢/åˆ é™¤æ“ä½œè‡ªåŠ¨ä½¿ç”¨ metadata è¿‡æ»¤
- æ”¯æŒå‘é‡æ•°é‡ç»Ÿè®¡ï¼ˆé€šè¿‡ query æ–¹æ³•ï¼‰

#### å®‰å…¨æ€§æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦**ï¼šPinecone å• Index æ–¹æ¡ˆçš„å®‰å…¨æ€§å®Œå…¨ä¾èµ–äº metadata è¿‡æ»¤ï¼š

1. **æ‰€æœ‰æ·»åŠ æ“ä½œ**å¿…é¡»åŒ…å« `user_id`ï¼š
   ```python
   doc.metadata["user_id"] = user_id  # å¿…é¡»ï¼
   ```

2. **æ‰€æœ‰æŸ¥è¯¢æ“ä½œ**å¿…é¡»ä½¿ç”¨ filterï¼š
   ```python
   filter={"user_id": user_id}  # å¿…é¡»ï¼
   ```

3. **æ‰€æœ‰åˆ é™¤æ“ä½œ**å¿…é¡»ä½¿ç”¨ filterï¼š
   ```python
   filter={"user_id": user_id, "doc_id": doc_id}  # å¿…é¡»ï¼
   ```

4. **æµ‹è¯•éªŒè¯**ï¼šæ·»åŠ å•å…ƒæµ‹è¯•ç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½æ­£ç¡®ä½¿ç”¨ filterã€‚

### ç¯å¢ƒå˜é‡é…ç½®ï¼ˆäº‘æœåŠ¡ï¼‰

#### æ¨¡å¼åˆ‡æ¢å¼€å…³

```bash
# ==================== å­˜å‚¨æ¨¡å¼åˆ‡æ¢ ====================
# local: ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ/SQLite/Chroma
# cloud: ä½¿ç”¨äº‘æœåŠ¡ï¼ˆSupabase/Pineconeï¼‰
STORAGE_MODE=local
VECTOR_DB_MODE=local
DATABASE_MODE=local
```

#### Supabase é…ç½®

```bash
# ==================== Supabase é…ç½® ====================
# è·å–æ–¹å¼ï¼šSupabase Dashboard -> Settings -> API
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your_publishable_key
SUPABASE_SERVICE_KEY=your_service_key

# Supabase Storage
SUPABASE_STORAGE_BUCKET=documents

# Supabase PostgreSQL
# è·å–æ–¹å¼ï¼šSupabase Dashboard -> Settings -> Database -> Connection string
DATABASE_URL=postgresql://postgres:password@db.xxx.supabase.co:5432/postgres
```

#### Pinecone é…ç½®

```bash
# ==================== Pinecone é…ç½® ====================
# è·å–æ–¹å¼ï¼šPinecone Dashboard -> API Keys
PINECONE_API_KEY=your_pinecone_api_key

# Pinecone Environment/Region
# å…è´¹ç‰ˆé€šå¸¸æ˜¯ï¼šus-east-1 (AWS) æˆ– us-east1-gcp (GCP)
PINECONE_ENVIRONMENT=us-east-1

# Pinecone Index åç§°ï¼ˆå• Indexï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
PINECONE_INDEX_NAME=rag-system
```

### å‡†å¤‡å·¥ä½œæ¸…å•

#### é˜¶æ®µ1ï¼šSupabase è®¾ç½®ï¼ˆ30åˆ†é’Ÿï¼‰

1. **åˆ›å»º Storage Bucket**
   - ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
   - è¿›å…¥ **Storage** é¡µé¢
   - ç‚¹å‡» **New Bucket**
   - é…ç½®ï¼šName: `documents`ï¼ŒPublic: `No`ï¼ˆç§æœ‰ï¼‰

2. **è·å– Supabase å‡­è¯**
   - è¿›å…¥ **Settings** -> **API**
   - å¤åˆ¶ Project URLã€anon public keyã€service_role key

3. **è·å– PostgreSQL è¿æ¥å­—ç¬¦ä¸²**
   - è¿›å…¥ **Settings** -> **Database**
   - æ‰¾åˆ° **Connection string** -> **URI**
   - æ›¿æ¢ `[PASSWORD]` ä¸ºæ•°æ®åº“å¯†ç 

4. **åˆå§‹åŒ–æ•°æ®åº“è¡¨**
   - è¿›å…¥ **SQL Editor**
   - å¤åˆ¶ `database/init_db_postgres.sql` çš„å†…å®¹
   - ç²˜è´´å¹¶æ‰§è¡Œ

#### é˜¶æ®µ2ï¼šPinecone è®¾ç½®ï¼ˆ15åˆ†é’Ÿï¼‰

1. **åˆ›å»º Index**
   - ç™»å½• [Pinecone Dashboard](https://app.pinecone.io/)
   - ç‚¹å‡» **Create Index**
   - é…ç½®ï¼šName: `rag-system`ï¼ŒDimensions: `1024`ï¼ŒMetric: `cosine`

2. **è·å– API Key**
   - è¿›å…¥ **API Keys** é¡µé¢
   - å¤åˆ¶ API Key å’Œ Environment

#### é˜¶æ®µ3ï¼šæœ¬åœ°ç¯å¢ƒé…ç½®ï¼ˆ10åˆ†é’Ÿï¼‰

1. **å®‰è£…ä¾èµ–**
   ```bash
   pip install supabase psycopg2-binary pinecone-client langchain-pinecone
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**
   - å¤åˆ¶ `config_template.txt` ä¸º `.env`
   - å¡«å…¥æ‰€æœ‰äº‘æœåŠ¡çš„é…ç½®

3. **æµ‹è¯•è¿æ¥**
   ```bash
   python -c "from supabase import create_client; print('Supabase OK')"
   python -c "import psycopg2; print('PostgreSQL OK')"
   python -c "from pinecone import Pinecone; print('Pinecone OK')"
   ```

### åˆ†æ­¥éª¤åˆ‡æ¢æ–¹æ¡ˆ

é€šè¿‡ä¸‰ä¸ªç‹¬ç«‹çš„å¼€å…³ï¼Œå¯ä»¥åˆ†æ­¥éª¤åˆ‡æ¢åˆ°äº‘æœåŠ¡ï¼š

#### æ­¥éª¤1ï¼šåˆ‡æ¢åˆ°äº‘æ•°æ®åº“ï¼ˆDATABASE_MODE=cloudï¼‰

**å‰ææ¡ä»¶ï¼š**
- âœ… `DATABASE_URL` å·²é…ç½®
- âœ… Supabase PostgreSQL è¡¨å·²åˆå§‹åŒ–

**åˆ‡æ¢æ­¥éª¤ï¼š**
1. åœ¨ `.env` ä¸­è®¾ç½®ï¼š`DATABASE_MODE=cloud`
2. ä¿æŒå…¶ä»–æ¨¡å¼ä¸º `local`ï¼š
   ```bash
   STORAGE_MODE=local
   VECTOR_DB_MODE=local
   DATABASE_MODE=cloud  # åªæ”¹è¿™ä¸ª
   ```
3. æµ‹è¯•ï¼šç™»å½•ã€æ³¨å†Œã€åˆ›å»ºä¼šè¯ã€å‘é€æ¶ˆæ¯

**éªŒè¯æ–¹æ³•ï¼š**
- ç™»å½•æˆåŠŸ
- æ•°æ®ä¿å­˜åˆ° Supabase PostgreSQL
- åœ¨ Supabase Dashboard çš„ Table Editor ä¸­èƒ½çœ‹åˆ°æ•°æ®

#### æ­¥éª¤2ï¼šåˆ‡æ¢åˆ°äº‘å­˜å‚¨ï¼ˆSTORAGE_MODE=cloudï¼‰

**å‰ææ¡ä»¶ï¼š**
- âœ… `SUPABASE_URL`ã€`SUPABASE_KEY`ã€`SUPABASE_SERVICE_KEY` å·²é…ç½®
- âœ… `SUPABASE_STORAGE_BUCKET` å·²åˆ›å»º

**åˆ‡æ¢æ­¥éª¤ï¼š**
1. åœ¨ `.env` ä¸­è®¾ç½®ï¼š`STORAGE_MODE=cloud`
2. ä¿æŒå…¶ä»–æ¨¡å¼ï¼š
   ```bash
   STORAGE_MODE=cloud  # æ”¹è¿™ä¸ª
   VECTOR_DB_MODE=local
   DATABASE_MODE=cloud
   ```
3. æµ‹è¯•ï¼šä¸Šä¼ æ–‡æ¡£ã€æŸ¥çœ‹æ–‡æ¡£ã€åˆ é™¤æ–‡æ¡£

**éªŒè¯æ–¹æ³•ï¼š**
- æ–‡æ¡£ä¸Šä¼ æˆåŠŸ
- åœ¨ Supabase Dashboard çš„ Storage ä¸­èƒ½çœ‹åˆ°æ–‡ä»¶
- æ–‡ä»¶è·¯å¾„æ ¼å¼ï¼š`user_{user_id}/{filename}`

#### æ­¥éª¤3ï¼šåˆ‡æ¢åˆ°äº‘å‘é‡åº“ï¼ˆVECTOR_DB_MODE=cloudï¼‰

**å‰ææ¡ä»¶ï¼š**
- âœ… `PINECONE_API_KEY` å·²é…ç½®
- âœ… `PINECONE_ENVIRONMENT` å·²é…ç½®
- âœ… `PINECONE_INDEX_NAME` å·²åˆ›å»ºï¼ˆç»´åº¦ï¼š1024ï¼‰

**åˆ‡æ¢æ­¥éª¤ï¼š**
1. åœ¨ `.env` ä¸­è®¾ç½®ï¼š`VECTOR_DB_MODE=cloud`
2. æ‰€æœ‰æ¨¡å¼éƒ½åˆ‡æ¢åˆ°äº‘ï¼š
   ```bash
   STORAGE_MODE=cloud
   VECTOR_DB_MODE=cloud  # æ”¹è¿™ä¸ª
   DATABASE_MODE=cloud
   ```
3. æµ‹è¯•ï¼šä¸Šä¼ æ–‡æ¡£ï¼ˆå‘é‡åŒ–ï¼‰ã€æœç´¢æ–‡æ¡£ã€åˆ é™¤æ–‡æ¡£

**éªŒè¯æ–¹æ³•ï¼š**
- æ–‡æ¡£ä¸Šä¼ åå‘é‡åŒ–æˆåŠŸ
- åœ¨ Pinecone Dashboard ä¸­èƒ½çœ‹åˆ°å‘é‡
- æœç´¢åŠŸèƒ½æ­£å¸¸
- å¤šç”¨æˆ·æ•°æ®éš”ç¦»æ­£ç¡®ï¼ˆé€šè¿‡ metadata è¿‡æ»¤ï¼‰

#### ä¼˜åŠ¿

1. âœ… **é€æ­¥æµ‹è¯•**ï¼šæ¯æ¬¡åªæ”¹ä¸€ä¸ªæ¨¡å—ï¼Œå®¹æ˜“å®šä½é—®é¢˜
2. âœ… **å¿«é€Ÿå›æ»š**ï¼šå‡ºé—®é¢˜å¯ä»¥ç«‹å³åˆ‡å› local
3. âœ… **æ··åˆæ¨¡å¼**ï¼šæ”¯æŒéƒ¨åˆ†äº‘æœåŠ¡ã€éƒ¨åˆ†æœ¬åœ°
4. âœ… **é™ä½é£é™©**ï¼šä¸ä¼šä¸€æ¬¡æ€§å½±å“æ‰€æœ‰åŠŸèƒ½

---

## ğŸ” ç¯å¢ƒå˜é‡æ£€æŸ¥

### å¿…éœ€å˜é‡æ¸…å•

#### åŸºç¡€é…ç½®ï¼ˆå¿…é¡»ï¼‰

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|--------|---------|
| `ANTHROPIC_API_KEY` | MiniMax API Key | `sk-xxx` | âœ… æ˜¯ |
| `ANTHROPIC_BASE_URL` | MiniMax API åœ°å€ | `https://api.minimaxi.com/anthropic` | âœ… æ˜¯ |

#### æ¨¡å¼åˆ‡æ¢å¼€å…³ï¼ˆå¿…é¡»ï¼‰

| å˜é‡å | è¯´æ˜ | å¯é€‰å€¼ | é»˜è®¤å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|--------|--------|---------|
| `STORAGE_MODE` | æ–‡ä»¶å­˜å‚¨æ¨¡å¼ | `local` æˆ– `cloud` | `local` | âœ… æ˜¯ |
| `VECTOR_DB_MODE` | å‘é‡åº“æ¨¡å¼ | `local` æˆ– `cloud` | `local` | âœ… æ˜¯ |
| `DATABASE_MODE` | æ•°æ®åº“æ¨¡å¼ | `local` æˆ– `cloud` | `local` | âœ… æ˜¯ |

#### æœ¬åœ°æ¨¡å¼é…ç½®ï¼ˆSTORAGE_MODE=local æ—¶ä½¿ç”¨ï¼‰

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|--------|---------|
| `DATA_ROOT_DIR` | æ•°æ®æ ¹ç›®å½• | `data` | âœ… æ˜¯ï¼ˆlocal æ¨¡å¼ï¼‰ |
| `USER_DATA_DIR` | ç”¨æˆ·æ•°æ®ç›®å½• | `data/users` | âœ… æ˜¯ï¼ˆlocal æ¨¡å¼ï¼‰ |
| `CHROMA_DB_DIR` | Chroma å‘é‡åº“ç›®å½• | `data/chroma` | âœ… æ˜¯ï¼ˆlocal æ¨¡å¼ï¼‰ |
| `DATABASE_PATH` | SQLite æ•°æ®åº“è·¯å¾„ | `data/database/rag_system.db` | âœ… æ˜¯ï¼ˆlocal æ¨¡å¼ï¼‰ |
| `MAX_FILE_SIZE` | æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ | `10485760` (10MB) | âœ… æ˜¯ |

#### Supabase é…ç½®ï¼ˆSTORAGE_MODE=cloud æˆ– DATABASE_MODE=cloud æ—¶ä½¿ç”¨ï¼‰

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|--------|---------|
| `SUPABASE_URL` | Supabase é¡¹ç›® URL | `https://xxx.supabase.co` | âœ… æ˜¯ï¼ˆcloud æ¨¡å¼ï¼‰ |
| `SUPABASE_KEY` | Supabase Publishable Key | `sb_publishable_xxx` | âœ… æ˜¯ï¼ˆcloud æ¨¡å¼ï¼‰ |
| `SUPABASE_SERVICE_KEY` | Supabase Service Key | `sb_secret_xxx` | âœ… æ˜¯ï¼ˆcloud æ¨¡å¼ï¼‰ |
| `SUPABASE_STORAGE_BUCKET` | Storage Bucket åç§° | `documents` | âœ… æ˜¯ï¼ˆSTORAGE_MODE=cloudï¼‰ |
| `DATABASE_URL` | PostgreSQL è¿æ¥å­—ç¬¦ä¸² | `postgresql://postgres:xxx@db.xxx.supabase.co:5432/postgres` | âœ… æ˜¯ï¼ˆDATABASE_MODE=cloudï¼‰ |

#### Pinecone é…ç½®ï¼ˆVECTOR_DB_MODE=cloud æ—¶ä½¿ç”¨ï¼‰

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|--------|---------|
| `PINECONE_API_KEY` | Pinecone API Key | `xxx-xxx-xxx` | âœ… æ˜¯ï¼ˆVECTOR_DB_MODE=cloudï¼‰ |
| `PINECONE_ENVIRONMENT` | Pinecone ç¯å¢ƒ/åŒºåŸŸ | `us-east-1` æˆ– `us-east1-gcp` | âœ… æ˜¯ï¼ˆVECTOR_DB_MODE=cloudï¼‰ |
| `PINECONE_INDEX_NAME` | Pinecone Index åç§° | `rag-system` | âœ… æ˜¯ï¼ˆVECTOR_DB_MODE=cloudï¼‰ |

#### è®¤è¯é…ç½®ï¼ˆå¿…é¡»ï¼‰

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|--------|---------|
| `AUTH_COOKIE_NAME` | Cookie åç§° | `rag_auth_token` | âœ… æ˜¯ |
| `AUTH_COOKIE_KEY` | Cookie åŠ å¯†å¯†é’¥ | - | âœ… æ˜¯ |
| `AUTH_COOKIE_EXPIRY_DAYS` | Cookie è¿‡æœŸå¤©æ•° | `30` | âœ… æ˜¯ |
| `MIN_PASSWORD_LENGTH` | æœ€å°å¯†ç é•¿åº¦ | `6` | âœ… æ˜¯ |

#### RAG é…ç½®ï¼ˆå¿…é¡»ï¼‰

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|--------|---------|
| `EMBEDDING_MODEL` | Embedding æ¨¡å‹ | `BAAI/bge-large-zh-v1.5` | âœ… æ˜¯ |
| `CHUNK_SIZE` | æ–‡æœ¬å—å¤§å° | `800` | âœ… æ˜¯ |
| `RETRIEVAL_K` | æ£€ç´¢æ•°é‡ | `3` | âœ… æ˜¯ |
| `LLM_MODEL` | LLM æ¨¡å‹ | `MiniMax-M2` | âœ… æ˜¯ |

### å˜é‡æ£€æŸ¥æ–¹æ³•

#### æ‰‹åŠ¨æ£€æŸ¥

1. **æ£€æŸ¥å¿…éœ€å˜é‡**ï¼šç¡®è®¤æ‰€æœ‰å¿…éœ€å˜é‡éƒ½å·²é…ç½®
2. **éªŒè¯å˜é‡æ ¼å¼**ï¼šç¡®ä¿æ²¡æœ‰ `your_xxx` å ä½ç¬¦
3. **æ ¹æ®æ¨¡å¼æ£€æŸ¥**ï¼šæ ¹æ® `STORAGE_MODE`ã€`VECTOR_DB_MODE`ã€`DATABASE_MODE` æ£€æŸ¥å¯¹åº”çš„äº‘æœåŠ¡å˜é‡

#### ç¯å¢ƒå˜é‡æ£€æŸ¥æŠ¥å‘Š

æ ¹æ®ä½ çš„ `.env` æ–‡ä»¶ï¼Œå½“å‰é…ç½®å¦‚ä¸‹ï¼š

**å·²æ­£ç¡®é…ç½®çš„å˜é‡ï¼š**
- âœ… åŸºç¡€é…ç½®ï¼š`ANTHROPIC_API_KEY`ã€`ANTHROPIC_BASE_URL`
- âœ… æ¨¡å¼åˆ‡æ¢ï¼š`STORAGE_MODE`ã€`VECTOR_DB_MODE`ã€`DATABASE_MODE`
- âœ… è®¤è¯é…ç½®ï¼š`AUTH_COOKIE_NAME`ã€`AUTH_COOKIE_KEY`ã€`AUTH_COOKIE_EXPIRY_DAYS`
- âœ… RAGé…ç½®ï¼š`EMBEDDING_MODEL`ã€`CHUNK_SIZE`ã€`RETRIEVAL_K`ã€`LLM_MODEL`
- âœ… æœ¬åœ°å­˜å‚¨é…ç½®ï¼š`DATABASE_PATH`ã€`MAX_FILE_SIZE`

**å¯é€‰å˜é‡ï¼ˆæœ‰é»˜è®¤å€¼ï¼Œä¸å½±å“è¿è¡Œï¼‰ï¼š**
- âšª `MIN_PASSWORD_LENGTH` - é»˜è®¤å€¼ï¼š6
- âšª `DATA_ROOT_DIR` - é»˜è®¤å€¼ï¼šdata
- âšª `USER_DATA_DIR` - é»˜è®¤å€¼ï¼šdata/users
- âšª `CHROMA_DB_DIR` - é»˜è®¤å€¼ï¼šdata/chroma

**äº‘æœåŠ¡å˜é‡æ£€æŸ¥ï¼š**

æ ¹æ®å½“å‰æ¨¡å¼ï¼ˆ`STORAGE_MODE`ã€`VECTOR_DB_MODE`ã€`DATABASE_MODE`ï¼‰ï¼Œæ£€æŸ¥å¯¹åº”çš„äº‘æœåŠ¡å˜é‡ï¼š

- **STORAGE_MODE=cloud** éœ€è¦ï¼š`SUPABASE_URL`ã€`SUPABASE_KEY`ã€`SUPABASE_SERVICE_KEY`ã€`SUPABASE_STORAGE_BUCKET`
- **DATABASE_MODE=cloud** éœ€è¦ï¼š`DATABASE_URL`
- **VECTOR_DB_MODE=cloud** éœ€è¦ï¼š`PINECONE_API_KEY`ã€`PINECONE_ENVIRONMENT`ã€`PINECONE_INDEX_NAME`

#### å˜é‡æ ¼å¼éªŒè¯

**Supabase URL æ ¼å¼**
```
âœ… æ­£ç¡®ï¼šhttps://xxx.supabase.co
âŒ é”™è¯¯ï¼šhttps://your-project-ref.supabase.co
```

**PostgreSQL è¿æ¥å­—ç¬¦ä¸²æ ¼å¼**
```
âœ… æ­£ç¡®ï¼špostgresql://postgres:password@db.xxx.supabase.co:5432/postgres
âŒ é”™è¯¯ï¼špostgresql://postgres:your_password@db.your-project-ref.supabase.co:5432/postgres
```

**Pinecone API Key æ ¼å¼**
```
âœ… æ­£ç¡®ï¼šxxx-xxx-xxxï¼ˆé€šå¸¸æ˜¯å­—æ¯æ•°å­—å’Œè¿å­—ç¬¦ï¼‰
âŒ é”™è¯¯ï¼šyour_pinecone_api_key
```

**Pinecone Environment æ ¼å¼**
```
âœ… æ­£ç¡®ï¼šus-east-1ï¼ˆAWSï¼‰
âœ… æ­£ç¡®ï¼šus-east1-gcpï¼ˆGCPï¼‰
âŒ é”™è¯¯ï¼šus-east-1-gcpï¼ˆæ··åˆæ ¼å¼ï¼‰
```

### æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹ä»£ç æ”¹åŠ¨å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] æ‰€æœ‰å¿…éœ€å˜é‡éƒ½å·²é…ç½®
- [ ] Supabase Storage Bucket å·²åˆ›å»º
- [ ] Supabase PostgreSQL è¡¨å·²åˆå§‹åŒ–
- [ ] Pinecone Index å·²åˆ›å»ºï¼ˆç»´åº¦ 1024ï¼‰
- [ ] å˜é‡æ ¼å¼æ­£ç¡®ï¼ˆæ—  `your_xxx` å ä½ç¬¦ï¼‰
- [ ] å·²å‡†å¤‡å¥½åˆ†æ­¥éª¤æµ‹è¯•

---

## ğŸ“¦ ä¾èµ–åŒ…æ¸…å•

### pyproject.toml

```toml
[tool.poetry]
name = "rag-system"
version = "1.0.0"
description = "RAG æ™ºèƒ½é—®ç­”ç³»ç»Ÿ - Streamlit ç‰ˆ"
authors = ["Your Name <your.email@example.com>"]
package-mode = false

[tool.poetry.dependencies]
python = "^3.10"

# ===== LangChain ç”Ÿæ€ =====
langchain = "^1.0.0"
langchain-anthropic = "^1.0.0"
langchain-core = "^1.0.0"
langchain-community = "^0.4.1"
langchain-chroma = "^1.0.0"
langchain-huggingface = "^1.0.1"
anthropic = "^0.69.0"
tenacity = "^9.1.2"

# ===== å‘é‡æ•°æ®åº“ =====
chromadb = "^1.3.4"

# ===== Embedding æ¨¡å‹ =====
sentence-transformers = "^5.1.2"

# ===== æ–‡æ¡£å¤„ç† =====
pypdf = "^6.2.0"
python-docx = "^1.1.2"
# python-pptx = "^1.0.2"        # PPT æ”¯æŒï¼ˆå¯é€‰ï¼‰

# ===== Streamlit å‰ç«¯ =====
streamlit = "^1.51.0"
# plotly = "^5.24.1"            # æ•°æ®å¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰

# ===== ç”¨æˆ·è®¤è¯ =====
bcrypt = "^5.0.0"
pyjwt = "^2.10.1"

# ===== å·¥å…·åº“ =====
python-dotenv = "^1.0.1"
python-multipart = "^0.0.18"
# pillow = "^11.0.0"            # å›¾ç‰‡å¤„ç†ï¼ˆå¯é€‰ï¼‰

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
```

### å®‰è£…å‘½ä»¤

```bash
# æ–¹æ³• 1ï¼šä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰ä¾èµ–
poetry add streamlit bcrypt pyjwt \
  python-docx python-dotenv python-multipart \
  langchain langchain-anthropic langchain-chroma \
  chromadb pypdf sentence-transformers langchain-huggingface

# æ–¹æ³• 2ï¼šä½¿ç”¨ poetry install
poetry install

# æ–¹æ³• 3ï¼šç”Ÿæˆ requirements.txtï¼ˆå¦‚æœä¸ç”¨ Poetryï¼‰
poetry export -f requirements.txt --output requirements.txt
pip install -r requirements.txt
```

---

## ğŸš€ å¼€å‘è®¡åˆ’

### Phase 0: ç¯å¢ƒå‡†å¤‡ï¼ˆ30åˆ†é’Ÿï¼‰
- [x] RAG æ ¸å¿ƒåŠŸèƒ½å·²å®ç°
- [ ] å®‰è£… Streamlit å’Œè®¤è¯ç›¸å…³ä¾èµ–
- [ ] åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
- [ ] é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ.env æ–‡ä»¶ï¼‰
- [ ] é…ç½® Streamlit ä¸»é¢˜ï¼ˆconfig.tomlï¼‰

### Phase 1: æ•°æ®åº“è®¾è®¡ä¸å®ç°ï¼ˆ2-3å°æ—¶ï¼‰
- [ ] åˆ›å»º SQLite æ•°æ®åº“è¡¨ç»“æ„ï¼ˆinit_db.sqlï¼‰
- [ ] å®ç°æ•°æ®åº“è¿æ¥ç®¡ç†ï¼ˆdb_manager.pyï¼‰
- [ ] å®ç°æ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰
  - [ ] user_dao.py - ç”¨æˆ· CRUD
  - [ ] session_dao.py - ä¼šè¯ CRUD
  - [ ] message_dao.py - æ¶ˆæ¯ CRUD
  - [ ] document_dao.py - æ–‡æ¡£ CRUD
- [ ] æ·»åŠ æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- [ ] å•å…ƒæµ‹è¯•æ•°æ®åº“æ“ä½œ

### Phase 2: ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆ2-3å°æ—¶ï¼‰
- [ ] å®ç°å¯†ç åŠ å¯†å·¥å…·ï¼ˆutils/security.pyï¼‰
- [ ] å®ç°è®¤è¯ç®¡ç†å™¨ï¼ˆauth/authenticator.pyï¼‰
- [ ] åˆ›å»ºç™»å½•é¡µé¢ç»„ä»¶ï¼ˆcomponents/auth_component.pyï¼‰
- [ ] åˆ›å»ºæ³¨å†Œé¡µé¢ç»„ä»¶
- [ ] å®ç°ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆauth/authenticator.pyï¼‰
- [ ] æµ‹è¯•ç™»å½•æ³¨å†Œæµç¨‹

### Phase 3: æ ¸å¿ƒæœåŠ¡å±‚é‡æ„ï¼ˆ2-3å°æ—¶ï¼‰
- [ ] æå– RAG æœåŠ¡ï¼ˆservices/rag_service.pyï¼‰
- [ ] å®ç°å‘é‡åº“æœåŠ¡ï¼ˆservices/vector_store_service.pyï¼‰
  - [ ] å¤šç”¨æˆ·å‘é‡åº“éš”ç¦»
  - [ ] ç”¨æˆ·çº§åˆ« collection ç®¡ç†
- [ ] å®ç°æ–‡æ¡£æœåŠ¡ï¼ˆservices/document_service.pyï¼‰
  - [ ] æ–‡ä»¶ä¸Šä¼ å’Œä¿å­˜
  - [ ] æ–‡æ¡£è§£æå’Œåˆ†å—ï¼ˆutils/text_splitter.pyï¼‰
  - [ ] å‘é‡åŒ–å’Œå…¥åº“
- [ ] å®ç°ä¼šè¯æœåŠ¡ï¼ˆservices/session_service.pyï¼‰
  - [ ] ä¼šè¯åˆ›å»ºå’Œç®¡ç†
  - [ ] æ¶ˆæ¯ä¿å­˜å’ŒåŠ è½½
  - [ ] ä¼šè¯æ ‡é¢˜è‡ªåŠ¨ç”Ÿæˆ

### Phase 4: æ–‡æ¡£ç®¡ç†ç•Œé¢ï¼ˆ2-3å°æ—¶ï¼‰
- [ ] æ–‡æ¡£ä¸Šä¼ ç»„ä»¶ï¼ˆæ”¯æŒå¤šæ ¼å¼ï¼‰
- [ ] æ–‡æ¡£åˆ—è¡¨å±•ç¤ºï¼ˆcomponents/document_manager.pyï¼‰
- [ ] æ–‡æ¡£åˆ é™¤åŠŸèƒ½ï¼ˆåŒæ­¥åˆ é™¤å‘é‡ï¼‰
- [ ] æ–‡æ¡£é¢„è§ˆåŠŸèƒ½
- [ ] æ–‡æ¡£å¤„ç†çŠ¶æ€å±•ç¤ºï¼ˆä¸Šä¼ ä¸­ã€å¤„ç†ä¸­ã€å®Œæˆï¼‰

### Phase 5: æ™ºèƒ½é—®ç­”ç•Œé¢ï¼ˆ3-4å°æ—¶ï¼‰
- [ ] å¯¹è¯ç•Œé¢ç»„ä»¶ï¼ˆcomponents/chat_interface.pyï¼‰
- [ ] æ¶ˆæ¯å±•ç¤ºï¼ˆç”¨æˆ·/AI æ¶ˆæ¯æ°”æ³¡ï¼‰
- [ ] æ£€ç´¢ç»“æœå¯è§†åŒ–ï¼ˆç›¸ä¼¼åº¦ã€æ¥æºæ–‡æ¡£ï¼‰
- [ ] æ€è€ƒè¿‡ç¨‹å±•ç¤ºï¼ˆæ­¥éª¤åŒ–å±•å¼€ï¼‰
- [ ] ç­”æ¡ˆ Markdown æ¸²æŸ“
- [ ] æµå¼è¾“å‡ºï¼ˆå¯é€‰ï¼‰

### Phase 6: ä¼šè¯ç®¡ç†åŠŸèƒ½ï¼ˆ2-3å°æ—¶ï¼‰
- [ ] ä¼šè¯åˆ—è¡¨ç»„ä»¶ï¼ˆcomponents/session_list.pyï¼‰
  - [ ] æŒ‰æ—¶é—´åˆ†ç»„å±•ç¤º
  - [ ] ç½®é¡¶ä¼šè¯æ˜¾ç¤º
- [ ] ä¼šè¯åˆ‡æ¢åŠŸèƒ½
- [ ] ä¼šè¯æ ‡é¢˜ç¼–è¾‘
- [ ] ä¼šè¯æœç´¢å’Œè¿‡æ»¤
- [ ] ä¼šè¯ç½®é¡¶åŠŸèƒ½
- [ ] ä¼šè¯åˆ é™¤åŠŸèƒ½
- [ ] ä¼šè¯å¯¼å‡ºï¼ˆMarkdown/JSONï¼‰

### Phase 7: ä¾§è¾¹æ ä¸ä¸»åº”ç”¨é›†æˆï¼ˆ2-3å°æ—¶ï¼‰
- [ ] åˆ›å»º app.py ä¸»å…¥å£
- [ ] å®ç°ä¾§è¾¹æ ï¼ˆcomponents/sidebar.pyï¼‰
  - [ ] ç”¨æˆ·ä¿¡æ¯å±•ç¤º
  - [ ] çŸ¥è¯†åº“ç»Ÿè®¡
  - [ ] ä¼šè¯åˆ—è¡¨
  - [ ] ä¸»é¢˜åˆ‡æ¢
  - [ ] ç³»ç»Ÿè®¾ç½®
- [ ] å®ç°è·¯ç”±é€»è¾‘ï¼ˆç™»å½•æ€ vs æœªç™»å½•ï¼‰
- [ ] é›†æˆæ‰€æœ‰ç»„ä»¶
- [ ] é¡µé¢åˆ‡æ¢ï¼ˆçŸ¥è¯†åº“ç®¡ç† â‡„ æ™ºèƒ½é—®ç­”ï¼‰

### Phase 8: UI ä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆ3-4å°æ—¶ï¼‰
- [ ] å“åº”å¼å¸ƒå±€ä¼˜åŒ–
- [ ] åŠ è½½çŠ¶æ€å’Œè¿›åº¦æ¡
  - [ ] æ–‡æ¡£ä¸Šä¼ è¿›åº¦
  - [ ] å‘é‡åŒ–è¿›åº¦
  - [ ] æŸ¥è¯¢å¤„ç†è¿›åº¦
- [ ] é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º
- [ ] æ€§èƒ½ä¼˜åŒ–
  - [ ] å‘é‡åº“ç¼“å­˜ï¼ˆ@st.cache_resourceï¼‰
  - [ ] æ•°æ®åº“è¿æ¥æ± 
  - [ ] æ–‡æ¡£å…ƒæ•°æ®ç¼“å­˜
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] å¤šç”¨æˆ·éš”ç¦»æµ‹è¯•
- [ ] ä¸»é¢˜åˆ‡æ¢æµ‹è¯•ï¼ˆæ·±è‰²/æµ…è‰²ï¼‰

### Phase 9: æ–‡æ¡£å’Œéƒ¨ç½²ï¼ˆ1-2å°æ—¶ï¼‰
- [ ] è¡¥å……ä»£ç æ³¨é‡Š
- [ ] ç¼–å†™ä½¿ç”¨æ–‡æ¡£
- [ ] å‡†å¤‡ç¤ºä¾‹æ•°æ®
- [ ] Docker é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] éƒ¨ç½²æŒ‡å—

---

**é¢„è®¡æ€»å¼€å‘æ—¶é—´ï¼š17-24 å°æ—¶**

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### 1. å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœä» Gitï¼‰
git clone <repository_url>
cd rag

# ä½¿ç”¨ Poetry å®‰è£…ä¾èµ–
poetry install

# æˆ–è€…ä½¿ç”¨ pip
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å¿…è¦é…ç½®
vim .env

# ç”Ÿæˆ Cookie åŠ å¯†å¯†é’¥
python -c "import secrets; print(secrets.token_urlsafe(32))"
# å°†è¾“å‡ºçš„å¯†é’¥å¡«å…¥ .env çš„ AUTH_COOKIE_KEY
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ•°æ®åº“ä¼šåœ¨é¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨åˆ›å»º
# æˆ–è€…æ‰‹åŠ¨åˆå§‹åŒ–
poetry run python -c "from database.db_manager import init_database; init_database()"
```

### 4. è¿è¡Œåº”ç”¨

```bash
# å¼€å‘æ¨¡å¼
poetry run streamlit run app.py

# æŒ‡å®šç«¯å£
poetry run streamlit run app.py --server.port 8501

# ç”Ÿäº§æ¨¡å¼ï¼ˆåå°è¿è¡Œï¼‰
nohup poetry run streamlit run app.py --server.headless true &
```

### 5. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8501`

### 6. æ³¨å†Œå’Œç™»å½•

- é¦–æ¬¡è®¿é—®ä¼šæ˜¾ç¤ºç™»å½•é¡µé¢
- ç‚¹å‡»ã€Œæ³¨å†Œæ–°è´¦å·ã€åˆ›å»ºç”¨æˆ·
- æ³¨å†Œåè‡ªåŠ¨ç™»å½•è¿›å…¥ä¸»ç•Œé¢

---

## ğŸ”’ å®‰å…¨æ€§è®¾è®¡

### 1. å¯†ç å®‰å…¨

```python
# ä½¿ç”¨ bcrypt åŠ å¯†å¯†ç 
import bcrypt

def hash_password(password: str) -> str:
    salt = bcrypt.gensalt(rounds=12)
    return bcrypt.hashpw(password.encode('utf-8'), salt).decode('utf-8')

def verify_password(password: str, hashed: str) -> bool:
    return bcrypt.checkpw(password.encode('utf-8'), hashed.encode('utf-8'))
```

**å®‰å…¨è¦ç‚¹ï¼š**
- bcrypt è‡ªåŠ¨åŠ ç›ï¼ˆsaltï¼‰
- ä½¿ç”¨ 12 è½®å“ˆå¸Œï¼ˆrounds=12ï¼‰
- å¯†ç æ°¸è¿œä¸ä»¥æ˜æ–‡å­˜å‚¨

### 2. SQL æ³¨å…¥é˜²æŠ¤

```python
# âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
cursor.execute("SELECT * FROM users WHERE username = ?", (username,))

# âŒ æ°¸è¿œä¸è¦æ‹¼æ¥ SQL
# cursor.execute(f"SELECT * FROM users WHERE username = '{username}'")
```

### 3. è·¨ç”¨æˆ·è®¿é—®æ§åˆ¶

```python
def get_document(doc_id: str, user_id: int):
    """æ¯æ¬¡æ“ä½œéƒ½éªŒè¯ç”¨æˆ·æƒé™"""
    doc = db.execute("""
        SELECT * FROM documents 
        WHERE doc_id = ? AND user_id = ?
    """, (doc_id, user_id)).fetchone()
    
    if not doc:
        raise PermissionError("æ— æƒè®¿é—®è¯¥æ–‡æ¡£")
    
    return doc
```

### 4. æ–‡ä»¶ä¸Šä¼ å®‰å…¨

```python
ALLOWED_EXTENSIONS = {'.pdf', '.txt', '.md', '.docx'}
MAX_FILE_SIZE = 20 * 1024 * 1024  # 20MB

def validate_file(file):
    # æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
    ext = os.path.splitext(file.name)[1].lower()
    if ext not in ALLOWED_EXTENSIONS:
        raise ValueError(f"ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: {ext}")
    
    # æ£€æŸ¥æ–‡ä»¶å¤§å°
    file.seek(0, os.SEEK_END)
    size = file.tell()
    file.seek(0)
    if size > MAX_FILE_SIZE:
        raise ValueError(f"æ–‡ä»¶è¿‡å¤§: {size} bytes")
    
    return True
```

### 5. Cookie å®‰å…¨

- ä½¿ç”¨éšæœºç”Ÿæˆçš„å¯†é’¥åŠ å¯† Cookie
- è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼ˆ30å¤©ï¼‰
- HTTPS ç¯å¢ƒä¸‹å¯ç”¨ `Secure` æ ‡å¿—

### 6. ç¯å¢ƒå˜é‡ä¿æŠ¤

```bash
# .gitignore ä¸­å¿½ç•¥æ•æ„Ÿæ–‡ä»¶
.env
data/
logs/
*.db
```

---

## ğŸŒŸ æŠ€æœ¯äº®ç‚¹

### 1. æ®µè½çº§åˆ«åˆ†å—ç­–ç•¥

æ™ºèƒ½åˆ†å—ç®—æ³•ï¼ˆå®ç°äº `utils/text_splitter.py`ï¼‰ï¼š

```python
def split_by_paragraphs(text):
    """
    ä¼˜ç‚¹ï¼š
    - ä¿ç•™æ®µè½è¯­ä¹‰å®Œæ•´æ€§
    - é¿å…å¥å­è¢«æˆªæ–­
    - æ™ºèƒ½è¯†åˆ«ä¸­æ–‡æ–‡æ¡£ç»“æ„
    - åŠ¨æ€è°ƒæ•´åˆ†å—å¤§å°
    """
    chunks = []
    paragraphs = re.split(r'\n\s*\n', text)
    
    # è¯¦ç»†å®ç°è§ utils/text_splitter.py
    return chunks
```

**æ•ˆæœå¯¹æ¯”ï¼š**

| æ–¹æ¡ˆ | å¹³å‡å—å¤§å° | è¯­ä¹‰å®Œæ•´æ€§ | æ£€ç´¢å‡†ç¡®åº¦ |
|------|-----------|-----------|-----------|
| å›ºå®šå­—ç¬¦åˆ†å— | 800å­— | â­â­ | 75% |
| å›ºå®šå¥å­åˆ†å— | ä¸å®š | â­â­â­ | 80% |
| **æ®µè½åˆ†å—ï¼ˆæœ¬æ–¹æ¡ˆï¼‰** | 527å­— | â­â­â­â­â­ | 89% |

### 2. BGE-large-zh-v1.5 æ¨¡å‹

ä¸šç•Œé¢†å…ˆçš„ä¸­æ–‡ Embedding æ¨¡å‹ï¼š

- **æ¨¡å‹å¤§å°**ï¼š326M
- **å‘é‡ç»´åº¦**ï¼š1024
- **ä¼˜ç‚¹**ï¼š
  - ä¸­æ–‡è¯­ä¹‰ç†è§£èƒ½åŠ›å¼º
  - æ”¯æŒè·¨è¯­è¨€æ£€ç´¢
  - é«˜ç²¾åº¦ç›¸ä¼¼åº¦è®¡ç®—

### 3. Streamlit æ€§èƒ½ä¼˜åŒ–

```python
# ç¼“å­˜å‘é‡åº“å®ä¾‹
@st.cache_resource
def load_vector_store(user_id):
    return Chroma(
        collection_name=f"user_{user_id}_docs",
        embedding_function=embeddings,
        persist_directory=f"./data/chroma/user_{user_id}"
    )

# ç¼“å­˜æ•°æ®æŸ¥è¯¢
@st.cache_data(ttl=300)  # ç¼“å­˜5åˆ†é’Ÿ
def get_user_documents(user_id):
    return db.query_documents(user_id)
```

### 4. å¤šç”¨æˆ·æ•°æ®éš”ç¦»

ä¸‰å±‚éš”ç¦»æœºåˆ¶ç¡®ä¿æ•°æ®å®‰å…¨ï¼š

1. **æ•°æ®åº“éš”ç¦»**ï¼šuser_id å­—æ®µè¿‡æ»¤
2. **æ–‡ä»¶ç³»ç»Ÿéš”ç¦»**ï¼šç‹¬ç«‹ç”¨æˆ·ç›®å½•
3. **å‘é‡åº“éš”ç¦»**ï¼šç‹¬ç«‹ Collection

### 5. ä¼šè¯æŒä¹…åŒ–

æ‰€æœ‰å¯¹è¯å†å²æ°¸ä¹…ä¿å­˜ï¼š

- æ”¯æŒè·¨ä¼šè¯æŸ¥è¯¢
- å¯¼å‡ºå†å²è®°å½•
- æ•°æ®ç»Ÿè®¡åˆ†æ

---

## ğŸ“ å­¦ä¹ èµ„æº

### LangChain æ–‡æ¡£
- [LangChain å®˜æ–¹æ–‡æ¡£](https://python.langchain.com/)
- [Chroma æ–‡æ¡£](https://docs.trychroma.com/)

### Streamlit æ–‡æ¡£
- [Streamlit å®˜æ–¹æ–‡æ¡£](https://docs.streamlit.io/)
- [Streamlit Authenticator](https://github.com/mkhorasani/Streamlit-Authenticator)

### BGE æ¨¡å‹
- [BGE-large-zh-v1.5](https://huggingface.co/BAAI/bge-large-zh-v1.5)

---

## ğŸ“§ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

ç³»ç»Ÿå·²é›†æˆæ€§èƒ½ç›‘æ§åŠŸèƒ½ï¼Œå¯ä»¥ç›‘æ§æ‰€æœ‰è¿œç¨‹äº‘æœåŠ¡çš„è°ƒç”¨æ—¶é—´ï¼š

### ç›‘æ§èŒƒå›´

- **Supabase Storage**ï¼šæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤æ“ä½œ
- **Pinecone**ï¼šå‘é‡æ·»åŠ ã€åˆ é™¤ã€æœç´¢ã€ç»Ÿè®¡æ“ä½œ
- **PostgreSQL**ï¼šæŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°æ“ä½œ

### æ—¥å¿—æ ¼å¼

```
[æ€§èƒ½ç›‘æ§] âœ…/âŒ æœåŠ¡å | æ“ä½œå | è€—æ—¶(ms) | è¯¦æƒ…
```

### æ—¥å¿—çº§åˆ«

- **> 5ç§’**ï¼šWARNINGï¼ˆè­¦å‘Šï¼‰
- **> 2ç§’**ï¼šINFOï¼ˆä¿¡æ¯ï¼‰
- **<= 2ç§’**ï¼šDEBUGï¼ˆè°ƒè¯•ï¼‰

### æŸ¥çœ‹æ—¥å¿—

- **æ§åˆ¶å°è¾“å‡º**ï¼šç›´æ¥æŸ¥çœ‹ç»ˆç«¯
- **æ—¥å¿—æ–‡ä»¶**ï¼šæŸ¥çœ‹ `logs/` ç›®å½•ï¼ˆå¦‚æœé…ç½®äº†æ–‡ä»¶æ—¥å¿—ï¼‰

---

## ğŸ› é”™è¯¯å¤„ç†

ç³»ç»Ÿå·²å®ç°ç»Ÿä¸€çš„æ•°æ®åº“é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

### é”™è¯¯å¤„ç†å·¥å…·

- `utils/db_error_handler.py` - ç»Ÿä¸€é”™è¯¯å¤„ç†å·¥å…·
- `DatabaseConnectionError` - è‡ªå®šä¹‰å¼‚å¸¸ç±»
- `safe_db_operation` - å®‰å…¨æ•°æ®åº“æ“ä½œåŒ…è£…å™¨
- `show_db_error_ui` - UI é”™è¯¯æ˜¾ç¤ºå‡½æ•°

### é”™è¯¯å¤„ç†æµç¨‹

```
æ•°æ®åº“æ“ä½œ
  â†“
ConnectionError æŠ›å‡º
  â†“
safe_db_operation æ•è·
  â†“
show_db_error_ui æ˜¾ç¤ºå‹å¥½æç¤º
  â†“
è¿”å›é»˜è®¤å€¼ï¼Œåº”ç”¨ç»§ç»­è¿è¡Œ âœ…
```

### å·²åº”ç”¨ä½ç½®

- `app.py` - ç”¨æˆ·ä¿¡æ¯å’Œç»Ÿè®¡
- `components/chat_interface.py` - ä¼šè¯ä¿¡æ¯
- `components/document_manager.py` - æ–‡æ¡£ç®¡ç†
- `services/document_service.py` - æ–‡æ¡£æœåŠ¡

---

## âš¡ PostgreSQL æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### ğŸ” é—®é¢˜åˆ†æ

æ ¹æ®æ€§èƒ½ç›‘æ§æ—¥å¿—ï¼Œæ¯æ¬¡ PostgreSQL æŸ¥è¯¢éƒ½éœ€è¦ **2000ms+**ï¼Œä¸»è¦åŸå› æ˜¯ï¼š

1. **æ¯æ¬¡æŸ¥è¯¢éƒ½åˆ›å»ºæ–°è¿æ¥**
   - `get_connection()` æ¯æ¬¡éƒ½è°ƒç”¨ `psycopg2.connect()`
   - æŸ¥è¯¢åç«‹å³å…³é—­è¿æ¥ï¼ˆ`get_cursor()` çš„ finally å—ä¸­ï¼‰

2. **è¿æ¥å»ºç«‹å¼€é”€å¤§**
   ```
   æ¯æ¬¡è¿æ¥éœ€è¦ï¼š
   - TCP æ¡æ‰‹ï¼š~100-200ms
   - SSL/TLS æ¡æ‰‹ï¼š~300-500ms
   - æ•°æ®åº“è®¤è¯ï¼š~100-200ms
   - ç½‘ç»œå¾€è¿”å»¶è¿Ÿï¼š~500-1000msï¼ˆSupabase åœ¨äº‘ç«¯ï¼‰
   = æ€»è®¡ï¼š1000-2000ms+
   ```

3. **æ²¡æœ‰è¿æ¥å¤ç”¨**
   - æ²¡æœ‰è¿æ¥æ± 
   - æ²¡æœ‰æŒä¹…è¿æ¥
   - æ¯æ¬¡éƒ½æ˜¯å…¨æ–°çš„è¿æ¥

### ğŸ’¡ ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1ï¼šè¿æ¥æ± ï¼ˆæ¨èï¼‰â­

**åŸç†**ï¼šä½¿ç”¨ `psycopg2.pool.SimpleConnectionPool` é¢„åˆ›å»ºè¿æ¥ï¼Œå¤ç”¨è¿æ¥ã€‚

**ä¼˜åŠ¿**ï¼š
- âœ… è¿æ¥å¤ç”¨ï¼Œé¿å…æ¯æ¬¡å»ºç«‹è¿æ¥çš„å¼€é”€
- âœ… è‡ªåŠ¨ç®¡ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸ
- âœ… æ”¯æŒè¿æ¥å¥åº·æ£€æŸ¥
- âœ… çº¿ç¨‹å®‰å…¨ï¼ˆStreamlit å¤šçº¿ç¨‹ç¯å¢ƒï¼‰

**é¢„æœŸæ•ˆæœ**ï¼š
- é¦–æ¬¡è¿æ¥ï¼š~2000msï¼ˆå»ºç«‹è¿æ¥æ± ï¼‰
- åç»­æŸ¥è¯¢ï¼š~50-200msï¼ˆå¤ç”¨è¿æ¥ï¼‰
- **æ€§èƒ½æå‡ï¼š10-40å€**

**å®æ–½è¦ç‚¹**ï¼š

1. **è¿æ¥æ± é…ç½®**
   ```python
   from psycopg2 import pool
   
   # è¿æ¥æ± å‚æ•°
   minconn = 2      # æœ€å°è¿æ¥æ•°ï¼ˆä¿æŒæ´»è·ƒè¿æ¥ï¼‰
   maxconn = 10     # æœ€å¤§è¿æ¥æ•°ï¼ˆå³°å€¼å¹¶å‘ï¼‰
   ```

2. **è¿æ¥æ± åˆå§‹åŒ–**
   ```python
   class DatabaseManager:
       def __init__(self):
           if self.db_type == "postgresql":
               # åˆ›å»ºè¿æ¥æ± 
               self._connection_pool = pool.SimpleConnectionPool(
                   minconn=2,
                   maxconn=10,
                   dsn=config.DATABASE_URL
               )
   ```

3. **ä»è¿æ¥æ± è·å–è¿æ¥**
   ```python
   def get_connection(self):
       if self.db_type == "postgresql":
           # ä»è¿æ¥æ± è·å–è¿æ¥
           conn = self._connection_pool.getconn()
           # æ£€æŸ¥è¿æ¥æ˜¯å¦æœ‰æ•ˆ
           if not self._is_connection_alive(conn):
               conn.close()
               conn = psycopg2.connect(config.DATABASE_URL)
           return conn
   ```

4. **å½’è¿˜è¿æ¥åˆ°æ± **
   ```python
   def return_connection(self, conn):
       if self.db_type == "postgresql":
           # å½’è¿˜è¿æ¥åˆ°æ± ï¼ˆä¸å…³é—­ï¼‰
           self._connection_pool.putconn(conn)
   ```

5. **è¿æ¥å¥åº·æ£€æŸ¥**
   ```python
   def _is_connection_alive(self, conn):
       """æ£€æŸ¥è¿æ¥æ˜¯å¦æœ‰æ•ˆ"""
       try:
           cursor = conn.cursor()
           cursor.execute("SELECT 1")
           cursor.close()
           return True
       except:
           return False
   ```

**æ³¨æ„äº‹é¡¹**ï¼š
- è¿æ¥æ± åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆ›å»º
- è¿æ¥ä½¿ç”¨åå½’è¿˜åˆ°æ± ï¼Œä¸å…³é—­
- éœ€è¦å¤„ç†è¿æ¥å¤±æ•ˆçš„æƒ…å†µï¼ˆè‡ªåŠ¨é‡è¿ï¼‰
- åº”ç”¨å…³é—­æ—¶åº”è¯¥å…³é—­è¿æ¥æ± 

---

#### æ–¹æ¡ˆ2ï¼šæŒä¹…è¿æ¥ï¼ˆç®€å•æ–¹æ¡ˆï¼‰

**åŸç†**ï¼šä¿æŒä¸€ä¸ªå…¨å±€è¿æ¥ï¼Œåœ¨åº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…å¤ç”¨ã€‚

**ä¼˜åŠ¿**ï¼š
- âœ… å®ç°ç®€å•
- âœ… é¿å…è¿æ¥å»ºç«‹å¼€é”€
- âœ… é€‚åˆå•çº¿ç¨‹åœºæ™¯

**åŠ£åŠ¿**ï¼š
- âš ï¸ è¿æ¥å¯èƒ½å¤±æ•ˆï¼ˆéœ€è¦é‡è¿æœºåˆ¶ï¼‰
- âš ï¸ ä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯
- âš ï¸ è¿æ¥é•¿æ—¶é—´ç©ºé—²å¯èƒ½è¢«æœåŠ¡å™¨å…³é—­

**é¢„æœŸæ•ˆæœ**ï¼š
- é¦–æ¬¡è¿æ¥ï¼š~2000ms
- åç»­æŸ¥è¯¢ï¼š~50-200ms
- **æ€§èƒ½æå‡ï¼š10-40å€**

**å®æ–½è¦ç‚¹**ï¼š

1. **å…¨å±€è¿æ¥å˜é‡**
   ```python
   class DatabaseManager:
       def __init__(self):
           self._persistent_conn = None
   ```

2. **è·å–æŒä¹…è¿æ¥**
   ```python
   def get_connection(self):
       if self.db_type == "postgresql":
           if self._persistent_conn is None or self._persistent_conn.closed:
               # åˆ›å»ºæ–°è¿æ¥
               self._persistent_conn = psycopg2.connect(config.DATABASE_URL)
           return self._persistent_conn
   ```

3. **è¿æ¥å¥åº·æ£€æŸ¥**
   ```python
   def _check_connection(self, conn):
       try:
           conn.cursor().execute("SELECT 1")
           return True
       except:
           return False
   ```

---

#### æ–¹æ¡ˆ3ï¼šæŸ¥è¯¢ä¼˜åŒ–

**ä¼˜åŒ–ç‚¹**ï¼š

1. **åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ**
   ```sql
   -- âŒ æ…¢ï¼šæŸ¥è¯¢æ‰€æœ‰å­—æ®µ
   SELECT * FROM documents WHERE user_id = ?
   
   -- âœ… å¿«ï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
   SELECT doc_id, filename, file_size FROM documents WHERE user_id = ?
   ```

2. **ä½¿ç”¨ LIMIT é™åˆ¶ç»“æœ**
   ```sql
   -- âœ… å·²ä¼˜åŒ–ï¼šä½¿ç”¨ LIMIT
   SELECT * FROM sessions WHERE user_id = ? LIMIT 50
   ```

3. **é¿å… N+1 æŸ¥è¯¢**
   ```python
   # âŒ æ…¢ï¼šå¾ªç¯æŸ¥è¯¢
   for session in sessions:
       messages = get_messages(session.id)  # N æ¬¡æŸ¥è¯¢
   
   # âœ… å¿«ï¼šæ‰¹é‡æŸ¥è¯¢
   session_ids = [s.id for s in sessions]
   all_messages = get_messages_batch(session_ids)  # 1 æ¬¡æŸ¥è¯¢
   ```

4. **ä½¿ç”¨ç´¢å¼•**
   - æ£€æŸ¥æ‰€æœ‰ `WHERE` æ¡ä»¶å­—æ®µæ˜¯å¦æœ‰ç´¢å¼•
   - æ£€æŸ¥ `ORDER BY` å­—æ®µæ˜¯å¦æœ‰ç´¢å¼•

**å½“å‰ç´¢å¼•æ£€æŸ¥**ï¼š

âœ… å·²æœ‰ç´¢å¼•ï¼š
- `users.username` - âœ… `idx_username`
- `sessions.user_id, updated_at` - âœ… `idx_user_sessions`
- `messages.session_id, created_at` - âœ… `idx_session_messages`
- `documents.user_id, upload_at` - âœ… `idx_user_docs`

---

#### æ–¹æ¡ˆ4ï¼šæ‰¹é‡æ“ä½œä¼˜åŒ–

**åŸç†**ï¼šåˆå¹¶å¤šä¸ªæŸ¥è¯¢ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ã€‚

**ä¼˜åŒ–åœºæ™¯**ï¼š

1. **æ‰¹é‡æ’å…¥**
   ```python
   # âŒ æ…¢ï¼šå¾ªç¯æ’å…¥
   for item in items:
       db.execute_insert("INSERT INTO ...", (item,))  # N æ¬¡æŸ¥è¯¢
   
   # âœ… å¿«ï¼šæ‰¹é‡æ’å…¥
   db.execute_batch("INSERT INTO ... VALUES %s", items)  # 1 æ¬¡æŸ¥è¯¢
   ```

2. **äº‹åŠ¡æ‰¹é‡æäº¤**
   ```python
   # âœ… ä½¿ç”¨äº‹åŠ¡æ‰¹é‡æäº¤
   with db.get_cursor() as cursor:
       for item in items:
           cursor.execute("INSERT INTO ...", (item,))
       # ä¸€æ¬¡æ€§æäº¤
   ```

3. **åˆå¹¶ç»Ÿè®¡æŸ¥è¯¢**
   ```python
   # âŒ æ…¢ï¼šå¤šæ¬¡æŸ¥è¯¢
   doc_count = get_document_count(user_id)
   storage = get_total_storage(user_id)
   chunks = get_total_chunks(user_id)
   
   # âœ… å¿«ï¼šä¸€æ¬¡æŸ¥è¯¢
   stats = db.execute_one("""
       SELECT 
           COUNT(*) as doc_count,
           SUM(file_size) as storage,
           SUM(chunk_count) as chunks
       FROM documents
       WHERE user_id = ? AND status = 'active'
   """, (user_id,))
   ```

---

### ğŸ¯ æ¨èå®æ–½é¡ºåº

#### ç¬¬ä¸€æ­¥ï¼šè¿æ¥æ± ï¼ˆæœ€é‡è¦ï¼‰â­

**ä¼˜å…ˆçº§**ï¼šæœ€é«˜  
**é¢„è®¡æ—¶é—´**ï¼š1-2å°æ—¶  
**é¢„æœŸæ•ˆæœ**ï¼š2000ms â†’ 50-200msï¼ˆ**10-40å€æå‡**ï¼‰

**å®æ–½æ­¥éª¤**ï¼š
1. ä¿®æ”¹ `DatabaseManager` ç±»ï¼Œæ·»åŠ è¿æ¥æ± æ”¯æŒ
2. å®ç°è¿æ¥æ± åˆå§‹åŒ–å’Œè¿æ¥è·å–/å½’è¿˜
3. æ·»åŠ è¿æ¥å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡è¿
4. æµ‹è¯•è¿æ¥æ± åŠŸèƒ½

#### ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ä¼˜åŒ–

**ä¼˜å…ˆçº§**ï¼šé«˜  
**é¢„è®¡æ—¶é—´**ï¼š1å°æ—¶  
**é¢„æœŸæ•ˆæœ**ï¼šé¢å¤– 20-50% æå‡

**å®æ–½æ­¥éª¤**ï¼š
1. æ£€æŸ¥æ‰€æœ‰ SQL æŸ¥è¯¢ï¼ŒåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
2. åˆå¹¶ç»Ÿè®¡æŸ¥è¯¢ï¼ˆå¦‚ `get_user_stats`ï¼‰
3. æ£€æŸ¥å¹¶æ·»åŠ ç¼ºå¤±çš„ç´¢å¼•
4. ä¼˜åŒ– N+1 æŸ¥è¯¢é—®é¢˜

#### ç¬¬ä¸‰æ­¥ï¼šæ‰¹é‡æ“ä½œ

**ä¼˜å…ˆçº§**ï¼šä¸­  
**é¢„è®¡æ—¶é—´**ï¼š1å°æ—¶  
**é¢„æœŸæ•ˆæœ**ï¼šæ‰¹é‡æ“ä½œåœºæ™¯ä¸‹é¢å¤–æå‡

**å®æ–½æ­¥éª¤**ï¼š
1. è¯†åˆ«æ‰¹é‡æ“ä½œåœºæ™¯
2. å®ç°æ‰¹é‡æ’å…¥/æ›´æ–°æ–¹æ³•
3. ä¼˜åŒ–å¾ªç¯æŸ¥è¯¢ä¸ºæ‰¹é‡æŸ¥è¯¢

---

### ğŸ“Š æ€§èƒ½å¯¹æ¯”é¢„æœŸ

#### ä¼˜åŒ–å‰
```
å•æ¬¡æŸ¥è¯¢ï¼š2000ms+
- è¿æ¥å»ºç«‹ï¼š1500ms
- æŸ¥è¯¢æ‰§è¡Œï¼š500ms
```

#### ä¼˜åŒ–åï¼ˆè¿æ¥æ± ï¼‰
```
é¦–æ¬¡æŸ¥è¯¢ï¼š2000msï¼ˆå»ºç«‹è¿æ¥æ± ï¼‰
åç»­æŸ¥è¯¢ï¼š50-200ms
- ä»æ± è·å–è¿æ¥ï¼š<10ms
- æŸ¥è¯¢æ‰§è¡Œï¼š40-190ms
```

#### æ€§èƒ½æå‡
- **é¦–æ¬¡æŸ¥è¯¢**ï¼šæ— å˜åŒ–ï¼ˆéœ€è¦å»ºç«‹è¿æ¥æ± ï¼‰
- **åç»­æŸ¥è¯¢**ï¼š**10-40å€æå‡**ï¼ˆ2000ms â†’ 50-200msï¼‰

---

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **è¿æ¥æ± ç”Ÿå‘½å‘¨æœŸ**
   - è¿æ¥æ± åœ¨ `DatabaseManager.__init__()` æ—¶åˆ›å»º
   - åº”ç”¨å…³é—­æ—¶åº”è¯¥å…³é—­è¿æ¥æ± 
   - Streamlit åº”ç”¨é‡å¯æ—¶ä¼šé‡æ–°åˆ›å»ºè¿æ¥æ± 

2. **è¿æ¥æ³„æ¼é˜²æŠ¤**
   - ç¡®ä¿æ‰€æœ‰è¿æ¥éƒ½æ­£ç¡®å½’è¿˜åˆ°æ± 
   - ä½¿ç”¨ `try-finally` ç¡®ä¿è¿æ¥å½’è¿˜
   - ç›‘æ§è¿æ¥æ± ä½¿ç”¨æƒ…å†µ

3. **è¿æ¥è¶…æ—¶å¤„ç†**
   - è®¾ç½®åˆç†çš„è¿æ¥è¶…æ—¶æ—¶é—´
   - å¤„ç†è¿æ¥è·å–è¶…æ—¶çš„æƒ…å†µ
   - æä¾›é™çº§æ–¹æ¡ˆï¼ˆè¿”å›é”™è¯¯æˆ–ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼‰

4. **çº¿ç¨‹å®‰å…¨**
   - `SimpleConnectionPool` æ˜¯çº¿ç¨‹å®‰å…¨çš„
   - Streamlit è™½ç„¶ä¸»è¦æ˜¯å•çº¿ç¨‹ï¼Œä½†å¯èƒ½æœ‰åå°ä»»åŠ¡
   - ç¡®ä¿è¿æ¥æ± åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ­£å¸¸å·¥ä½œ

---

### ğŸ“ˆ ç›‘æ§å’ŒéªŒè¯

#### æ€§èƒ½ç›‘æ§

ä¼˜åŒ–åï¼Œæ€§èƒ½ç›‘æ§æ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š
```
[æ€§èƒ½ç›‘æ§] âœ… PostgreSQL | execute_query | 50-200ms | type=SELECT
[æ€§èƒ½ç›‘æ§] âœ… PostgreSQL | execute_one | 50-200ms | type=SELECT
```

#### éªŒè¯æ–¹æ³•

1. **å¯¹æ¯”æµ‹è¯•**
   - ä¼˜åŒ–å‰ï¼šè®°å½•å¹³å‡æŸ¥è¯¢æ—¶é—´
   - ä¼˜åŒ–åï¼šè®°å½•å¹³å‡æŸ¥è¯¢æ—¶é—´
   - è®¡ç®—æ€§èƒ½æå‡æ¯”ä¾‹

2. **å‹åŠ›æµ‹è¯•**
   - è¿ç»­æ‰§è¡Œ 100 æ¬¡æŸ¥è¯¢
   - è§‚å¯Ÿè¿æ¥æ± ä½¿ç”¨æƒ…å†µ
   - æ£€æŸ¥æ˜¯å¦æœ‰è¿æ¥æ³„æ¼

3. **ç›‘æ§æŒ‡æ ‡**
   - è¿æ¥æ± ä½¿ç”¨ç‡
   - è¿æ¥è·å–æ—¶é—´
   - æŸ¥è¯¢æ‰§è¡Œæ—¶é—´
   - è¿æ¥å¤±æ•ˆæ¬¡æ•°

---

**æœ€åæ›´æ–°ï¼š2025-01-23**

**ç‰ˆæœ¬ï¼š1.0.0**


---

## ğŸš€ Deployment Checklist

## Streamlit Cloud éƒ¨ç½²æ£€æŸ¥æ¸…å•

### âœ… éƒ¨ç½²å‰å‡†å¤‡

#### 1. æ–‡ä»¶å‡†å¤‡

- [ ] **ç”Ÿæˆ requirements.txt**
  ```bash
  poetry export -f requirements.txt --output requirements.txt --without-hashes
  ```
  å¦‚æœ `poetry export` ä¸å¯ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨ä» `pyproject.toml` æå–ä¾èµ–

- [ ] **åˆ›å»º .streamlit/config.toml**
  ```bash
  mkdir -p .streamlit
  # å¤åˆ¶ STREAMLIT_CLOUD_DEPLOYMENT.md ä¸­çš„é…ç½®å†…å®¹
  ```

- [ ] **æ›´æ–° .gitignore**
  ç¡®ä¿åŒ…å«ï¼š
  ```
  .env
  .streamlit/secrets.toml
  data/
  logs/
  __pycache__/
  *.pyc
  ```

- [ ] **éªŒè¯ä»£ç **
  - [ ] ç¡®ä¿æ‰€æœ‰æ¨¡å¼è®¾ç½®ä¸º `cloud`ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡ï¼‰
  - [ ] ç¡®ä¿æ²¡æœ‰ç¡¬ç¼–ç çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„
  - [ ] ç¡®ä¿æ—¥å¿—é…ç½®ä½¿ç”¨ `stream=sys.stdout`ï¼ˆå·²ç¡®è®¤ âœ…ï¼‰

#### 2. ç¯å¢ƒå˜é‡å‡†å¤‡

å‡†å¤‡ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼ˆå°†åœ¨ Streamlit Cloud Secrets ä¸­é…ç½®ï¼‰ï¼š

##### æ ¸å¿ƒé…ç½®
- [ ] `ANTHROPIC_API_KEY`
- [ ] `ANTHROPIC_BASE_URL`
- [ ] `STORAGE_MODE=cloud`
- [ ] `VECTOR_DB_MODE=cloud`
- [ ] `DATABASE_MODE=cloud`

##### Supabase é…ç½®
- [ ] `SUPABASE_URL`
- [ ] `SUPABASE_KEY`
- [ ] `SUPABASE_SERVICE_KEY`
- [ ] `SUPABASE_STORAGE_BUCKET`
- [ ] `DATABASE_URL`

##### Pinecone é…ç½®
- [ ] `PINECONE_API_KEY`
- [ ] `PINECONE_ENVIRONMENT`
- [ ] `PINECONE_INDEX_NAME`

##### è®¤è¯é…ç½®
- [ ] `AUTH_COOKIE_NAME`
- [ ] `AUTH_COOKIE_KEY`ï¼ˆ32ä½éšæœºå¯†é’¥ï¼‰
- [ ] `AUTH_COOKIE_EXPIRY_DAYS`
- [ ] `MIN_PASSWORD_LENGTH`

##### RAG é…ç½®
- [ ] `EMBEDDING_MODEL`
- [ ] `EMBEDDING_DEVICE`
- [ ] `NORMALIZE_EMBEDDINGS`
- [ ] `CHUNK_SIZE`
- [ ] `CHUNK_OVERLAP`
- [ ] `RETRIEVAL_K`
- [ ] `LLM_MODEL`
- [ ] `LLM_TEMPERATURE`
- [ ] `LLM_MAX_TOKENS`

#### 3. Git æäº¤

- [ ] æ·»åŠ æ–°æ–‡ä»¶åˆ° Git
  ```bash
  git add requirements.txt .streamlit/config.toml .gitignore
  ```

- [ ] æäº¤æ›´æ”¹
  ```bash
  git commit -m "å‡†å¤‡ Streamlit Cloud éƒ¨ç½²ï¼šæ·»åŠ  requirements.txt å’Œ Streamlit é…ç½®"
  ```

- [ ] æ¨é€åˆ°è¿œç¨‹ä»“åº“
  ```bash
  git push origin main
  ```

---

### ğŸš€ Streamlit Cloud éƒ¨ç½²

#### æ­¥éª¤ 1ï¼šåˆ›å»ºåº”ç”¨

- [ ] è®¿é—® [share.streamlit.io](https://share.streamlit.io)
- [ ] ç™»å½• GitHub è´¦å·
- [ ] ç‚¹å‡» "New app"
- [ ] é€‰æ‹©ä»“åº“ï¼š`your-username/rag`
- [ ] é€‰æ‹©åˆ†æ”¯ï¼š`main`
- [ ] ä¸»æ–‡ä»¶è·¯å¾„ï¼š`app.py`
- [ ] åº”ç”¨ URLï¼šè‡ªå®šä¹‰ï¼ˆå¦‚ `rag-system`ï¼‰

#### æ­¥éª¤ 2ï¼šé…ç½® Secrets

- [ ] ç‚¹å‡» "Advanced settings"
- [ ] åœ¨ "Secrets" åŒºåŸŸï¼Œç²˜è´´æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ˆTOML æ ¼å¼ï¼‰
- [ ] å‚è€ƒ `STREAMLIT_CLOUD_DEPLOYMENT.md` ä¸­çš„æ ¼å¼

#### æ­¥éª¤ 3ï¼šéƒ¨ç½²

- [ ] ç‚¹å‡» "Deploy"
- [ ] ç­‰å¾…æ„å»ºå®Œæˆï¼ˆ2-5 åˆ†é’Ÿï¼‰
- [ ] æ£€æŸ¥æ„å»ºæ—¥å¿—ï¼Œç¡®è®¤æ— é”™è¯¯

---

### âœ… éƒ¨ç½²åéªŒè¯

#### åŠŸèƒ½æµ‹è¯•

- [ ] **ç”¨æˆ·è®¤è¯**
  - [ ] ç”¨æˆ·æ³¨å†Œ
  - [ ] ç”¨æˆ·ç™»å½•
  - [ ] è‡ªåŠ¨ç™»å½•ï¼ˆCookieï¼‰

- [ ] **æ–‡æ¡£ç®¡ç†**
  - [ ] æ–‡æ¡£ä¸Šä¼ ï¼ˆPDF/Word/TXTï¼‰
  - [ ] æ–‡æ¡£åˆ—è¡¨æ˜¾ç¤º
  - [ ] æ–‡æ¡£åˆ é™¤
  - [ ] æ–‡æ¡£é¢„è§ˆ

- [ ] **å‘é‡æ£€ç´¢**
  - [ ] æ–‡æ¡£ä¸Šä¼ åå‘é‡åŒ–æˆåŠŸ
  - [ ] å‘é‡æ£€ç´¢åŠŸèƒ½æ­£å¸¸
  - [ ] å¤šç”¨æˆ·æ•°æ®éš”ç¦»æ­£ç¡®

- [ ] **æ™ºèƒ½é—®ç­”**
  - [ ] åˆ›å»ºæ–°ä¼šè¯
  - [ ] å‘é€æ¶ˆæ¯
  - [ ] æ¥æ”¶ AI å›å¤
  - [ ] æ˜¾ç¤ºæ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µ
  - [ ] ä¼šè¯å†å²ä¿å­˜

- [ ] **æ•°æ®åº“æ“ä½œ**
  - [ ] ç”¨æˆ·æ•°æ®ä¿å­˜åˆ° PostgreSQL
  - [ ] ä¼šè¯æ•°æ®ä¿å­˜
  - [ ] æ¶ˆæ¯æ•°æ®ä¿å­˜
  - [ ] æ–‡æ¡£å…ƒæ•°æ®ä¿å­˜

#### æ€§èƒ½æ£€æŸ¥

- [ ] é¦–æ¬¡åŠ è½½æ—¶é—´ï¼ˆEmbedding æ¨¡å‹åŠ è½½ï¼‰
- [ ] æ•°æ®åº“æŸ¥è¯¢å“åº”æ—¶é—´
- [ ] å‘é‡æ£€ç´¢å“åº”æ—¶é—´
- [ ] æ–‡ä»¶ä¸Šä¼ é€Ÿåº¦

#### é”™è¯¯æ£€æŸ¥

- [ ] æŸ¥çœ‹ Streamlit Cloud æ—¥å¿—
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æˆ–è­¦å‘Š
- [ ] ç¡®è®¤æ‰€æœ‰ç¯å¢ƒå˜é‡å·²æ­£ç¡®åŠ è½½

---

### ğŸ”§ æ•…éšœæ’æŸ¥

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå‚è€ƒ `STREAMLIT_CLOUD_DEPLOYMENT.md` ä¸­çš„æ•…éšœæ’æŸ¥ç« èŠ‚ã€‚

#### å¸¸è§é—®é¢˜

- [ ] **ä¾èµ–å®‰è£…å¤±è´¥** â†’ æ£€æŸ¥ `requirements.txt` æ ¼å¼
- [ ] **ç¯å¢ƒå˜é‡æœªåŠ è½½** â†’ æ£€æŸ¥ Secrets é…ç½®å’Œ TOML æ ¼å¼
- [ ] **æ•°æ®åº“è¿æ¥å¤±è´¥** â†’ æ£€æŸ¥ `DATABASE_URL` å’Œ Supabase è®¾ç½®
- [ ] **æ–‡ä»¶ä¸Šä¼ å¤±è´¥** â†’ æ£€æŸ¥ Supabase Storage é…ç½®
- [ ] **å‘é‡æ£€ç´¢å¤±è´¥** â†’ æ£€æŸ¥ Pinecone é…ç½®å’Œ Index åç§°

---

### ğŸ“ éƒ¨ç½²å®Œæˆç¡®è®¤

- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
- [ ] æ— é”™è¯¯æ—¥å¿—
- [ ] åº”ç”¨ URL å¯æ­£å¸¸è®¿é—®
- [ ] å¤šç”¨æˆ·æµ‹è¯•é€šè¿‡

---

**éƒ¨ç½²æ—¥æœŸï¼š** ___________  
**éƒ¨ç½²äººå‘˜ï¼š** ___________  
**åº”ç”¨ URLï¼š** ___________  

---

### ğŸ“š å‚è€ƒæ–‡æ¡£

- è¯¦ç»†éƒ¨ç½²æ–¹æ¡ˆï¼š`STREAMLIT_CLOUD_DEPLOYMENT.md`
- é¡¹ç›® READMEï¼š`README.md`
- ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š`config_template.txt`



---

## ğŸ“– Deployment Guide

## æœ¬åœ°æ›´æ–°å’Œéƒ¨ç½²æŒ‡å—

### ğŸ“‹ æœ¬åœ°æ›´æ–°ä¾èµ–

#### æ–¹æ³• 1ï¼šä½¿ç”¨ Poetryï¼ˆæ¨èï¼‰

å¦‚æœä½ ä½¿ç”¨ Poetry ç®¡ç†ä¾èµ–ï¼š

```bash
## 1. æ›´æ–° pyproject.toml ä¸­çš„ä¾èµ–ï¼ˆå·²å®Œæˆï¼‰
## pinecone-client å·²æ”¹ä¸º pinecone

## 2. æ›´æ–° Poetry é”æ–‡ä»¶å’Œè™šæ‹Ÿç¯å¢ƒ
poetry update pinecone

## 3. éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
poetry show pinecone
```

#### æ–¹æ³• 2ï¼šä½¿ç”¨ pipï¼ˆå¦‚æœä¸ç”¨ Poetryï¼‰

```bash
## 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœæœ‰ï¼‰
source venv/bin/activate  # Linux/Mac
## æˆ–
venv\Scripts\activate  # Windows

## 2. å¸è½½æ—§åŒ…
pip uninstall pinecone-client -y

## 3. å®‰è£…æ–°åŒ…
pip install "pinecone>=6.0.0,<7.0.0"

## 4. éªŒè¯å®‰è£…
pip show pinecone
```

#### æ–¹æ³• 3ï¼šä» requirements.txt å®‰è£…

```bash
## 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœæœ‰ï¼‰
source venv/bin/activate  # Linux/Mac

## 2. å¸è½½æ—§åŒ…
pip uninstall pinecone-client -y

## 3. ä» requirements.txt å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt

## 4. éªŒè¯
pip list | grep pinecone
```

### ğŸ§ª æœ¬åœ°æµ‹è¯•

åœ¨éƒ¨ç½²åˆ° Streamlit Cloud ä¹‹å‰ï¼Œå»ºè®®å…ˆåœ¨æœ¬åœ°æµ‹è¯•ï¼š

```bash
## 1. ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²æ›´æ–°
poetry install  # æˆ– pip install -r requirements.txt

## 2. è¿è¡Œåº”ç”¨
poetry run streamlit run app.py
## æˆ–
streamlit run app.py

## 3. æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
## è®¿é—® http://localhost:8501
## ç¡®è®¤æ²¡æœ‰ Pinecone ç›¸å…³çš„é”™è¯¯
```

### ğŸš€ éƒ¨ç½²åˆ° Streamlit Cloud

#### æ­¥éª¤ 1ï¼šæäº¤ä»£ç åˆ° Git

```bash
## 1. æ£€æŸ¥æ›´æ”¹çŠ¶æ€
git status

## 2. æ·»åŠ ä¿®æ”¹çš„æ–‡ä»¶
git add requirements.txt pyproject.toml STREAMLIT_CLOUD_ISSUE_FIX.md

## 3. æäº¤æ›´æ”¹
git commit -m "ä¿®å¤ Pinecone åŒ…å†²çªï¼šå°† pinecone-client æ›¿æ¢ä¸º pinecone"

## 4. æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main
```

#### æ­¥éª¤ 2ï¼šStreamlit Cloud è‡ªåŠ¨éƒ¨ç½²

Streamlit Cloud ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç æ›´æ”¹å¹¶è§¦å‘é‡æ–°éƒ¨ç½²ï¼š

1. **ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²**ï¼ˆé€šå¸¸ 1-2 åˆ†é’Ÿï¼‰
   - è®¿é—®ä½ çš„ Streamlit Cloud åº”ç”¨é¡µé¢
   - æŸ¥çœ‹å³ä¸Šè§’çš„éƒ¨ç½²çŠ¶æ€

2. **æ£€æŸ¥éƒ¨ç½²æ—¥å¿—**
   - ç‚¹å‡»åº”ç”¨å³ä¸Šè§’çš„ "Manage app"
   - æŸ¥çœ‹ "Logs" æ ‡ç­¾é¡µ
   - ç¡®è®¤æ²¡æœ‰é”™è¯¯ä¿¡æ¯

3. **éªŒè¯åº”ç”¨è¿è¡Œ**
   - è®¿é—®åº”ç”¨ URL
   - ç¡®è®¤åº”ç”¨æ­£å¸¸å¯åŠ¨
   - æµ‹è¯•åŸºæœ¬åŠŸèƒ½

#### æ­¥éª¤ 3ï¼šæ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœè‡ªåŠ¨éƒ¨ç½²æ²¡æœ‰è§¦å‘ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼š

1. è®¿é—® [Streamlit Cloud Dashboard](https://share.streamlit.io)
2. æ‰¾åˆ°ä½ çš„åº”ç”¨
3. ç‚¹å‡» "â‹®" (ä¸‰ä¸ªç‚¹) èœå•
4. é€‰æ‹© "Reboot app" æˆ– "Redeploy"

### ğŸ” éªŒè¯éƒ¨ç½²

#### æ£€æŸ¥æ¸…å•

- [ ] ä»£ç å·²æ¨é€åˆ° Git è¿œç¨‹ä»“åº“
- [ ] Streamlit Cloud æ˜¾ç¤º "Deploying" æˆ– "Running" çŠ¶æ€
- [ ] éƒ¨ç½²æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯ä¿¡æ¯
- [ ] åº”ç”¨å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] ç™»å½•é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] æ²¡æœ‰ Pinecone ç›¸å…³çš„é”™è¯¯

#### å¸¸è§é—®é¢˜æ’æŸ¥

##### é—®é¢˜ 1ï¼šéƒ¨ç½²å¤±è´¥

**æ£€æŸ¥**ï¼š
- æŸ¥çœ‹ Streamlit Cloud æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
- ç¡®è®¤ `requirements.txt` æ ¼å¼æ­£ç¡®
- ç¡®è®¤æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬å…¼å®¹

**è§£å†³**ï¼š
```bash
## æ£€æŸ¥ requirements.txt æ ¼å¼
cat requirements.txt

## éªŒè¯ Python ç‰ˆæœ¬å…¼å®¹æ€§
## Streamlit Cloud ä½¿ç”¨ Python 3.13.9
```

##### é—®é¢˜ 2ï¼šåº”ç”¨å¯åŠ¨ä½†åŠŸèƒ½å¼‚å¸¸

**æ£€æŸ¥**ï¼š
- æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯
- ç¡®è®¤ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®
- æ£€æŸ¥äº‘æœåŠ¡è¿æ¥ï¼ˆSupabaseã€Pineconeï¼‰

**è§£å†³**ï¼š
- æ£€æŸ¥ Streamlit Cloud Secrets é…ç½®
- ç¡®è®¤æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡éƒ½å·²è®¾ç½®

##### é—®é¢˜ 3ï¼šä¾èµ–å®‰è£…å¤±è´¥

**æ£€æŸ¥**ï¼š
- æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ä¸­çš„ pip å®‰è£…é”™è¯¯
- ç¡®è®¤ä¾èµ–ç‰ˆæœ¬å…¼å®¹æ€§

**è§£å†³**ï¼š
```bash
## æœ¬åœ°æµ‹è¯•ä¾èµ–å®‰è£…
pip install -r requirements.txt

## å¦‚æœæœ¬åœ°æˆåŠŸä½† Cloud å¤±è´¥ï¼Œæ£€æŸ¥ Python ç‰ˆæœ¬å·®å¼‚
```

### ğŸ“ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤

#### ä¸€é”®éƒ¨ç½²è„šæœ¬

åˆ›å»º `deploy.sh` æ–‡ä»¶ï¼š

```bash
#!/bin/bash
## å¿«é€Ÿéƒ¨ç½²è„šæœ¬

echo "ğŸ” æ£€æŸ¥ Git çŠ¶æ€..."
git status

echo "ğŸ“¦ æ›´æ–°ä¾èµ–..."
## å¦‚æœä½¿ç”¨ Poetry
poetry update pinecone
## æˆ–ä½¿ç”¨ pip
## pip install -r requirements.txt

echo "âœ… æµ‹è¯•åº”ç”¨..."
poetry run streamlit run app.py &
STREAMLIT_PID=$!
sleep 5
kill $STREAMLIT_PID

echo "ğŸ“¤ æäº¤ä»£ç ..."
git add requirements.txt pyproject.toml
git commit -m "ä¿®å¤ Pinecone åŒ…å†²çª"
git push origin main

echo "ğŸš€ ä»£ç å·²æ¨é€ï¼ŒStreamlit Cloud å°†è‡ªåŠ¨éƒ¨ç½²"
echo "â³ è¯·ç­‰å¾… 2-5 åˆ†é’Ÿï¼Œç„¶åæ£€æŸ¥åº”ç”¨çŠ¶æ€"
```

ä½¿ç”¨ï¼š
```bash
chmod +x deploy.sh
./deploy.sh
```

### ğŸ¯ éƒ¨ç½²åéªŒè¯

éƒ¨ç½²å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹éªŒè¯ï¼š

1. **åº”ç”¨å¯åŠ¨éªŒè¯**
   - âœ… åº”ç”¨å¯ä»¥è®¿é—®
   - âœ… æ²¡æœ‰å¯åŠ¨é”™è¯¯
   - âœ… ç™»å½•é¡µé¢æ­£å¸¸æ˜¾ç¤º

2. **åŠŸèƒ½éªŒè¯**
   - âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•åŠŸèƒ½
   - âœ… æ–‡æ¡£ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚æœä½¿ç”¨ Supabase Storageï¼‰
   - âœ… å‘é‡æ£€ç´¢åŠŸèƒ½ï¼ˆå¦‚æœä½¿ç”¨ Pineconeï¼‰
   - âœ… æ•°æ®åº“æ“ä½œï¼ˆå¦‚æœä½¿ç”¨ PostgreSQLï¼‰

3. **æ€§èƒ½éªŒè¯**
   - âœ… åº”ç”¨å“åº”é€Ÿåº¦æ­£å¸¸
   - âœ… æ²¡æœ‰è¶…æ—¶é”™è¯¯
   - âœ… èµ„æºä½¿ç”¨åˆç†

### ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†éƒ¨ç½²æ–¹æ¡ˆ**ï¼š`STREAMLIT_CLOUD_DEPLOYMENT.md`
- **éƒ¨ç½²æ£€æŸ¥æ¸…å•**ï¼š`DEPLOYMENT_CHECKLIST.md`
- **é—®é¢˜ä¿®å¤è®°å½•**ï¼š`STREAMLIT_CLOUD_ISSUE_FIX.md`

---

**æœ€åæ›´æ–°**ï¼š2025-11-24



---

## â˜ï¸ Streamlit Cloud Deployment

## Streamlit Cloud éƒ¨ç½²æ–¹æ¡ˆ

### ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å°† RAG æ™ºèƒ½é—®ç­”ç³»ç»Ÿéƒ¨ç½²åˆ° Streamlit Cloudã€‚ç”±äº Streamlit Cloud æ˜¯æ— çŠ¶æ€çš„äº‘æœåŠ¡ï¼Œéœ€è¦ç¡®ä¿æ‰€æœ‰æ•°æ®å­˜å‚¨éƒ½ä½¿ç”¨äº‘æœåŠ¡ï¼Œä¸èƒ½ä¾èµ–æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚

---

### âœ… éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

#### 1. äº‘æœåŠ¡é…ç½®ç¡®è®¤

ç¡®ä¿ä»¥ä¸‹äº‘æœåŠ¡å·²æ­£ç¡®é…ç½®å¹¶å¯ç”¨ï¼š

- [x] **Supabase Storage**ï¼šæ–‡ä»¶å­˜å‚¨æœåŠ¡å·²é…ç½®
- [x] **Supabase PostgreSQL**ï¼šæ•°æ®åº“æœåŠ¡å·²é…ç½®
- [x] **Pinecone**ï¼šå‘é‡åº“æœåŠ¡å·²é…ç½®
- [x] **MiniMax API**ï¼šLLM API å·²é…ç½®

#### 2. ç¯å¢ƒå˜é‡å‡†å¤‡

å‡†å¤‡æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼ˆå°†åœ¨ Streamlit Cloud Secrets ä¸­é…ç½®ï¼‰ï¼š

##### å¿…éœ€å˜é‡ï¼ˆæ‰€æœ‰æ¨¡å¼ï¼‰

```bash
## API é…ç½®
ANTHROPIC_API_KEY=sk-xxx
ANTHROPIC_BASE_URL=https://api.minimaxi.com/anthropic

## æ¨¡å¼åˆ‡æ¢ï¼ˆå¿…é¡»å…¨éƒ¨è®¾ç½®ä¸º cloudï¼‰
STORAGE_MODE=cloud
VECTOR_DB_MODE=cloud
DATABASE_MODE=cloud

## Supabase é…ç½®
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=sb_publishable_xxx
SUPABASE_SERVICE_KEY=sb_secret_xxx
SUPABASE_STORAGE_BUCKET=rag
DATABASE_URL=postgresql://postgres:xxx@db.xxx.supabase.co:5432/postgres

## Pinecone é…ç½®
PINECONE_API_KEY=xxx-xxx-xxx
PINECONE_ENVIRONMENT=us-east-1
PINECONE_INDEX_NAME=rag-system

## è®¤è¯é…ç½®
AUTH_COOKIE_NAME=rag_auth_token
AUTH_COOKIE_KEY=xxxï¼ˆ32ä½éšæœºå¯†é’¥ï¼‰
AUTH_COOKIE_EXPIRY_DAYS=30
MIN_PASSWORD_LENGTH=6

## RAG é…ç½®
EMBEDDING_MODEL=BAAI/bge-large-zh-v1.5
EMBEDDING_DEVICE=cpu
NORMALIZE_EMBEDDINGS=true
CHUNK_SIZE=800
CHUNK_OVERLAP=100
RETRIEVAL_K=3
LLM_MODEL=MiniMax-M2
LLM_TEMPERATURE=0
LLM_MAX_TOKENS=2000
```

---

### ğŸ”§ éœ€è¦åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶

#### 1. `requirements.txt` â­ **å¿…éœ€**

Streamlit Cloud éœ€è¦ `requirements.txt` æ–‡ä»¶æ¥å®‰è£…ä¾èµ–ã€‚è™½ç„¶é¡¹ç›®ä½¿ç”¨ Poetryï¼Œä½†éœ€è¦ç”Ÿæˆ `requirements.txt`ã€‚

**ç”Ÿæˆæ–¹æ³•ï¼š**

```bash
## æ–¹æ³•1ï¼šä½¿ç”¨ poetry exportï¼ˆæ¨èï¼‰
poetry export -f requirements.txt --output requirements.txt --without-hashes

## æ–¹æ³•2ï¼šæ‰‹åŠ¨åˆ›å»ºï¼ˆå¦‚æœ poetry export ä¸å¯ç”¨ï¼‰
## ä» pyproject.toml æå–ä¾èµ–å¹¶è½¬æ¢ä¸º requirements.txt æ ¼å¼
```

**æ–‡ä»¶ä½ç½®ï¼š** é¡¹ç›®æ ¹ç›®å½• `/requirements.txt`

#### 2. `.streamlit/config.toml` â­ **æ¨è**

åˆ›å»º Streamlit é…ç½®æ–‡ä»¶ï¼Œä¼˜åŒ– Cloud éƒ¨ç½²è®¾ç½®ã€‚

**æ–‡ä»¶ä½ç½®ï¼š** `.streamlit/config.toml`

**é…ç½®å†…å®¹ï¼š**

```toml
[server]
headless = true
port = 8501
enableCORS = false
enableXsrfProtection = true

[browser]
gatherUsageStats = false
serverAddress = "localhost"

[theme]
primaryColor = "#1976D2"
backgroundColor = "#121212"
secondaryBackgroundColor = "#1E1E1E"
textColor = "#FFFFFF"
font = "sans serif"
```

#### 3. `.streamlit/secrets.toml` âš ï¸ **ä¸è¦æäº¤åˆ° Git**

æ­¤æ–‡ä»¶ç”¨äºæœ¬åœ°å¼€å‘ï¼Œ**ä¸è¦æäº¤åˆ° Git**ã€‚Streamlit Cloud ä½¿ç”¨ Web UI é…ç½® Secretsã€‚

**æ–‡ä»¶ä½ç½®ï¼š** `.streamlit/secrets.toml`ï¼ˆæ·»åŠ åˆ° `.gitignore`ï¼‰

**æœ¬åœ°å¼€å‘ä½¿ç”¨ï¼š**

```toml
## æœ¬åœ°å¼€å‘æ—¶ä½¿ç”¨ï¼Œä¸è¦æäº¤åˆ° Git
ANTHROPIC_API_KEY = "sk-xxx"
STORAGE_MODE = "cloud"
VECTOR_DB_MODE = "cloud"
DATABASE_MODE = "cloud"
## ... å…¶ä»–ç¯å¢ƒå˜é‡
```

#### 4. `.gitignore` æ›´æ–°

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶/ç›®å½•ä¸è¢«æäº¤ï¼š

```
## ç¯å¢ƒå˜é‡å’Œå¯†é’¥
.env
.streamlit/secrets.toml

## æœ¬åœ°æ•°æ®ç›®å½•ï¼ˆCloud éƒ¨ç½²ä¸éœ€è¦ï¼‰
data/
logs/

## Python ç¼“å­˜
__pycache__/
*.pyc
*.pyo
*.pyd
.Python

## Poetry
poetry.lock  # å¯é€‰ï¼šå¦‚æœä½¿ç”¨ requirements.txtï¼Œå¯ä»¥ä¸æäº¤
```

#### 5. ä»£ç ä¿®æ”¹ç‚¹

##### 5.1 æ—¥å¿—æ–‡ä»¶è·¯å¾„å¤„ç†

**é—®é¢˜ï¼š** Streamlit Cloud å¯èƒ½æ²¡æœ‰å†™å…¥æƒé™ï¼Œæˆ–è·¯å¾„ä¸å­˜åœ¨ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** ä¿®æ”¹æ—¥å¿—é…ç½®ï¼Œä½¿ç”¨ä¸´æ—¶ç›®å½•æˆ–ç¦ç”¨æ–‡ä»¶æ—¥å¿—ã€‚

**éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶ï¼š**
- `utils/config.py`ï¼šç¡®ä¿ `LOG_FILE` ä½¿ç”¨ä¸´æ—¶ç›®å½•æˆ–ç¦ç”¨
- æ‰€æœ‰ä½¿ç”¨ `logs/` ç›®å½•çš„åœ°æ–¹

**å»ºè®®ä¿®æ”¹ï¼š**

```python
## utils/config.py
import tempfile
import os

## å¦‚æœ LOG_FILE æŒ‡å‘ logs/ ç›®å½•ï¼Œæ”¹ä¸ºä¸´æ—¶ç›®å½•æˆ–ç¦ç”¨
if os.getenv("LOG_FILE", "").startswith("logs/"):
    # Streamlit Cloud ç¯å¢ƒï¼Œä½¿ç”¨ä¸´æ—¶ç›®å½•æˆ–ç¦ç”¨æ–‡ä»¶æ—¥å¿—
    LOG_FILE = os.path.join(tempfile.gettempdir(), "app.log") if os.getenv("ENABLE_FILE_LOG", "false").lower() == "true" else None
else:
    LOG_FILE = os.getenv("LOG_FILE", None)
```

##### 5.2 ç¡®ä¿ä¸ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ

**æ£€æŸ¥ç‚¹ï¼š**
- âœ… `STORAGE_MODE=cloud`ï¼šä½¿ç”¨ Supabase Storage
- âœ… `VECTOR_DB_MODE=cloud`ï¼šä½¿ç”¨ Pinecone
- âœ… `DATABASE_MODE=cloud`ï¼šä½¿ç”¨ Supabase PostgreSQL

**éªŒè¯æ–¹æ³•ï¼š**
- ç¡®ä¿ä»£ç ä¸­æ²¡æœ‰ç¡¬ç¼–ç çš„ `data/` è·¯å¾„è®¿é—®
- ç¡®ä¿æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½é€šè¿‡æœåŠ¡å±‚ï¼ˆ`document_service.py`ã€`vector_store_service.py`ï¼‰

##### 5.3 ç¯å¢ƒå˜é‡åŠ è½½ä¼˜åŒ–

**å½“å‰å®ç°ï¼š** `utils/config.py` ä½¿ç”¨ `load_dotenv()` åŠ è½½ `.env` æ–‡ä»¶

**Streamlit Cloudï¼š** ç¯å¢ƒå˜é‡é€šè¿‡ Secrets é…ç½®ï¼Œä¸éœ€è¦ `.env` æ–‡ä»¶

**å»ºè®®ï¼š** ä¿æŒç°æœ‰å®ç°ï¼Œ`load_dotenv()` åœ¨ Streamlit Cloud ä¸­ä¼šé™é»˜å¤±è´¥ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ï¼‰ï¼Œä¸å½±å“ä»ç¯å¢ƒå˜é‡è¯»å–ã€‚

---

### ğŸš€ éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šå‡†å¤‡ä»£ç 

1. **ç”Ÿæˆ requirements.txt**

```bash
cd /Users/jonas/tech/projects/rag
poetry export -f requirements.txt --output requirements.txt --without-hashes
```

2. **åˆ›å»º .streamlit/config.toml**

```bash
mkdir -p .streamlit
## åˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆè§ä¸Šæ–¹é…ç½®å†…å®¹ï¼‰
```

3. **æ›´æ–° .gitignore**

ç¡®ä¿ `.env`ã€`.streamlit/secrets.toml`ã€`data/`ã€`logs/` å·²æ·»åŠ åˆ° `.gitignore`

4. **æäº¤ä»£ç åˆ° Git**

```bash
git add requirements.txt .streamlit/config.toml .gitignore
git commit -m "å‡†å¤‡ Streamlit Cloud éƒ¨ç½²"
git push origin main
```

#### æ­¥éª¤ 2ï¼šåœ¨ Streamlit Cloud åˆ›å»ºåº”ç”¨

1. **è®¿é—® Streamlit Cloud**
   - ç™»å½• [share.streamlit.io](https://share.streamlit.io)
   - ç‚¹å‡» "New app"

2. **é…ç½®åº”ç”¨**
   - **Repository**ï¼šé€‰æ‹©ä½ çš„ GitHub ä»“åº“
   - **Branch**ï¼š`main`
   - **Main file path**ï¼š`app.py`
   - **App URL**ï¼šè‡ªå®šä¹‰ï¼ˆå¦‚ `rag-system`ï¼‰

3. **é…ç½® Secrets**
   - ç‚¹å‡» "Advanced settings"
   - åœ¨ "Secrets" åŒºåŸŸï¼Œæ·»åŠ æ‰€æœ‰ç¯å¢ƒå˜é‡
   - **æ ¼å¼ï¼š** TOML æ ¼å¼

```toml
ANTHROPIC_API_KEY = "sk-xxx"
ANTHROPIC_BASE_URL = "https://api.minimaxi.com/anthropic"
STORAGE_MODE = "cloud"
VECTOR_DB_MODE = "cloud"
DATABASE_MODE = "cloud"
SUPABASE_URL = "https://xxx.supabase.co"
SUPABASE_KEY = "sb_publishable_xxx"
SUPABASE_SERVICE_KEY = "sb_secret_xxx"
SUPABASE_STORAGE_BUCKET = "rag"
DATABASE_URL = "postgresql://postgres:xxx@db.xxx.supabase.co:5432/postgres"
PINECONE_API_KEY = "xxx-xxx-xxx"
PINECONE_ENVIRONMENT = "us-east-1"
PINECONE_INDEX_NAME = "rag-system"
AUTH_COOKIE_NAME = "rag_auth_token"
AUTH_COOKIE_KEY = "xxx"
AUTH_COOKIE_EXPIRY_DAYS = "30"
MIN_PASSWORD_LENGTH = "6"
EMBEDDING_MODEL = "BAAI/bge-large-zh-v1.5"
EMBEDDING_DEVICE = "cpu"
NORMALIZE_EMBEDDINGS = "true"
CHUNK_SIZE = "800"
CHUNK_OVERLAP = "100"
RETRIEVAL_K = "3"
LLM_MODEL = "MiniMax-M2"
LLM_TEMPERATURE = "0"
LLM_MAX_TOKENS = "2000"
```

4. **éƒ¨ç½²åº”ç”¨**
   - ç‚¹å‡» "Deploy"
   - ç­‰å¾…æ„å»ºå®Œæˆï¼ˆé€šå¸¸ 2-5 åˆ†é’Ÿï¼‰

#### æ­¥éª¤ 3ï¼šéªŒè¯éƒ¨ç½²

1. **æ£€æŸ¥æ„å»ºæ—¥å¿—**
   - æŸ¥çœ‹æ˜¯å¦æœ‰ä¾èµ–å®‰è£…é”™è¯¯
   - ç¡®è®¤æ‰€æœ‰ç¯å¢ƒå˜é‡å·²åŠ è½½

2. **åŠŸèƒ½æµ‹è¯•**
   - âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
   - âœ… æ–‡æ¡£ä¸Šä¼ ï¼ˆéªŒè¯ Supabase Storageï¼‰
   - âœ… å‘é‡æ£€ç´¢ï¼ˆéªŒè¯ Pineconeï¼‰
   - âœ… æ•°æ®åº“æ“ä½œï¼ˆéªŒè¯ PostgreSQLï¼‰
   - âœ… æ™ºèƒ½é—®ç­”åŠŸèƒ½

3. **æ€§èƒ½ç›‘æ§**
   - æ£€æŸ¥é¦–æ¬¡åŠ è½½æ—¶é—´ï¼ˆEmbedding æ¨¡å‹åŠ è½½ï¼‰
   - æ£€æŸ¥æ•°æ®åº“è¿æ¥æ€§èƒ½
   - æ£€æŸ¥å‘é‡æ£€ç´¢å“åº”æ—¶é—´

---

### âš ï¸ æ³¨æ„äº‹é¡¹

#### 1. æ–‡ä»¶å¤§å°é™åˆ¶

- **Streamlit Cloud é™åˆ¶ï¼š** å•ä¸ªæ–‡ä»¶æœ€å¤§ 200MB
- **Supabase Storageï¼š** æ ¹æ®ä½ çš„è®¡åˆ’é™åˆ¶ï¼ˆå…è´¹ç‰ˆé€šå¸¸ 1GBï¼‰
- **å»ºè®®ï¼š** åœ¨æ–‡æ¡£ä¸Šä¼ æ—¶æ£€æŸ¥æ–‡ä»¶å¤§å°

#### 2. å†·å¯åŠ¨æ—¶é—´

- **é¦–æ¬¡å¯åŠ¨ï¼š** Embedding æ¨¡å‹åŠ è½½å¯èƒ½éœ€è¦ 30-60 ç§’
- **ä¼˜åŒ–å»ºè®®ï¼š** ä½¿ç”¨ `@st.cache_resource` ç¼“å­˜æ¨¡å‹ï¼ˆå·²å®ç°ï¼‰

#### 3. æ•°æ®åº“è¿æ¥

- **è¿æ¥æ± ï¼š** è€ƒè™‘å®ç°è¿æ¥æ± ä¼˜åŒ–ï¼ˆè§ README.md ä¸­çš„ä¼˜åŒ–æ–¹æ¡ˆï¼‰
- **è¶…æ—¶è®¾ç½®ï¼š** ç¡®ä¿æ•°æ®åº“è¿æ¥æœ‰åˆç†çš„è¶…æ—¶æ—¶é—´

#### 4. ç¯å¢ƒå˜é‡å®‰å…¨

- âœ… **ä¸è¦**åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- âœ… **ä¸è¦**å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
- âœ… **ä½¿ç”¨** Streamlit Cloud Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯

#### 5. æ—¥å¿—å¤„ç†

- Streamlit Cloud çš„æ—¥å¿—ä¼šæ˜¾ç¤ºåœ¨ Web UI
- æ–‡ä»¶æ—¥å¿—å¯èƒ½æ— æ³•å†™å…¥ï¼Œå»ºè®®ä½¿ç”¨æ§åˆ¶å°æ—¥å¿—

---

### ğŸ” æ•…éšœæ’æŸ¥

#### é—®é¢˜ 1ï¼šä¾èµ–å®‰è£…å¤±è´¥

**ç—‡çŠ¶ï¼š** æ„å»ºæ—¥å¿—æ˜¾ç¤º `pip install` é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ `requirements.txt` æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬å…¼å®¹
- å°è¯•å›ºå®šç‰ˆæœ¬å·ï¼ˆå¦‚ `streamlit==1.51.0`ï¼‰

#### é—®é¢˜ 2ï¼šç¯å¢ƒå˜é‡æœªåŠ è½½

**ç—‡çŠ¶ï¼š** åº”ç”¨å¯åŠ¨æ—¶æŠ¥é”™ `KeyError` æˆ–é…ç½®ä¸ºç©º

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ Streamlit Cloud Secrets é…ç½®
- ç¡®è®¤å˜é‡åæ‹¼å†™æ­£ç¡®
- æ£€æŸ¥ TOML æ ¼å¼æ˜¯å¦æ­£ç¡®

#### é—®é¢˜ 3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š** æ•°æ®åº“æ“ä½œæŠ¥é”™

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ `DATABASE_URL` æ ¼å¼
- ç¡®è®¤ Supabase PostgreSQL å…è®¸å¤–éƒ¨è¿æ¥
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### é—®é¢˜ 4ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶ï¼š** æ–‡æ¡£ä¸Šä¼ åæ— æ³•ä¿å­˜

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ Supabase Storage Bucket é…ç½®
- ç¡®è®¤ `SUPABASE_SERVICE_KEY` æœ‰å†™å…¥æƒé™
- æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™

#### é—®é¢˜ 5ï¼šå‘é‡æ£€ç´¢å¤±è´¥

**ç—‡çŠ¶ï¼š** æ£€ç´¢åŠŸèƒ½æŠ¥é”™

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ Pinecone API Key å’Œ Environment
- ç¡®è®¤ Index åç§°æ­£ç¡®
- æ£€æŸ¥ Index æ˜¯å¦å·²åˆ›å»º

---

### ğŸ“Š éƒ¨ç½²åä¼˜åŒ–å»ºè®®

#### 1. æ€§èƒ½ä¼˜åŒ–

- [ ] å®ç°æ•°æ®åº“è¿æ¥æ± ï¼ˆè§ README.mdï¼‰
- [ ] ä¼˜åŒ– Embedding æ¨¡å‹åŠ è½½ï¼ˆä½¿ç”¨æ›´å°çš„æ¨¡å‹æˆ–é¢„åŠ è½½ï¼‰
- [ ] å®ç°å‘é‡æ£€ç´¢ç¼“å­˜

#### 2. ç›‘æ§å’Œæ—¥å¿—

- [ ] é›†æˆé”™è¯¯è¿½è¸ªæœåŠ¡ï¼ˆå¦‚ Sentryï¼‰
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§
- [ ] è®¾ç½®å‘Šè­¦ï¼ˆæ•°æ®åº“è¿æ¥å¤±è´¥ã€API è°ƒç”¨å¤±è´¥ç­‰ï¼‰

#### 3. å®‰å…¨æ€§

- [ ] å¯ç”¨ HTTPSï¼ˆStreamlit Cloud é»˜è®¤æ”¯æŒï¼‰
- [ ] å®ç°é€Ÿç‡é™åˆ¶ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
- [ ] å®šæœŸè½®æ¢ API å¯†é’¥

---

### ğŸ“ æ€»ç»“

#### å¿…éœ€æ–‡ä»¶æ¸…å•

1. âœ… `requirements.txt` - ä¾èµ–æ¸…å•
2. âœ… `.streamlit/config.toml` - Streamlit é…ç½®
3. âœ… `.gitignore` - å¿½ç•¥æ•æ„Ÿæ–‡ä»¶
4. âœ… `app.py` - ä¸»åº”ç”¨å…¥å£ï¼ˆå·²æœ‰ï¼‰

#### å¿…éœ€é…ç½®

1. âœ… æ‰€æœ‰æ¨¡å¼è®¾ç½®ä¸º `cloud`
2. âœ… æ‰€æœ‰äº‘æœåŠ¡ç¯å¢ƒå˜é‡é…ç½®
3. âœ… Streamlit Cloud Secrets é…ç½®

#### ä»£ç ä¿®æ”¹ç‚¹

1. âš ï¸ æ—¥å¿—æ–‡ä»¶è·¯å¾„å¤„ç†ï¼ˆå¯é€‰ï¼Œå»ºè®®ä¼˜åŒ–ï¼‰
2. âœ… ç¡®ä¿ä¸ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆå·²é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ï¼‰

---

### ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç”Ÿæˆ requirements.txt**
2. **åˆ›å»º .streamlit/config.toml**
3. **æ›´æ–° .gitignore**
4. **æµ‹è¯•æœ¬åœ°ç¯å¢ƒå˜é‡åŠ è½½**
5. **æäº¤ä»£ç åˆ° Git**
6. **åœ¨ Streamlit Cloud åˆ›å»ºåº”ç”¨å¹¶é…ç½® Secrets**
7. **éƒ¨ç½²å¹¶éªŒè¯**

---

**æœ€åæ›´æ–°ï¼š** 2025-01-XX  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0



---

## ğŸ”§ Troubleshooting & Fixes


---

### IPv6 è¿æ¥é—®é¢˜ä¿®å¤

#### ğŸ” é—®é¢˜åˆ†æ

##### é”™è¯¯ä¿¡æ¯

```
connection to server at "db.wldswlgrbjosaedbxiqp.supabase.co" 
(2600:1f16:1cd0:331e:a636:d013:b754:f654), port 5432 failed: 
Cannot assign requested address
```

##### æ ¹æœ¬åŸå› 

1. **ç½‘ç»œç¯å¢ƒå·®å¼‚**ï¼š
   - **æœ¬åœ°ç¯å¢ƒ**ï¼šæ”¯æŒ IPv6ï¼Œå¯ä»¥æ­£å¸¸è¿æ¥
   - **Streamlit Cloud**ï¼šä¸æ”¯æŒ IPv6 æˆ– IPv6 è¿æ¥æœ‰é—®é¢˜

2. **DNS è§£æé—®é¢˜**ï¼š
   - Supabase ä¸»æœºå `db.wldswlgrbjosaedbxiqp.supabase.co` è§£ææ—¶è¿”å›äº† IPv6 åœ°å€
   - psycopg2 å°è¯•ä½¿ç”¨ IPv6 åœ°å€è¿æ¥ï¼Œä½† Streamlit Cloud æ— æ³•ä½¿ç”¨

3. **è¿æ¥æ–¹å¼**ï¼š
   - psycopg2 åœ¨è¿æ¥æ—¶ä¼šè°ƒç”¨ `socket.getaddrinfo()` è§£æä¸»æœºå
   - å¦‚æœ DNS è¿”å› IPv6 åœ°å€ï¼Œpsycopg2 ä¼šä¼˜å…ˆä½¿ç”¨ IPv6

#### âœ… ä¿®å¤æ–¹æ¡ˆ

##### æ ¸å¿ƒæ€è·¯

**å¼ºåˆ¶ä½¿ç”¨ IPv4**ï¼šæ‹¦æˆª `socket.getaddrinfo()` å‡½æ•°ï¼Œè¿‡æ»¤æ‰ IPv6 åœ°å€ï¼Œåªè¿”å› IPv4 åœ°å€ã€‚

##### å®ç°æ–¹æ³•

1. **ä¿å­˜åŸå§‹çš„ `getaddrinfo` å‡½æ•°**
   ```python
   _original_getaddrinfo = socket.getaddrinfo
   ```

2. **åˆ›å»º IPv4 è¿‡æ»¤å‡½æ•°**
   ```python
   def _ipv4_getaddrinfo(*args, **kwargs):
       """å¼ºåˆ¶ä½¿ç”¨ IPv4 çš„ getaddrinfo"""
       responses = _original_getaddrinfo(*args, **kwargs)
       # è¿‡æ»¤æ‰ IPv6 åœ°å€ï¼Œåªè¿”å› IPv4
       return [r for r in responses if r[0] == socket.AF_INET]
   ```

3. **æ›¿æ¢å…¨å±€ `getaddrinfo`**
   ```python
   socket.getaddrinfo = _ipv4_getaddrinfo
   ```

##### å·¥ä½œåŸç†

1. **DNS è§£ææ‹¦æˆª**ï¼š
   - å½“ psycopg2 è°ƒç”¨ `socket.getaddrinfo()` è§£æä¸»æœºåæ—¶
   - æˆ‘ä»¬çš„æ‹¦æˆªå‡½æ•°ä¼šå…ˆè°ƒç”¨åŸå§‹çš„ `getaddrinfo()`
   - ç„¶åè¿‡æ»¤æ‰æ‰€æœ‰ IPv6 åœ°å€ï¼ˆ`socket.AF_INET6`ï¼‰
   - åªè¿”å› IPv4 åœ°å€ï¼ˆ`socket.AF_INET`ï¼‰

2. **è¿æ¥æµç¨‹**ï¼š
   ```
   psycopg2.connect(DATABASE_URL)
     â†“
   è§£æä¸»æœºåï¼šdb.wldswlgrbjosaedbxiqp.supabase.co
     â†“
   socket.getaddrinfo() [è¢«æ‹¦æˆª]
     â†“
   è¿”å› IPv4 åœ°å€åˆ—è¡¨ï¼ˆè¿‡æ»¤æ‰ IPv6ï¼‰
     â†“
   psycopg2 ä½¿ç”¨ IPv4 åœ°å€è¿æ¥
     â†“
   è¿æ¥æˆåŠŸ âœ…
   ```

#### ğŸ“ ä»£ç ä¿®æ”¹

##### ä¿®æ”¹ä½ç½®

**æ–‡ä»¶**ï¼š`database/db_manager.py`

**ä¿®æ”¹å†…å®¹**ï¼š
1. å¯¼å…¥ `socket` æ¨¡å—
2. æ·»åŠ  IPv4 å¼ºåˆ¶é€»è¾‘ï¼ˆåœ¨æ¨¡å—çº§åˆ«æ‰§è¡Œï¼‰
3. ç¡®ä¿åœ¨æ‰€æœ‰è¿æ¥ä¹‹å‰ç”Ÿæ•ˆ

##### å…³é”®ä»£ç 

```python
### å¼ºåˆ¶ä½¿ç”¨ IPv4ï¼ˆè§£å†³ Streamlit Cloud IPv6 è¿æ¥é—®é¢˜ï¼‰
_original_getaddrinfo = socket.getaddrinfo

def _ipv4_getaddrinfo(*args, **kwargs):
    """å¼ºåˆ¶ä½¿ç”¨ IPv4 çš„ getaddrinfo"""
    responses = _original_getaddrinfo(*args, **kwargs)
    # è¿‡æ»¤æ‰ IPv6 åœ°å€ï¼Œåªè¿”å› IPv4
    return [r for r in responses if r[0] == socket.AF_INET]

### åœ¨æ‰€æœ‰æƒ…å†µä¸‹å¼ºåˆ¶ä½¿ç”¨ IPv4
socket.getaddrinfo = _ipv4_getaddrinfo
```

#### ğŸ¯ ä¼˜åŠ¿

1. **é€æ˜ä¿®å¤**ï¼šä¸éœ€è¦ä¿®æ”¹ DATABASE_URL
2. **å‘åå…¼å®¹**ï¼šæœ¬åœ°ç¯å¢ƒä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼ˆIPv4 ä¹Ÿæ”¯æŒï¼‰
3. **å…¨å±€ç”Ÿæ•ˆ**ï¼šæ‰€æœ‰ PostgreSQL è¿æ¥éƒ½è‡ªåŠ¨ä½¿ç”¨ IPv4
4. **ä¸å½±å“å…¶ä»–åŠŸèƒ½**ï¼šåªå½±å“ DNS è§£æï¼Œä¸å½±å“å…¶ä»– socket æ“ä½œ

#### âš ï¸ æ³¨æ„äº‹é¡¹

1. **å½±å“èŒƒå›´**ï¼š
   - è¿™ä¸ªä¿®æ”¹ä¼šå½±å“æ‰€æœ‰ä½¿ç”¨ `socket.getaddrinfo()` çš„ä»£ç 
   - ä½†é€šå¸¸ä¸ä¼šé€ æˆé—®é¢˜ï¼Œå› ä¸ºå¤§å¤šæ•°æœåŠ¡éƒ½åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6

2. **æœ¬åœ°å¼€å‘**ï¼š
   - æœ¬åœ°ç¯å¢ƒé€šå¸¸åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6
   - å¼ºåˆ¶ä½¿ç”¨ IPv4 ä¸ä¼šå½±å“æœ¬åœ°å¼€å‘

3. **å…¶ä»–æœåŠ¡**ï¼š
   - å¦‚æœåº”ç”¨ä¸­æœ‰å…¶ä»–éœ€è¦ IPv6 çš„æœåŠ¡ï¼Œå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†
   - ä½†é€šå¸¸ Streamlit Cloud ä¸Šçš„æœåŠ¡éƒ½ä½¿ç”¨ IPv4

#### ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **æäº¤ä»£ç **
   ```bash
   git add database/db_manager.py
   git commit -m "ä¿®å¤ IPv6 è¿æ¥é—®é¢˜ï¼šå¼ºåˆ¶ä½¿ç”¨ IPv4"
   git push origin main
   ```

2. **éªŒè¯éƒ¨ç½²**
   - ç­‰å¾… Streamlit Cloud è‡ªåŠ¨é‡æ–°éƒ¨ç½²
   - æ£€æŸ¥åº”ç”¨æ—¥å¿—ç¡®è®¤è¿æ¥æˆåŠŸ
   - æµ‹è¯•æ•°æ®åº“æ“ä½œåŠŸèƒ½

#### ğŸ” éªŒè¯æ–¹æ³•

éƒ¨ç½²åï¼Œæ£€æŸ¥æ—¥å¿—ä¸­åº”è¯¥çœ‹åˆ°ï¼š
- âœ… ä¸å†æœ‰ IPv6 è¿æ¥é”™è¯¯
- âœ… PostgreSQL è¿æ¥æˆåŠŸ
- âœ… æ•°æ®åº“æ“ä½œæ­£å¸¸

å¦‚æœä»ç„¶æœ‰é—®é¢˜ï¼Œæ£€æŸ¥ï¼š
1. ä»£ç æ˜¯å¦å·²æ­£ç¡®éƒ¨ç½²
2. Streamlit Cloud æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. DATABASE_URL é…ç½®æ˜¯å¦æ­£ç¡®

---

**ä¿®å¤æ—¥æœŸ**ï¼š2025-11-24  
**é—®é¢˜çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤



---

### PostgreSQL è¿æ¥é—®é¢˜ä¿®å¤

#### ğŸ” é—®é¢˜åˆ†æ

##### é”™è¯¯ä¿¡æ¯

```
ConnectionError: åˆ›å»º PostgreSQL è¿æ¥æ± å¤±è´¥: connection to server at 
"db.wldswlgrbjosaedbxiqp.supabase.co" (2600:1f16:1cd0:331e:a636:d013:b754:f654),
port 5432 failed: Cannot assign requested address
```

##### æ ¹æœ¬åŸå› 

1. **IPv6 è¿æ¥é—®é¢˜**ï¼šSupabase PostgreSQL è¿”å›äº† IPv6 åœ°å€ï¼Œä½† Streamlit Cloud çš„ç½‘ç»œç¯å¢ƒå¯èƒ½ä¸æ”¯æŒ IPv6 è¿æ¥
2. **è¿æ¥æ± åˆå§‹åŒ–å¤±è´¥**ï¼šè¿æ¥æ± åˆ›å»ºæ—¶ç«‹å³å¤±è´¥ï¼Œæ²¡æœ‰é™çº§æ–¹æ¡ˆ
3. **ç¼ºå°‘è¿æ¥å‚æ•°**ï¼šæ²¡æœ‰è®¾ç½®è¿æ¥è¶…æ—¶å’Œ keepalive å‚æ•°

#### âœ… ä¿®å¤æ–¹æ¡ˆ

##### 1. æ·»åŠ æ•°æ®åº“ URL è§„èŒƒåŒ–æ–¹æ³•

æ–°å¢ `_normalize_database_url()` æ–¹æ³•ï¼š
- è§£ææ•°æ®åº“è¿æ¥ URL
- æ·»åŠ è¿æ¥è¶…æ—¶å’Œ keepalive å‚æ•°
- ä¼˜åŒ–è¿æ¥é…ç½®

##### 2. ä¼˜åŒ–è¿æ¥æ± åˆå§‹åŒ–

**æ”¹è¿›å‰**ï¼š
- è¿æ¥æ± åˆ›å»ºå¤±è´¥ç«‹å³æŠ›å‡ºå¼‚å¸¸
- æ²¡æœ‰é™çº§æ–¹æ¡ˆ

**æ”¹è¿›å**ï¼š
- è¿æ¥æ± åˆ›å»ºå¤±è´¥æ—¶è®°å½•è­¦å‘Šï¼Œä½†ä¸æŠ›å‡ºå¼‚å¸¸
- åœ¨ `get_connection()` ä¸­é™çº§åˆ°ç›´æ¥è¿æ¥
- å‡å°‘è¿æ¥æ± å¤§å°ï¼ˆminconn=1, maxconn=5ï¼‰ï¼Œé€‚åˆ Streamlit Cloud ç¯å¢ƒ

##### 3. æ·»åŠ è¿æ¥é™çº§æœºåˆ¶

**æ”¹è¿›å‰**ï¼š
- è¿æ¥æ± å¤±è´¥åæ— æ³•æ¢å¤

**æ”¹è¿›å**ï¼š
- è¿æ¥æ± å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°ç›´æ¥è¿æ¥
- æ‰€æœ‰è¿æ¥éƒ½ä½¿ç”¨è§„èŒƒåŒ–åçš„ URLï¼ˆåŒ…å«ä¼˜åŒ–å‚æ•°ï¼‰

#### ğŸ“ ä»£ç ä¿®æ”¹

##### ä¸»è¦ä¿®æ”¹ç‚¹

1. **æ–°å¢ `_normalize_database_url()` æ–¹æ³•**
   - æ·»åŠ è¿æ¥è¶…æ—¶å‚æ•°ï¼š`connect_timeout=10`
   - å¯ç”¨ keepaliveï¼š`keepalives=1`
   - é…ç½® keepalive å‚æ•°

2. **ä¼˜åŒ– `_init_connection_pool()` æ–¹æ³•**
   - è¿æ¥æ± åˆ›å»ºå¤±è´¥æ—¶ä¸æŠ›å‡ºå¼‚å¸¸
   - å‡å°‘è¿æ¥æ± å¤§å°
   - è®°å½•è­¦å‘Šæ—¥å¿—

3. **æ”¹è¿› `get_connection()` æ–¹æ³•**
   - ä½¿ç”¨è§„èŒƒåŒ–åçš„ URL
   - æ·»åŠ è¿æ¥æ± é™çº§æœºåˆ¶
   - æ‰€æœ‰è¿æ¥éƒ½é€šè¿‡è§„èŒƒåŒ– URL

4. **æ›´æ–° `_init_postgres_database()` æ–¹æ³•**
   - ä½¿ç”¨è§„èŒƒåŒ–åçš„ URL è¿›è¡Œåˆå§‹åŒ–

#### ğŸ”§ è¿æ¥å‚æ•°è¯´æ˜

æ·»åŠ çš„è¿æ¥å‚æ•°ï¼š

- `connect_timeout=10`ï¼šè¿æ¥è¶…æ—¶ 10 ç§’
- `keepalives=1`ï¼šå¯ç”¨ TCP keepalive
- `keepalives_idle=30`ï¼škeepalive idle æ—¶é—´ 30 ç§’
- `keepalives_interval=10`ï¼škeepalive é—´éš” 10 ç§’
- `keepalives_count=5`ï¼škeepalive é‡è¯•æ¬¡æ•° 5 æ¬¡

#### ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **æäº¤ä»£ç **
   ```bash
   git add database/db_manager.py
   git commit -m "ä¿®å¤ PostgreSQL è¿æ¥é—®é¢˜ï¼šæ·»åŠ è¿æ¥é™çº§å’Œ URL è§„èŒƒåŒ–"
   git push origin main
   ```

2. **éªŒè¯éƒ¨ç½²**
   - ç­‰å¾… Streamlit Cloud è‡ªåŠ¨é‡æ–°éƒ¨ç½²
   - æ£€æŸ¥åº”ç”¨æ—¥å¿—ç¡®è®¤è¿æ¥æˆåŠŸ
   - æµ‹è¯•æ•°æ®åº“æ“ä½œåŠŸèƒ½

#### ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **IPv6 é—®é¢˜**ï¼šå¦‚æœä»ç„¶é‡åˆ° IPv6 è¿æ¥é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ï¼š
   - åœ¨ Supabase ä¸­é…ç½®ä»…ä½¿ç”¨ IPv4
   - æˆ–ä½¿ç”¨ Supabase çš„è¿æ¥æ± åŠŸèƒ½

2. **è¿æ¥æ± å¤§å°**ï¼šå·²è°ƒæ•´ä¸ºé€‚åˆ Streamlit Cloud ç¯å¢ƒï¼š
   - `minconn=1`ï¼šæœ€å°è¿æ¥æ•°
   - `maxconn=5`ï¼šæœ€å¤§è¿æ¥æ•°

3. **é™çº§æœºåˆ¶**ï¼šè¿æ¥æ± å¤±è´¥æ—¶ä¼šè‡ªåŠ¨é™çº§åˆ°ç›´æ¥è¿æ¥ï¼Œç¡®ä¿åº”ç”¨å¯ä»¥ç»§ç»­è¿è¡Œ

#### ğŸ”— ç›¸å…³èµ„æº

- [psycopg2 è¿æ¥å‚æ•°æ–‡æ¡£](https://www.psycopg.org/docs/module.html#psycopg2.connect)
- [Supabase PostgreSQL è¿æ¥æŒ‡å—](https://supabase.com/docs/guides/database/connecting-to-postgres)

---

**ä¿®å¤æ—¥æœŸ**ï¼š2025-11-24  
**é—®é¢˜çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤



---

### Streamlit Cloud éƒ¨ç½²é—®é¢˜ä¿®å¤

#### ğŸ” é—®é¢˜åˆ†æ

##### é”™è¯¯ä¿¡æ¯

```
Exception: The official Pinecone python package has been renamed from `pinecone-client` to `pinecone`. 
Please remove `pinecone-client` from your project dependencies and add `pinecone` instead.
```

##### æ ¹æœ¬åŸå› 

**Pinecone åŒ…å†²çª**ï¼šé¡¹ç›®ä¾èµ–ä¸­åŒæ—¶å­˜åœ¨å·²å¼ƒç”¨çš„ `pinecone-client` å’Œæ–°ç‰ˆæœ¬çš„ `pinecone` åŒ…ã€‚

Pinecone å®˜æ–¹åœ¨è¾ƒæ–°ç‰ˆæœ¬ä¸­å°† Python åŒ…ä» `pinecone-client` é‡å‘½åä¸º `pinecone`ã€‚æ–°ç‰ˆæœ¬çš„ `pinecone` åŒ…åœ¨å¯¼å…¥æ—¶ä¼šæ£€æµ‹æ˜¯å¦å®‰è£…äº† `pinecone-client`ï¼Œå¦‚æœæ£€æµ‹åˆ°ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé˜²æ­¢ä¸¤ä¸ªåŒ…åŒæ—¶å­˜åœ¨å¯¼è‡´çš„å†²çªã€‚

##### é”™è¯¯ä½ç½®

- **æ–‡ä»¶**ï¼š`requirements.txt` ç¬¬ 15 è¡Œ
- **æ–‡ä»¶**ï¼š`pyproject.toml` ç¬¬ 36 è¡Œ
- **é”™è¯¯è§¦å‘**ï¼š`services/vector_store_service.py` å¯¼å…¥ `pinecone` æ—¶

#### âœ… ä¿®å¤æ–¹æ¡ˆ

##### 1. æ›´æ–° `requirements.txt`

**ä¿®æ”¹å‰ï¼š**
```txt
pinecone-client>=6.0.0,<7.0.0
```

**ä¿®æ”¹åï¼š**
```txt
### Pinecone å®˜æ–¹åŒ…å·²é‡å‘½åï¼šä» pinecone-client æ”¹ä¸º pinecone
pinecone>=6.0.0,<7.0.0
```

##### 2. æ›´æ–° `pyproject.toml`

**ä¿®æ”¹å‰ï¼š**
```toml
pinecone-client = "^6.0.0"
```

**ä¿®æ”¹åï¼š**
```toml
### æ³¨æ„ï¼šPinecone å®˜æ–¹åŒ…å·²é‡å‘½åï¼Œä» pinecone-client æ”¹ä¸º pinecone
pinecone = "^6.0.0"
```

#### ğŸ“ éªŒè¯æ­¥éª¤

1. **æäº¤æ›´æ”¹åˆ° Git**
   ```bash
   git add requirements.txt pyproject.toml
   git commit -m "ä¿®å¤ Pinecone åŒ…å†²çªï¼šå°† pinecone-client æ›¿æ¢ä¸º pinecone"
   git push origin main
   ```

2. **åœ¨ Streamlit Cloud é‡æ–°éƒ¨ç½²**
   - Streamlit Cloud ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç æ›´æ”¹å¹¶é‡æ–°éƒ¨ç½²
   - ç­‰å¾…æ„å»ºå®Œæˆï¼ˆé€šå¸¸ 2-5 åˆ†é’Ÿï¼‰

3. **éªŒè¯åº”ç”¨å¯åŠ¨**
   - æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
   - ç¡®è®¤ä¸å†å‡ºç° Pinecone åŒ…å†²çªé”™è¯¯

#### ğŸ”— ç›¸å…³èµ„æº

- [Pinecone Python SDK è¿ç§»æŒ‡å—](https://github.com/pinecone-io/pinecone-python-client)
- [Pinecone Python SDK æ–‡æ¡£](https://docs.pinecone.io/docs/python-client)

#### ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **ç‰ˆæœ¬å…¼å®¹æ€§**ï¼šç¡®ä¿ `pinecone>=6.0.0` ä¸ `langchain-pinecone>=0.2.13` å…¼å®¹
2. **æœ¬åœ°å¼€å‘**ï¼šå¦‚æœæœ¬åœ°ä½¿ç”¨ Poetryï¼Œéœ€è¦è¿è¡Œ `poetry update pinecone` æ›´æ–°ä¾èµ–
3. **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ Streamlit Cloud Secrets ä¸­é…ç½®äº†æ­£ç¡®çš„ Pinecone ç¯å¢ƒå˜é‡

---

**ä¿®å¤æ—¥æœŸ**ï¼š2025-11-24  
**é—®é¢˜çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤



---

## ğŸ”„ Upgrade History

## é¡¹ç›®å‡çº§æ€»ç»“ - Streamlit Cloud éƒ¨ç½²å‡†å¤‡

### âœ… å·²å®Œæˆçš„å‡çº§

#### 1. åˆ›å»ºå¿…éœ€æ–‡ä»¶

##### âœ… `requirements.txt`
- **ä½ç½®**: é¡¹ç›®æ ¹ç›®å½•
- **å†…å®¹**: ä» `pyproject.toml` æå–çš„æ‰€æœ‰ä¾èµ–ï¼Œä½¿ç”¨å…¼å®¹ç‰ˆæœ¬èŒƒå›´
- **ç”¨é€”**: Streamlit Cloud ä½¿ç”¨æ­¤æ–‡ä»¶å®‰è£…ä¾èµ–

##### âœ… `.streamlit/config.toml`ï¼ˆå·²æ›´æ–°ï¼‰
- **ä½ç½®**: `.streamlit/config.toml`
- **æ›´æ–°å†…å®¹**:
  - æ·»åŠ äº† `enableCORS` å’Œ `enableXsrfProtection` å®‰å…¨é…ç½®
  - ä¼˜åŒ–äº†ä¸»é¢˜é…ç½®
  - é…ç½®äº†æœåŠ¡å™¨è®¾ç½®

##### âœ… `verify_deployment.py`
- **ä½ç½®**: é¡¹ç›®æ ¹ç›®å½•
- **ç”¨é€”**: éƒ¨ç½²å‰éªŒè¯è„šæœ¬ï¼Œæ£€æŸ¥æ‰€æœ‰å¿…éœ€æ–‡ä»¶å’Œé…ç½®
- **ä½¿ç”¨æ–¹æ³•**: `python3 verify_deployment.py`

#### 2. ä»£ç ä¼˜åŒ–

##### âœ… `utils/config.py` - ç¯å¢ƒå˜é‡åŠ è½½ä¼˜åŒ–
- **æ”¹è¿›**: æ”¯æŒ Streamlit Secrets è‡ªåŠ¨åŠ è½½
- **å…¼å®¹æ€§**: 
  - æœ¬åœ°è¿è¡Œï¼šä» `.env` æ–‡ä»¶åŠ è½½
  - Streamlit Cloudï¼šä» Secrets è‡ªåŠ¨åŠ è½½
  - ä¼˜å…ˆçº§ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡ > .env æ–‡ä»¶ > é»˜è®¤å€¼
- **å…³é”®ä»£ç **:
  ```python
  load_dotenv(override=False)  # ä¸è¦†ç›–å·²å­˜åœ¨çš„ç¯å¢ƒå˜é‡
  _load_streamlit_secrets()    # å»¶è¿ŸåŠ è½½ Streamlit Secrets
  ```

##### âœ… æ—¥å¿—é…ç½®
- **çŠ¶æ€**: å·²ç¡®è®¤ä½¿ç”¨ `stream=sys.stdout`ï¼ˆæ§åˆ¶å°è¾“å‡ºï¼‰
- **å…¼å®¹æ€§**: âœ… å®Œå…¨å…¼å®¹ Streamlit Cloud

#### 3. é…ç½®æ–‡ä»¶éªŒè¯

##### âœ… `.gitignore`
- **å·²åŒ…å«**: `.env`, `.streamlit/secrets.toml`, `data/`, `logs/`
- **çŠ¶æ€**: âœ… é…ç½®æ­£ç¡®ï¼Œæ•æ„Ÿæ–‡ä»¶ä¸ä¼šè¢«æäº¤

### ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

#### æœ¬åœ°å¼€å‘ç¯å¢ƒ

- [x] `requirements.txt` å·²åˆ›å»º
- [x] `.streamlit/config.toml` å·²æ›´æ–°
- [x] `.gitignore` é…ç½®æ­£ç¡®
- [x] ç¯å¢ƒå˜é‡åŠ è½½é€»è¾‘å·²ä¼˜åŒ–
- [x] æ—¥å¿—é…ç½®å…¼å®¹ Cloud
- [x] éªŒè¯è„šæœ¬é€šè¿‡æ‰€æœ‰æ£€æŸ¥

#### Streamlit Cloud éƒ¨ç½²å‰å‡†å¤‡

- [ ] æäº¤ä»£ç åˆ° Git
  ```bash
  git add requirements.txt .streamlit/config.toml verify_deployment.py utils/config.py
  git commit -m "å‡†å¤‡ Streamlit Cloud éƒ¨ç½²ï¼šæ·»åŠ  requirements.txt å’Œä¼˜åŒ–é…ç½®"
  git push origin main
  ```

- [ ] åœ¨ Streamlit Cloud é…ç½® Secrets
  - è®¿é—® [share.streamlit.io](https://share.streamlit.io)
  - åˆ›å»ºæ–°åº”ç”¨
  - åœ¨ "Secrets" ä¸­é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ˆå‚è€ƒ `STREAMLIT_CLOUD_DEPLOYMENT.md`ï¼‰

- [ ] ç¡®ä¿æ‰€æœ‰æ¨¡å¼è®¾ç½®ä¸º `cloud`
  - `STORAGE_MODE=cloud`
  - `VECTOR_DB_MODE=cloud`
  - `DATABASE_MODE=cloud`

### ğŸ”„ å…¼å®¹æ€§è¯´æ˜

#### æœ¬åœ°è¿è¡Œ

é¡¹ç›®å®Œå…¨å…¼å®¹æœ¬åœ°è¿è¡Œï¼Œä½¿ç”¨æ–¹å¼ä¸å˜ï¼š

1. **ç¯å¢ƒå˜é‡**: ä» `.env` æ–‡ä»¶åŠ è½½
2. **æ•°æ®å­˜å‚¨**: æ ¹æ® `STORAGE_MODE`ã€`VECTOR_DB_MODE`ã€`DATABASE_MODE` é€‰æ‹©æœ¬åœ°æˆ–äº‘æœåŠ¡
3. **æ—¥å¿—**: è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ˆ`sys.stdout`ï¼‰

#### Streamlit Cloud è¿è¡Œ

1. **ç¯å¢ƒå˜é‡**: ä» Streamlit Secrets è‡ªåŠ¨åŠ è½½ï¼ˆé€šè¿‡ `st.secrets`ï¼‰
2. **æ•°æ®å­˜å‚¨**: å¿…é¡»ä½¿ç”¨äº‘æœåŠ¡ï¼ˆ`STORAGE_MODE=cloud`ã€`VECTOR_DB_MODE=cloud`ã€`DATABASE_MODE=cloud`ï¼‰
3. **æ—¥å¿—**: è¾“å‡ºåˆ° Streamlit Cloud æ—¥å¿—æ§åˆ¶å°

### ğŸ“ å…³é”®æ”¹è¿›ç‚¹

#### 1. ç¯å¢ƒå˜é‡åŠ è½½ä¼˜å…ˆçº§

```
ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆStreamlit Secretsï¼‰
    â†“
.env æ–‡ä»¶ï¼ˆæœ¬åœ°å¼€å‘ï¼‰
    â†“
é»˜è®¤å€¼
```

#### 2. Streamlit Secrets æ”¯æŒ

- è‡ªåŠ¨æ£€æµ‹å¹¶åŠ è½½ `st.secrets`
- ä¸è¦†ç›–å·²å­˜åœ¨çš„ç¯å¢ƒå˜é‡
- åœ¨é Streamlit ç¯å¢ƒä¸­é™é»˜å¤±è´¥

#### 3. å‘åå…¼å®¹

- æ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¿æŒä¸å˜
- æœ¬åœ°å¼€å‘ä½“éªŒä¸å—å½±å“
- å¯ä»¥éšæ—¶åˆ‡æ¢æœ¬åœ°/äº‘æœåŠ¡æ¨¡å¼

### ğŸš€ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•æœ¬åœ°è¿è¡Œ**
   ```bash
   streamlit run app.py
   ```

2. **è¿è¡ŒéªŒè¯è„šæœ¬**
   ```bash
   python3 verify_deployment.py
   ```

3. **æäº¤ä»£ç **
   ```bash
   git add .
   git commit -m "å‡†å¤‡ Streamlit Cloud éƒ¨ç½²"
   git push origin main
   ```

4. **éƒ¨ç½²åˆ° Streamlit Cloud**
   - å‚è€ƒ `STREAMLIT_CLOUD_DEPLOYMENT.md` è¯¦ç»†æ­¥éª¤
   - å‚è€ƒ `DEPLOYMENT_CHECKLIST.md` æ£€æŸ¥æ¸…å•

### ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†éƒ¨ç½²æ–¹æ¡ˆ**: `STREAMLIT_CLOUD_DEPLOYMENT.md`
- **éƒ¨ç½²æ£€æŸ¥æ¸…å•**: `DEPLOYMENT_CHECKLIST.md`
- **ç¯å¢ƒå˜é‡æ¨¡æ¿**: `config_template.txt`
- **é¡¹ç›® README**: `README.md`

---

**å‡çº§å®Œæˆæ—¶é—´**: 2025-01-XX  
**éªŒè¯çŠ¶æ€**: âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡

